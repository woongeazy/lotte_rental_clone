/*
 * KT Map JavaScript API v3.0.44
 * 
 * Copyright (c) 2013-2018 kt corp. All rights reserved.
 * 
 * This is a proprietary software of kt corp, and you may not use this software
 * except in compliance with license agreement with kt corp. Any redistribution
 * or use of this software, with or without modification shall be strictly
 * prohibited without prior written approval of kt corp, and the copyright
 * notice above does not evidence any actual or intended publication of such
 * software.
 */
document.write('<style type="text/css">.ollehmap *,.ollehmap :after,.ollehmap :before{box-sizing:content-box;-webkit-box-sizing:content-box;-moz-box-sizing:content-box}.ollehmap{position:relative;overflow:hidden;padding:0;margin:0;border:none;background-color:#EEE;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.ollehmap-noevent{pointer-events:none!important}.ollehmap-event{pointer-events:auto}.ollehmap-drag .ollehmap-info,.ollehmap-drag .ollehmap-info-shadow{opacity:.3}.ollehmap-dragging{z-index:357913941!important}.ollehmap-vector{pointer-events:visiblePainted}.ollehmap-info{position:absolute}.ollehmap-info-defaultStyle{font-family:Dotum,Baekmuk Dotum,Undotum,Apple Gothic,Latin font,sans-serif;font-size:12px;font-weight:400;line-height:normal;font-style:normal}.ollehmap-info-area{cursor:default;position:relative;left:0;top:0;background-color:#fff;border:2px solid #474747}.ollehmap-info-content{cursor:auto;position:absolute;min-height:60px;min-width:300px;max-height:500px;z-index:9999;-webkit-user-select:text;-khtml-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text}.ollehmap-info-content-overflow{overflow:auto;-webkit-overflow-scrolling:auto}.ollehmap-info-tip{width:16px;height:26px;overflow:hidden;z-index:1;position:absolute}.ollehmap-info-tip-img{position:absolute;border:0;padding:0;margin:0;top:-348px;left:0;z-index:auto}.ollehmap-info-bottom{position:absolute;left:0;top:0;border:2px solid #474747}.ollehmap-info-shadow{position:absolute}.ollehmap-info-shadow>div{overflow:hidden;position:absolute;z-index:1;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.ollehmap-info-shadow img{position:absolute;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;border:0;padding:0;margin:0}.ollehmap-info-shadow-topleft,.ollehmap-info-shadow-topright{top:0;width:70px;height:10px}.ollehmap-info-shadow-topleft>img{left:-296px;top:0}.ollehmap-info-shadow-topright>img{left:-1036px;top:0}.ollehmap-info-shadow-bottomleft,.ollehmap-info-shadow-bottomright{width:70px;height:30px}.ollehmap-info-shadow-bottomleft>img{left:12px;top:-315px}.ollehmap-info-shadow-bottomright>img{left:-716px;top:-315px}.ollehmap-info-shadow-bottomtip{width:40px;height:30px}.ollehmap-info-shadow-bottomtip>img{left:-356px;top:-315px}.ollehmap-info-shadow-topcenter{height:10px}.ollehmap-info-shadow-topcenter>img{left:-366px;top:0}.ollehmap-info-shadow-centerleft>img{top:-10px}.ollehmap-info-shadow-centerright>img{top:-10px}.ollehmap-info-shadow-bottomleftoftip,.ollehmap-info-shadow-bottomrightoftip{height:30px}.ollehmap-info-shadow-bottomleftoftip>img,.ollehmap-info-shadow-bottomrightoftip>img{left:-396px;top:-315px}.ollehmap-info-shadow-center>img{left:-366px;top:-10px}.ollehmap-info-tooltip-area{position:relative;background-color:#fff;left:0;top:0;border:1px solid #555;border-radius:2px}.ollehmap-info-tooltip-data{font-family:Dotum,Baekmuk Dotum,Undotum,Apple Gothic,Latin font,sans-serif;font-size:13px;font-weight:700;line-height:normal;font-style:normal}.ollehmap-corner-container{position:relative}.ollehmap-corner-container-horizontal{display:inline-block}.ollehmap-corner{position:absolute;z-index:1}.ollehmap-corner-area{position:relative;display:inline-block}.ollehmap-control-rightAlign{margin-left:auto;margin-right:0}.ollehmap-copyright-control{color:#000;font:700 12px/1.5 Dotum,Arial,Helvetica,sans-serif;text-shadow:-1px 0 white,0 1px white,1px 0 white,0 -1px #fff;display:inline}.ollehmap-logo-control,.ollehmap-logo-control.imagery{background-position:-78px -316px;width:22px;height:22px;margin:0 8px 12px 2px}.ollehmap-logo-control.imagery{background-position:-100px -316px}.ollehmap-maptype-control-expandtype{padding:6px;margin:6px;box-shadow:0 1px 7px #999;border:1px solid #000;background-color:#fff;border-radius:8px;-moz-border-radius:8px;font:12px/1.5 "Helvetica Neue",Arial,Helvetica,sans-serif;color:#000;opacity:.8}.ollehmap-maptype-control-expandtype:hover{opacity:1}.ollehmap-maptype-control-expandtype .ollehmap-maptype-control-toggle{display:block;width:27px;height:27px}.ollehmap-maptype-control-expanded .ollehmap-maptype-control-toggle,.ollehmap-maptype-control-expandtype .ollehmap-maptype-control-list{display:none}.ollehmap-maptype-control-expanded .ollehmap-maptype-control-list{display:block}.ollehmap-maptype-control-expanded .ollehmap-maptype-control-separator{height:0;border-top:1px solid #000;margin:5px -6px}.ollehmap-scale-control{background-repeat:no-repeat;background-position:bottom;color:#000;font:11px Dotum,Arial,Helvetica,sans-serif;font-weight:700;text-shadow:-1px 0 white,0 1px white,1px 0 white,0 -1px #fff;text-align:center;margin-bottom:12px}.ollehmap-scale-image{width:46px;height:8px;border:2px solid #000;border-top:none;margin-top:-4px}.ollehmap-scale-image.imagery{border-color:#fff}.ollehmap-zoom-control{position:relative;width:26px}.ollehmap-zoom-control .highlighted{border:1px dashed red}.ollehmap-hidden{display:none!important}.ollehmap-traffic-control{opacity:.8;padding:6px;margin:6px;box-shadow:gray 0 1px 7px;background-color:#fff;border-radius:8px;font-size:11px;font-family:Dotum,sans-serif;letter-spacing:-1px;text-align:left}.ollehmap-traffic-control .imgDiv{height:26px}.ollehmap-traffic-control:hover{opacity:1}.ollehmap-traffic-control .tooltip{position:absolute;top:50px;width:142px}.ollehmap-traffic-control h1{color:#1065ac;font-size:11px;margin:6px}.ollehmap-traffic-control ul{padding:5px;margin:5px 0;list-style-position:inside}.ollehmap-traffic-control li{line-height:15px}.ollehmap-traffic-control .trafficbar{width:55px;height:8px;display:inline-block;padding:1px 0}.ollehmap-traffic-control .trafficbar:hover{padding:0;width:53px;border:1px solid #444}.control-zoombar-active{background-position:0 0;width:26px;height:180px}.control-zoombar-deactive{background-position:-26px 0;width:26px;height:180px}.control-traffic-info{background-position:0 -180px;width:142px;height:63px}.control-pan{background-position:-52px 0;width:60px;height:63px}.control-zoomout{background-position:-112px 0;width:26px;height:26px}.control-zoomin{background-position:-112px -26px;width:26px;height:26px}.control-distance-selected{background-position:-112px -52px;width:26px;height:25px}.control-distance-out{background-position:-52px -63px;width:26px;height:25px}.control-shape-out{background-position:-78px -63px;width:26px;height:25px}.control-shape-selected{background-position:-104px -77px;width:26px;height:25px}.control-change:hover{background-position:-52px -88px;width:26px;height:24px}.control-change{background-position:-78px -88px;width:26px;height:24px}.control-roadmap-out{background-position:-52px -112px;width:55px;height:22px}.control-roadmap-selected{background-position:-52px -156px;width:55px;height:22px}.control-hybrid-out{background-position:0 -265px;width:75px;height:22px}.control-hybrid-selected{background-position:-52px -134px;width:75px;height:22px}.control-satellite-out{background-position:0 -243px;width:55px;height:22px}.control-satellite-selected{background-position:-55px -243px;width:55px;height:22px}.control-engmap-out{background-position:0 -335px;width:55px;height:22px}.control-engmap-selected{background-position:-55px -335px;width:55px;height:22px}.control-measure-distance-start{background-position:-75px -265px;width:37px;height:21px}.control-measure-area-delete{background-position:-107px -112px;width:18px;height:17px}.control-measure-distance-delete{background-position:-107px -156px;width:18px;height:17px}.control-measure-redmouse{background-position:-112px -254px;width:11px;height:16px}.control-measure-bluemouse{background-position:-124px -254px;width:11px;height:16px}.control-level1{background-position:-75px -286px;width:39px;height:15px}.control-level5{background-position:0 -287px;width:39px;height:15px}.control-level3{background-position:-39px -301px;width:39px;height:15px}.control-level13{background-position:-78px -301px;width:39px;height:15px}.control-level11{background-position:0 -302px;width:39px;height:15px}.control-level8{background-position:-39px -316px;width:39px;height:15px}.control-panleft{background-position:-104px -63px;width:8px;height:13px}.control-panright{background-position:-130px -77px;width:8px;height:13px}.control-panleft:hover{background-position:-130px -90px;width:8px;height:13px}.control-panright:hover{background-position:-125px -112px;width:9px;height:12px}.control-area-icon{background-position:-127px -134px;width:11px;height:11px}.control-distance-icon{background-position:-127px -145px;width:11px;height:11px}.control-zoomslider{background-position:-110px -243px;width:20px;height:11px}.control-scale{background-position:-78px -332px;width:54px;height:10px}.control-panup:hover{background-position:-125px -156px;width:12px;height:10px}.control-panup{background-position:-125px -166px;width:12px;height:10px}.control-pandown:hover{background-position:-125px -124px;width:12px;height:9px}.control-pandown{background-position:-130px -243px;width:12px;height:9px}.control-traffic-bullet{background-position:-138px 0;width:4px;height:1px}.control-gauge{background-position:-130px -103px;width:8px;height:1px}.infowin-shadow{background-position:0 0;width:1068px;height:347px}.infowin-tip{background-position:0 -347px;width:18px;height:25px}.infowin-close{background-position:-18px -347px;width:13px;height:13px}.olleh-maps-inline{display:inline-block;margin-left:3px}.ollehmap-measure{background:#fff;white-space:nowrap;width:auto;border:1px solid;position:absolute;font-family:dotum}.ollehmap-measure strong{color:#df2428;font-weight:700}.ollehmap-measure-areaInfo{padding:8px;font-size:11px;border:1px solid #555;background:#F7F7F7;color:#333;white-space:normal;width:110px;margin-top:-63px;margin-left:30px}.ollehmap-measure-finalAreaInfo{padding:10px;font-size:12px;font-weight:700;border:1px solid;color:#333;margin-top:-49px;margin-left:30px}.ollehmap-measure-pointStart{border:1px solid #BC1437;color:#fff;background:#E02428;font-size:12px;font-weight:700;padding:5px}.ollehmap-measure-pointInfo{border:1px solid #DF2428;color:#333;background:#F9F9F9;font-size:12px;font-weight:400;padding:5px}.ollehmap-measure-pointDetail{font-size:12px;border:1px solid #555;padding:10px 10px 55px;color:#333;width:130px;margin-top:-135px;margin-left:30px}.ollehmap-measure-pointDetail1{float:left;clear:left;width:60px;font-weight:700}.ollehmap-measure-pointDetail2{float:left;width:70px;font-weight:700}.ollehmap-measure-finish{padding:8px 19px;background:#F7F7F7;border-top:1px solid #DBDBDB;position:absolute;left:0;bottom:0;right:0;font-size:11px;white-space:normal}</style><style type="text/css">.ollehmap{cursor:default}.ollehmap-boxzoom{position:absolute;background-color:#fff;opacity:.5;border:2px dotted red;width:0;height:0}.ollehmap-transparent{background-color:#fff;opacity:0}.ollehmap-control-clickable{cursor:pointer}.ollehmap-info-close{position:absolute;width:14px;height:14px;overflow:hidden;right:18px;top:13px;z-index:10000;cursor:pointer}.ollehmap-info-close-img{position:absolute;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;border:0;padding:0;margin:0;top:-346px;left:-51px}</style><!--[if lte IE 8]><style type="text/css">.ollehmap-vml{behavior:url(#default#VML);position:absolute}.ollehmap-boxzoom{-ms-filter:"alpha(Opacity=50)";filter:alpha(opacity=50)}.ollehmap-transparent{-ms-filter:"alpha(Opacity=0)";filter:alpha(opacity=0)}.ollehmap-corner-area{margin:1px}.ollehmap-maptype-control-expandtype>form{height:100%;padding:0;margin:0}.ollehmap-measure-pointDetail{width:135px}.ollehmap-measure-areaInfo{width:120px}</style><![endif]-->');
!function(t){Date.now||(Date.now=function(){return+new Date}),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Bind must be called on a function");var e=Array.prototype.slice.call(arguments,1),i=this,s=function(){},o=function(){return i.apply(this instanceof s&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return s.prototype=this.prototype,o.prototype=new s,o}),t.requestAnimationFrame||(t.requestAnimationFrame=t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.msRequestAnimationFrame||t.oRequestAnimationFrame),t.cancelAnimationFrame||(t.cancelAnimationFrame=t.cancelRequestAnimationFrame||t.webkitCancelAnimationFrame||t.webkitCancelRequestAnimationFrame||t.mozCancelAnimationFrame||t.mozCancelRequestAnimationFrame||t.msCancelAnimationFrame||t.msCancelRequestAnimationFrame||t.oCancelAnimationFrame||t.oCancelRequestAnimationFrame),t.requestAnimationFrame&&t.cancelAnimationFrame||(t.requestAnimationFrame=function(e){return t.setTimeout(e.bind(undefined,+Date.now()),17)},t.cancelAnimationFrame=function(t){window.clearTimeout(t)})}(window),function(t){var e=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(this[e]===t)return e;return-1},i={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Object]":"object","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Error]":"error"};t.olleh||(t.olleh={}),t.olleh.maps={typeOf:function(t){return i[Object.prototype.toString.call(t)]||(t?"object":null===t?"null":"undefined")},isArray:function(t,e){return e?t&&"object"==typeof t&&"number"==typeof t.length&&"function"==typeof t.splice&&!t.propertyIsEnumerable("length")||t instanceof Array:Array.isArray&&Array.isArray(t)||"array"===this.typeOf(t)},isBoolean:function(t){return"boolean"==typeof t},isDate:function(t){return"date"===this.typeOf(t)},isRegExp:function(t){return"regexp"===this.typeOf(t)},isElement:function(t){return!(!t||1!==t.nodeType)},isFragment:function(t){return!(!t||11!==t.nodeType)},isFunction:function(t){return"function"===this.typeOf(t)},isNamespace:function(t){return this.isString(t)&&/^[\w]+(\.[\w]+)*$/.test(t)},isNumber:function(t){return"number"==typeof t&&isFinite(t)},isObject:function(t,e){return t&&("object"==typeof t||e&&this.isFunction(t))||!1},isString:function(t){return"string"==typeof t},isUndefined:function(t){return void 0===t},isValue:function(t){var e=this.typeOf(t);switch(e){case"undefined":case"null":return!1;case"number":return isFinite(t);case"string":return""!==t}return!!e},curry:function(t,e,i){if(!arguments.length)throw new SyntaxError("method reference to curry is missing!");if(1===arguments.length)return arguments[0];var s=t,o=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype,i=t.concat.call(t.slice.call(arguments),o);return s.apply(e,i)}},mixin:function(t,i,s,o){if(t=t||{},i!==t)for(var n in i)i.hasOwnProperty(n)&&(s||t[n]===undefined)&&(!o||e.call(o,n)>-1)&&("remix"===s&&this.isObject(t[n])?t[n]=this.mixin(t[n],i[n],s,o):t[n]=i[n]);return t},namespace:function(t,e,i){if(!this.isNamespace(t))throw new SyntaxError("olleh.maps.namespace: invalid namespace, "+t);var s,o,n=window,a=!1,r=t.split("."),l=this.isFunction(e);for(s=0,o=l?r.length-1:r.length;s<o;s++){if("undefined"==typeof n[r[s]])n[r[s]]={},a=!0;else if(!i&&this.isFunction(n[r[s]])&&s<o-1)throw new Error('olleh.maps.namespace: "'+r.slice(0,s+1).join(".")+'" function was previously defined in hierarchy');n=n[r[s]]}if(l){if(!i&&"undefined"!=typeof n[r[s]])throw new Error('olleh.maps.namespace: "'+t+'" definition  already exists, cannot be overridden');n[r[s]]=e,a=!0}else for(s in e)"undefined"==typeof n[s]&&e.hasOwnProperty(s)&&(n[s]=e[s],a=!0);return a},TObject:function(){var t=function(){};return t.$super=null,t.prototype.$classname="olleh.maps.TObject",t.prototype.toString=function(){return"[object ".concat(this.$classname,"]")},t.prototype.currentStack=function(){var t=this,e=arguments.callee.caller;return{toString:function(){var i=" @".concat(t.$classname);for(var s in t)if(t[s]===e)return i.concat(".",s,"();");return i}}},t.prototype.isMixinOf=function(t){for(var e=this.constructor,i=0;e.mixins&&i<e.mixins.length;i++)if(e.mixins[i]===t.prototype.$classname)return!0;return!!e.$super&&e.$super.isMixinOf(t)},t.prototype.getClass=function(){return this.constructor},t}()},t.$class=function(){function t(t){return{name:t,extend:e,mixin:i,define:s}}function e(t){if(!olleh.maps.isFunction(t))throw new Error("$class.extend: "+this.name+' cannot extend undefined class, "'+t+'"');return this.sup=t,delete this.extend,this}function i(){return this.mixins=arguments,delete this.mixin,this}function s(t){var e,i,s,r=this.sup||n.TObject,l=this.name,h=this.mixins,m=l.substring(l.lastIndexOf(".")+1),p=function(){var t,e=[],i=this;do{e.push(i),i=i.constructor.$super}while(i);for(;i=e.pop();)(t=i.$constructor)&&t.apply(this,arguments)};if(!n.namespace(l,p))throw new Error('$class.define: "'+l+'" already defined');var d=function(){};d.prototype=r.prototype,p.$super=r.prototype,p.prototype=new d,p.prototype.constructor=p,p.prototype.$constructor=null,p.prototype.$classname=l;for(var u,c=[],g=p.$super;g&&g!==n.TObject;){for(u=g.constructor,e=0,i=u.mixins?u.mixins.length:0;e<i;e++)(s=u.mixins[e].prototype)&&s.$afterDefine&&c.push(s.$afterDefine);g=g.$super}for(e=0,i=h?h.length:0;e<i;e++)0===e&&(p.mixins=[]),s=h[e].prototype,s?(p.mixins.push(s.$classname),s.$afterDefine&&c.push(s.$afterDefine)):s=h[e],n.mixin(p.prototype,s);t.$afterDefine?c.push(t.$afterDefine):p.prototype.$afterDefine&&c.push(p.prototype.$afterDefine);for(e in t.$static)t.$static.hasOwnProperty(e)&&(p[e]=t.$static[e]);for(e in t)"$static"!==e&&t.hasOwnProperty(e)&&(m==e&&(p.prototype.$constructor=t[e]),p.prototype[e]=t[e]);a&&(o(t.$static,p),o(t,p.prototype));for(var f=0;f<c.length;f++)c[f].apply(p)}var o,n=olleh.maps,a=!{toString:"foo"}.propertyIsEnumerable("toString");return a&&(o=function(t,e){if(t&&e)for(var i,s=["toLocaleString","toString","valueOf","equals"],o=s.length;o--;)i=s[o],t.hasOwnProperty(i)&&(e[i]=t[i])}),t}()}(window),olleh.maps.namespace("olleh.maps",{$skeleton:[]}),function(t){var e="https:"==location.protocol?"https:":"http:",i="https:"==e?"443":"80";olleh.maps.namespace("olleh.maps.env",{PROTOCOL:e,RESOURCE_URL:e+"//api.ktgis.com:"+i+"/ollehmap/resource/v3/",TILE_URL:{BASE:e+"//tile.gis.kt.com/current/base.default/#{z}/#{y}/#{x}.png?v=20230907",AIR:e+"//tile.gis.kt.com/current/base.satellite/#{z}/#{y}/#{x}.jpg?v=yyyymmdd",HYBRID:e+"//tile.gis.kt.com/current/overlay.hybrid/#{z}/#{y}/#{x}.png?v=20230907",ENG:e+"//tile.gis.kt.com/current/base.english/#{z}/#{y}/#{x}.png?v=20230907",TRAFFIC:e+"//roadtiledmz.ktgis.com/NTraffic/TTileServlet/256/L#{z}/R#{y}/C#{x}.png",HD_BASE:e+"//map.ktgis.com/BaseMaphd/olleh5.04.1_0511_hd/layers/_alllayers/l#{z}/r#{y}/c#{x}.png",HD_HYBRID:e+"//map.ktgis.com/HybridMaphd/olleh5.04.1_0511_hyb_hd/layers/_alllayers/l#{z}/r#{y}/c#{x}.png"},TILE_COPYRIGHT:{BASE:"© KT corp.",AIR:"© KT corp.",HD_BASE:"© KT corp."},LANG:t.$LANG||"ko",LOG_LEVEL:3})}(window),function(t){var e={en:{"일반지도":"roadmap","위성지도":"satellite","하이브리드 라벨":"hybrid label","실시간 교통":"real-time traffic","벡터":"vector","실시간교통 범례":"Real-Time Traffic Legend","원활":"fast","정체":"slow","국도,일반":"National Highway","도시고속":"Urban Expressway","고속도로":"highway","속도 정보 라인 위를 클릭하면, 상세 정보 확인 가능":"Clicking on the above line speed information, check detailed information available","시내 도로는 신호 정차 등으로 실제 속도와 다를 수 있음":"In the city roads may differ from the actual speed signal stops , etc."}};olleh.maps.namespace("olleh.maps",{msg:function(t,i){var s,i=i===undefined?olleh.maps.env.LANG:i;return"ko"===i?t:(s=e[i])?s[t]||(console.warn("unsupported key: "+t),t):(console.warn("unsupported language: "+i),t)}}),olleh.maps.namespace("olleh.maps.msg",{})}(window),olleh.maps.namespace("olleh.maps.browser",{BROWSER_NAME:{ie:"IE",firefox:"FireFox",safari:"Safari",chrome:"Chrome",opera:"Opera",chromeMobile:"Chrome",chromeForAndroid:"Chrome",chromeForIos:"Chrome",other:""},ENGINE_NAME:{webkit:"WebKit",gecko:"Gecko",presto:"Presto",trident:"Trident",other:""},OS_NAME:{ios:"iOS",android:"Android",mac:"Mac",win:"Windows",linux:"Linux",other:""},STYLE_DASH_PREFIX:{webkit:"-webkit-",gecko:"-moz-",trident:"-ms-",presto:"-o-",other:""},STYLE_PREFIX:{webkit:"webkit",gecko:"moz",trident:"ms",presto:"o",other:""},browserName:"",browserVer:"",engineName:"",engineVer:"",event:{},hasOrientationChange:"onorientationchange"in window,hasTouch:"ontouchstart"in window&&!/chrome/i.test(window.navigator.userAgent),has3D:!1,hasCanvas:!!document.createElement("canvas").getContext,hasPointerEvents:!1,hasSVG:document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),hasVML:function(){if(!document.namespaces)return!1;var t=document.createElement("div");return t.innerHTML="\x3c!--[if vml]><br><![endif]--\x3e",1==t.childNodes.length}(),isMobile:!1,isTablet:!1,osName:"",osVer:"",style:{},styleDashPrefix:"",stylePrefix:"",styleTranslateTmpl:"",vector:"",isStyleSupported:function(t){var e=olleh.maps.browser,i=document.body.style;return t in i||""!==e.stylePrefix&&e.stylePrefix+capitalize(t)in i}}),function(t){var e,i,s,o,n=olleh.maps.browser,a=document.body||document.documentElement,r=a.style,l=n.BROWSER_NAME,h=n.ENGINE_NAME,m=n.OS_NAME,p=n.STYLE_DASH_PREFIX,d=n.STYLE_PREFIX,u=t.navigator.userAgent,c={webkit:"AppleWebKit/",gecko:"Gecko/",presto:"Presto/",trident:"Trident/"},g={ie:"MSIE ",firefox:"Firefox/",chromeMobile:"CrMo",chromeForAndroid:"Android[\\W|\\w]*Chrome/",chromeForIos:"CriOS/",chrome:"Chrome/",safari:"Version/",opera:"Opera/"},f={ios:"i(?:Pad|Phone|Pod)(?:.*)CPU(?: iPhone)? OS ",android:"(Android |HTC_|Silk/)",mac:"Macintosh; Intel Mac OS X ",win:"Windows NT ",linux:"Linux; "},_={other:/Mobile/,android_tablet:/Android/,ipad:/ipad/},v=/SHW-|SHV-|GT-|SCH-|SGH-|SPH-|LG-F160|LG-F100|LG-F180|LG-F200|EK-|IM-A|LG-F240|LG-F260/,y=/SHW-M250|SHW-M420|SHW-M200|GT-S7562/,x=function(t){return t?t.charAt(0).toUpperCase()+t.substr(1):""},w=function(t){return t in r?t:null},E=function(t){return t=n.stylePrefix+x(t),t in r?t:null};for(e in g)if(i=u.match(new RegExp(g[e]+"([0-9]{1,}[.0-9]{0,})"))){n.browserName=l[e],n.browserVer=i[1];break}for(e in c)if(s=u.match(new RegExp(c[e]+"([0-9]{1,}[.0-9]{0,})"))){n.engineName=h[e],n.engineVer=s[1],n.styleDashPrefix=p[e]||"",n.stylePrefix=d[e]||"";break}for(e in f)if(o=u.match(new RegExp(f[e]+"([0-9]{1,}[.0-9]{0,})"))){n.osName=m[e],n.osVer=o[2]||o[1];break}_.other.test(u)?(n.isMobile=!0,_.ipad.test(u)&&(n.isTablet=!0)):_.android_tablet.test(u)&&(n.isMobile=!0,n.isTablet=!0),n.style={transition:E("transition")||w("transition"),transform:"Windows"==n.osName&&"Safari"==n.browserName?null:w("transform")||E("transform"),transformOrigin:w("transformOrigin")||E("transformOrigin"),backgroundSize:"Windows"==n.osName&&"Chrome"==n.browserName?null:w("backgroundSize"),opacity:"Android"==n.osName&&n.osVer>="4.2.2"&&n.osVer<"4.3"?null:w("opacity"),userSelect:w("userSelect")||E("userSelect")||{get:function(t){return"on"==t.getAttribute("unselectable")?"none":"auto"},set:function(t,e){"none"===e?t.setAttribute("unselectable","on"):t.removeAttribute("unselectable")}}},n.event={transitionend:function(){var t=n.style.transition;return t?"transition"==t||"msTransition"==t?"transitionend":"oTransition"==t&&parseFloat(n.browserVer)>=12?"otransitionend":t+"End":null}()},n.isHD=!1,n.isHDTile=function(){return!!n.isHD&&("Android"!=n.osName||n.osVer>="4.3")}(),n.has3D=function(){if(!n.style.transform)return!1;if(!w("perspective")&&!E("perspective"))return!1;if("Android"==n.osName){if(n.osVer<"4.0.3")return!1;if(n.osVer<"4.1.0"&&(!v.test(u)||y.test(u)))return!1;if(n.osVer<"4.1.0"&&"Chrome"===n.browserName)return!1}return!0}(),n.usePulseForZoom=!n.isMobile,n.use3DRootPane=function(){return!!n.has3D&&("Android"!=n.osName&&("iOS"==n.osName||"Safari"!=n.browserName))}(),n.hotfixAndroid=function(){if("Android"!==n.osName)return!1;var t=n.browserVer;if(t){var e=t.split(".");if((e.length>0?e[0]:0)<43)return!0}return!1}(),n.hasPointerEvents="pointer-events"in r&&n.browserName!==n.BROWSER_NAME.ie,n.vector=n.hasSVG?"SVG":n.hasCanvas?"Canvas":n.hasVML?"VML":"",n.styleTranslateTmpl=n.has3D?"translate3d(#{x}px,#{y}px,0)":"translate(#{x}px,#{y}px)",n.styleScaleTmpl=n.has3D?"scale3d(#{scale}, #{scale}, 1)":"scale(#{scale}, #{scale})"}(window),olleh.maps.namespace("olleh.maps",{log:function(t,e,i,s){if(olleh.maps.isUndefined(window.console))return t;var o,n,a,r=this.log.config,l=this.log.LEVEL;if(r){if((a=r.$tag)&&a.length&&-1==olleh.maps.util.indexOf(a,s.$tag))return;if(i&&(o=i.$classname)&&(n=o.substring(0,o.lastIndexOf("."))),o&&""!==o&&r[o])l=r[o];else if(n&&""!==n)for(;""!==n&&!(l=r[n]);)n=n.substring(0,n.lastIndexOf("."));l=l||this.log.LEVEL}return l<=(olleh.maps.isUndefined(e)?olleh.maps.log.DEBUG:e)&&(e==this.log.DEBUG&&(t="["+(new Date).getMilliseconds()+"] "+t),this.isString(i)?t="["+i+"] "+t:this.isObject(i)&&i.$classname&&(t="["+i.$classname+"] "+t),console.log(t)),t}}),olleh.maps.namespace("olleh.maps.log",{LEVEL:olleh.maps.env.LOG_LEVEL!==undefined?olleh.maps.env.LOG_LEVEL:3,DEBUG:1,INFO:2,WARN:3,ERROR:4,FATAL:5,NONE:6,config:{},isLevel:function(t){return this.LEVEL<=t},debug:function(t,e,i){this.call(olleh.maps,t,this.DEBUG,e,i)},info:function(t,e,i){this.call(olleh.maps,t,this.INFO,e,i)},warn:function(t,e,i){this.call(olleh.maps,t,this.WARN,e,i)},error:function(t,e,i){this.call(olleh.maps,t,this.ERROR,e,i)},fatal:function(t,e,i){this.call(olleh.maps,t,this.FATAL,e,i)}}),olleh.maps.namespace("olleh.maps.util",{DEFAULT_PRECISION:14,INCHES_PER_UNIT:function(){var t={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36,nmi:72913.4252,"in":1,degrees:4374754};return olleh.maps.mixin(t,{Inch:1,Meter:39.37,Foot:12,IFoot:11.999976,ClarkeFoot:11.999868327581488,SearsFoot:11.999955194477684,GoldCoastFoot:11.999964589846002,IInch:.9999979999999999,MicroInch:999998e-9,Mil:9.99998e-7,Centimeter:.3937,Kilometer:39370,Yard:36,SearsYard:35.99986558343306,IndianYard:35.99987015540864,IndianYd37:35.999740205100004,IndianYd62:35.999880755999996,IndianYd75:35.999868945,IndianFoot:11.9999567087,IndianFt37:11.9999134017,IndianFt62:11.999960252000001,IndianFt75:11.999956315,Mile:63360,IYard:35.999928,IMile:63359.87328,NautM:72913.24,"Lat-66":4367838.370169282,"Lat-83":4367954.152606599,Decimeter:3.9370000000000003,Millimeter:.03937,Dekameter:393.7,Decameter:393.7,Hectometer:3937,GermanMeter:39.370535294205006,CaGrid:39.359685060000004,ClarkeChain:791.991309620512,GunterChain:792.0000000000001,BenoitChain:791.9977268035781,SearsChain:791.9970428354235,ClarkeLink:7.91991309620512,GunterLink:7.920000000000001,BenoitLink:7.919977268035781,SearsLink:7.919970428354236,Rod:198.00000000000014,IntnlChain:791.998416,IntnlLink:7.91998416,Perch:198.00000000000014,Pole:198.00000000000014,Furlong:7919.999999999997,Rood:148.75036777426,CapeFoot:11.999868185255002,Brealey:14763.75,ModAmFt:12.000458400000001,Fathom:71.999856,"NautM-UK":72959.85408,"50kilometers":1968500,"150kilometers":5905500}),olleh.maps.mixin(t,{mm:t.Meter/1e3,cm:t.Meter/100,dm:100*t.Meter,km:1e3*t.Meter,kmi:t.nmi,fath:t.Fathom,ch:t.IntnlChain,link:t.IntnlLink,"us-in":t.inches,"us-ft":t.Foot,"us-yd":t.Yard,"us-ch":t.GunterChain,"us-mi":t.Mile,"ind-yd":t.IndianYd37,"ind-ft":t.IndianFt37,"ind-ch":791.9942845122}),t}(),DOTS_PER_INCH:72,_ID_SEED:(new Date).getTime(),genId:function(t){return(olleh.maps.isUndefined(t)?"ollehmap":t||"")+ ++olleh.maps.util._ID_SEED},radToDeg:function(t){return 180*t/Math.PI},degToRad:function(t){return t*Math.PI/180},toFloat:function(t,e){if(olleh.maps.isString(t)&&(t=parseFloat(t)),!olleh.maps.isNumber(t))throw new TypeError("Specified num is not Number type: "+t);return e=e||olleh.maps.util.DEFAULT_PRECISION,0===e?t:parseFloat(t.toPrecision(e))},getResolutionFromScale:function(t,e){if(!olleh.maps.isNumber(t))throw new TypeError("Specified scale is not Number type: "+t);var i;if(t){e=e||"Meter";i=1/((t>1?1/t:t)*this.INCHES_PER_UNIT[e]*this.DOTS_PER_INCH)}return i},getScaleFromResolution:function(t,e){if(!olleh.maps.isNumber(t))throw new TypeError("Specified resolution is not Number type: "+t);return t*this.INCHES_PER_UNIT[e||"Meter"]*this.DOTS_PER_INCH},applyTemplate:function(t,e){for(var i,s,o=/#\{(\w+)\}/g;i=o.exec(t);)(s=e[i[1]])!==undefined&&null!==s&&(t=t.replace(new RegExp(i[0],"g"),s),o.lastIndex=i.index);return t},indexOf:function(t,e,i){var s=t.indexOf;if(s)return s.call(t,e,i);if(!olleh.maps.isArray(t))throw new TypeError;var o=t.length;if(0===o)return-1;var n=0;if(arguments.length>2&&(n=Number(i),n!=n?n=0:0!=n&&n!=Infinity&&n!=-Infinity&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=o)return-1;for(var a=n>=0?n:Math.max(o-Math.abs(n),0);a<o;a++)if(t[a]===e)return a;return-1},lastIndexOf:function(t,e,i){var s=t.lastIndexOf;if(s)return s.call(t,e,olleh.maps.isNumber(i)?i:-1);if(!olleh.maps.isArray(t))throw new TypeError;var o=t.length;if(0===o)return-1;var n=o;arguments.length>2&&(n=Number(i),n!=n?n=0:0!=n&&n!=Infinity&&n!=-Infinity&&(n=(n>0||-1)*Math.floor(Math.abs(n))));for(var a=n>=0?Math.min(n,o-1):o-Math.abs(n);a>=0;a--)if(t[a]===e)return a;return-1},removeFromArray:function(t,e){var i=olleh.maps.util.indexOf(t,e);return i>-1&&t.splice(i,1),i},trim:function(t){var e=t.trim;if(e)return e.call(t);for(var i=t.replace(/^\s+/,""),s=i.length-1,o=/\s/;o.test(i.charAt(s));)s--;return i.slice(0,s+1)},copyOpts:function(t,e,i){var s;for(s in e)!e.hasOwnProperty(s)||i&&-1!==olleh.maps.util.indexOf(i,s)||(t[s]=e[s]);return t},clone:function(t){var e,i;if(null==t)i=null;else if(olleh.maps.isObject(t))if(olleh.maps.isArray(t))for(i=[],e=0;e<t.length;e++)i[e]=olleh.maps.util.clone(t[e]);else if(olleh.maps.isDate(t))i=new Date(t.getTime());else if(olleh.maps.isRegExp(t))i=new RegExp(t.source);else if(t.clone)i=t.clone();else{i={};for(e in t)t.hasOwnProperty(e)&&(i[e]=t[e])}else i=t;return i},startsWith:function(t,e){return t.slice(0,e.length)===e},delay:function(t,e,i,s){s=Array.prototype.slice.call(arguments,3);var o=Function.prototype.bind.apply(t,[i].concat(s));return window.setTimeout(o,e)},defer:function(t,e,i){return i=Array.prototype.slice.call(arguments,2),olleh.maps.util.delay.apply(this,[t,1,e].concat(i))},deferAF:function(t,e,i){i=Array.prototype.slice.call(arguments,2);var s=olleh.maps.curry.apply(this,[t,e].concat(i));return window.requestAnimationFrame(s)}}),olleh.maps.namespace("olleh.maps.util.dom",{CSS_UNITS:["in","cm","mm","em","ex","pt","pc","px"],getStyle:function(t,e){return olleh.maps.isElement(t)?(e=olleh.maps.browser.style[e]||e,e.get?e.get(t):t.style[e]):void olleh.maps.log.error("Specified elem is not HTML Element: "+t)},getComputedStyle:function(t,e){var i,s=olleh.maps.util.dom,o=null,n=olleh.maps.browser.style;return n[e]&&(e=n[e],e.get)?e.get(t):(t.currentStyle?"auto"==(o=t.currentStyle[e])&&(i=s.hyphenToCamelCase("offset-"+e),o=i in t?t[i]:"0"):window.getComputedStyle&&(o=document.defaultView.getComputedStyle(t,null).getPropertyValue(s.camelCaseToHyphen(e))),"none"==o&&"transform"==e&&(o="matrix(1,0,0,1,0,0)"),o||s.getStyle(t,e))},setStyle:function(t,e,i){if(!olleh.maps.isElement(t))return void olleh.maps.log.error("Specified elem is not HTML Element: "+t);var s=olleh.maps.browser.style;if(s[e]&&(e=s[e],e.set))return void e.set(t,i);t.style[e]=i},setStyles:function(t,e){var i=olleh.maps.util.dom.setStyle;for(var s in e)i(t,s,e[s])},addClass:function(t,e){if(!t||!e)return!1;var i=t.classList;return i?(i.add(e),!0):!(!olleh.maps.isString(t.className)||olleh.maps.util.dom.hasClass(t,e))&&(t.className+=(t.className?" ":"")+e,!0)},hasClass:function(t,e){if(t){var i=t.classList;if(i)return i.contains(e);var s=t.className;return olleh.maps.isString(s)&&s.length>0&&(s==e||new RegExp("\\b"+e+"\\b").test(s))}return!1},removeClass:function(t,e){if(t&&e){var i=t.classList;return i?i.remove(e):olleh.maps.isString(t.className)&&(t.className=t.className.replace(new RegExp("(^|\\s+)"+e+"(\\s+|$)")," ").replace(/^\s+/,"").replace(/\s+$/,"")),!0}return!1},replaceClass:function(t,e,i){if(t){var s=t.classList;if(s)e&&s.remove(e),s.add(i);else{var o=olleh.maps.util.dom;o.hasClass(t,e)?t.className=t.className.replace(new RegExp("(^|\\s+)"+e+"(\\s+|$)")," "+i).replace(/^\s+/,"").replace(/\s+$/,""):o.addClass(t,i)}return!0}return!1},toggleClass:function(t,e){var i=olleh.maps.util.dom;return i.hasClass(t,e)?i.removeClass(t,e):i.addClass(t,e)},elementOf:function(t){return t?document.getElementById(t):null},pushElement:function(t,e){return t.children&&t.children[0]?null!==t.insertBefore(e,t.children[0]):null!==t.appendChild(e)},popElement:function(t,e){return t||(t=e.parent),t&&e&&t.removeChild(e)?e:null},removeElements:function(t){var e,i,s,o,n,a=olleh.maps.util.dom;if(1===arguments.length&&t.parentNode)return t.parentNode.removeChild(t);if(arguments.length>1?o=arguments:!olleh.maps.isString(t)&&t.length&&(o=t),n=[],o)for(e=o.length;e--;)i=o[e],s=null,i.length?s=a.removeElements(i):i.parentNode&&(s=i.parentNode.removeChild(i)),olleh.maps.isArray(s)?n.unshift.apply(n,s):s&&n.unshift(s);return n},extractValueFromStyle:function(t){try{var e=parseFloat(t);return isNaN(e)?0:e}catch(i){return 0}},extractUnitFromStyle:function(t){if(""===t)return"";var e=olleh.maps.util.dom.extractValueFromStyle(t);return t.replace(e,"")},getTranslateString:function(t,e,i){var s=olleh.maps.browser.has3D&&!1!==i?"translate3d(#{x}px, #{y}px, 0px)":"translate(#{x}px, #{y}px)";return olleh.maps.util.applyTemplate(s,{x:t,y:e})},getScaleString:function(t,e){var i=olleh.maps.browser.has3D&&!1!==e?"scale3d(#{scale}, #{scale}, 1)":"scale(#{scale}, #{scale})";return olleh.maps.util.applyTemplate(i,{scale:t})},getPositionStyles:function(t,e,i,s){return!1!==i&&olleh.maps.browser.style.transform?{transform:olleh.maps.util.dom.getTranslateString(t,e,s)}:{left:t+"px",top:e+"px"}},getPointFromStyle:function(t){var e=0,i=0;if(t.transform){var s=olleh.maps.util.dom.parseStyleValue(t.transform);t:for(var o=0;o<s.length;o++){var n=s[o].params;switch(s[o].name){case"translate":case"translate3d":e=n[0].value,i=n[1].value;break t;case"matrix":e=n[4].value,i=n[5].value;break t;case"matrix3d":e=n[12].value,i=n[13].value;break t}}}else t.left&&(e=t.left),t.top&&(i=t.top);return new olleh.maps.Point(parseFloat(e),parseFloat(i))},getXY:function(t){var e=window.webkitConvertPointFromNodeToPage;if(e){var i=e(t,new WebKitPoint(0,0));return new olleh.maps.Point(i.x,i.y)}var s=t.getBoundingClientRect(),o=0,n=0;if(olleh.maps.isNumber(window.pageXOffset)&&olleh.maps.isNumber(window.pageYOffset))o=window.pageXOffset,n=window.pageYOffset;else{var a=document.body,r=olleh.maps.browser,l=r.browserName===r.BROWSER_NAME.ie&&r.browserVer<9;o=a.scrollLeft,n=a.scrollTop+l?document.documentElement.scrollTop:0}return new olleh.maps.Point(s.left+o,s.top+n)._round()},hyphenToCamelCase:function(t){return 0===t.lastIndexOf("-",0)&&(t=t.substr(1)),t.replace(/-([a-z])/g,olleh.maps.util.dom._cbHyphenToCamelCase)},_cbHyphenToCamelCase:function(t,e){return e.toUpperCase()},camelCaseToHyphen:function(t){var e=t.replace(/([A-Z])/g,olleh.maps.util.dom._cbCamelCaseToHyphen);return 0!==e.lastIndexOf("webkit-",0)&&0!==e.lastIndexOf("moz-",0)&&0!==e.lastIndexOf("ms-",0)&&0!==e.lastIndexOf("o-",0)||(e="-"+e),e},_cbCamelCaseToHyphen:function(t,e){return"-"+e.toLowerCase()},parseStyleValue:function(t){var e,i,s=olleh.maps.util.trim,o=olleh.maps.util.dom.getUnitAndValue,n=[],a=[],r=[],l=null;if(!t)return a;for(t=""+t,e=0;e<t.length;e++)i=t.charAt(e),"("!=i?")"!=i?","==i&&l?n.length>0&&(r.push(o(s(n.join("")))),n=[]):" "!=i||l?n.push(i):n.length>0&&(a.push(o(n.join(""))),n=[]):(n.length>0&&(r.push(o(s(n.join("")))),n=[]),a.push({name:l,params:r}),l=null,r=[]):(l=s(n.join("")),n.length=0);return n.length>0&&a.push(o(n.join(""))),a},parsedStyleToString:function(t){var e,i,s,o,n=[];if(!t)return"";for(e=0;e<t.length;e++)if(s=t[e],s.name){for(o=[],i=0;i<s.params.length;i++)o.push(s.params[i].value+s.params[i].unit);n.push(s.name+"("+o.join(", ")+")")}else n.push(s.value+s.unit);return n.join(" ")},getUnitAndValue:function(t){var e,i,s,o,n=olleh.maps.util.dom.CSS_UNITS;return""==t?{unit:"",value:""}:("%"==t.slice(-1)?(i="%",s=t.slice(0,-1)):(e=olleh.maps.util.indexOf(n,t.slice(-2)),-1==e?(i="",s=t):(i=n[e],s=t.slice(0,-2))),o=parseFloat(s),o!=s?{unit:"",value:s+i}:{unit:i,value:o})}}),$class("olleh.maps.Adaptable").define({isAttached:function(){return!!this.map},getMap:function(){return this.map},setMap:function(t){this.map!=t&&(this.map&&(this._unregisterService(),this.detach()),this.map=t,this.map&&(this._registerService(),this.attach()))},_unregisterService:function(){this.serviceId&&this.map.services[this.serviceId]===this&&delete this.map.services[this.serviceId]},_registerService:function(){this.serviceId&&(this.map.services[this.serviceId]?olleh.maps.log("[Warning] Duplicate service id: "+this.serviceId):this.map.services[this.serviceId]=this)},attach:function(){},detach:function(){}}),$class("olleh.maps.Plugin").mixin(olleh.maps.Adaptable).define({setPluginInfo:function(t){var e=olleh.maps.util.clone(this.pluginInfo);this.pluginInfo=olleh.maps.mixin(e,t,!0)},setMap:function(t){if(this.map!=t&&(this.map&&(this._unregisterService(),this.map.pluginRegistry.remove(this),this.deactivate(),this.detach()),this.map=t,t&&(this._registerService(),this.map.pluginRegistry.add(this),this.attach(),this.pluginInfo&&this.pluginInfo.autoActivate)))if(t.isStarted())this.activate();else{var e=function(){this.activate(),this.map.unsubscribeEvent(e)};t.onEvent("started",e,this)}},isActive:function(){return!!this._active},activate:function(){this.isAttached()&&!this.isActive()&&(this.map&&this.pluginInfo&&this.pluginInfo.drawingTool&&this.map.pluginRegistry.drawingToolActivate(this),this.doActivate(),this.setActive(!0))},setActive:function(t){this._active=t,this.map&&this.map.pluginRegistry.fireEvent("plugin_state_changed",{plugin:this,active:t})},deactivate:function(){this.isAttached()&&this.isActive()&&(this.doDeactivate(),this.setActive(!1))},doActivate:function(){},doDeactivate:function(){}}),$class("olleh.maps.Initializable").define({Initializable:function(){var t=this.$constructor;this.$constructor=t?function(){t.apply(this,arguments),this.init()}:this.init},init:function(){}});var Proj4js={defaultDatum:"WGS84",transform:function(t,e,i){if(!t.readyToUse)return this.reportError("Proj4js initialization for:"+t.srsCode+" not yet complete"),i;if(!e.readyToUse)return this.reportError("Proj4js initialization for:"+e.srsCode+" not yet complete"),i;if(t.datum&&e.datum&&((t.datum.datum_type==Proj4js.common.PJD_3PARAM||t.datum.datum_type==Proj4js.common.PJD_7PARAM)&&"WGS84"!=e.datumCode||(e.datum.datum_type==Proj4js.common.PJD_3PARAM||e.datum.datum_type==Proj4js.common.PJD_7PARAM)&&"WGS84"!=t.datumCode)){var s=Proj4js.WGS84;this.transform(t,s,i),t=s}return"enu"!=t.axis&&this.adjust_axis(t,!1,i),"longlat"==t.projName?(i.x*=Proj4js.common.D2R,i.y*=Proj4js.common.D2R):(t.to_meter&&(i.x*=t.to_meter,i.y*=t.to_meter),t.inverse(i)),t.from_greenwich&&(i.x+=t.from_greenwich),i=this.datum_transform(t.datum,e.datum,i),e.from_greenwich&&(i.x-=e.from_greenwich),"longlat"==e.projName?(i.x*=Proj4js.common.R2D,i.y*=Proj4js.common.R2D):(e.forward(i),e.to_meter&&(i.x/=e.to_meter,i.y/=e.to_meter)),"enu"!=e.axis&&this.adjust_axis(e,!0,i),i},datum_transform:function(t,e,i){return t.compare_datums(e)?i:t.datum_type==Proj4js.common.PJD_NODATUM||e.datum_type==Proj4js.common.PJD_NODATUM?i:(t.es==e.es&&t.a==e.a&&t.datum_type!=Proj4js.common.PJD_3PARAM&&t.datum_type!=Proj4js.common.PJD_7PARAM&&e.datum_type!=Proj4js.common.PJD_3PARAM&&e.datum_type!=Proj4js.common.PJD_7PARAM||(t.geodetic_to_geocentric(i),t.datum_type!=Proj4js.common.PJD_3PARAM&&t.datum_type!=Proj4js.common.PJD_7PARAM||t.geocentric_to_wgs84(i),e.datum_type!=Proj4js.common.PJD_3PARAM&&e.datum_type!=Proj4js.common.PJD_7PARAM||e.geocentric_from_wgs84(i),e.geocentric_to_geodetic(i)),i)},adjust_axis:function(t,e,i){for(var s,o,n=i.x,a=i.y,r=i.z||0,l=0;l<3;l++)if(!e||2!=l||i.z!==undefined)switch(0==l?(s=n,o="x"):1==l?(s=a,o="y"):(s=r,o="z"),t.axis[l]){case"e":i[o]=s;break;case"w":i[o]=-s;break;case"n":i[o]=s;break;case"s":i[o]=-s;break;case"u":i[o]!==undefined&&(i.z=s);break;case"d":i[o]!==undefined&&(i.z=-s);break;default:return alert("ERROR: unknow axis ("+t.axis[l]+") - check definition of "+t.projName),null}return i},reportError:function(t){},extend:function(t,e){if(t=t||{},e)for(var i in e){var s=e[i];s!==undefined&&(t[i]=s)}return t},Class:function(){for(var t,e=function(){this.initialize.apply(this,arguments)},i={},s=0;s<arguments.length;++s)t="function"==typeof arguments[s]?arguments[s].prototype:arguments[s],Proj4js.extend(i,t);return e.prototype=i,e},bind:function(t,e){var i=Array.prototype.slice.apply(arguments,[2]);return function(){var s=i.concat(Array.prototype.slice.apply(arguments,[0]));return t.apply(e,s)}},scriptName:"proj4js.js",defsLookupService:"http://spatialreference.org/ref",libPath:null,getScriptLocation:function(){if(this.libPath)return this.libPath;for(var t=this.scriptName,e=t.length,i=document.getElementsByTagName("script"),s=0;s<i.length;s++){var o=i[s].getAttribute("src");if(o){var n=o.lastIndexOf(t);if(n>-1&&n+e==o.length){this.libPath=o.slice(0,-e);break}}}return this.libPath||""},loadScript:function(t,e,i,s){var o=document.createElement("script");o.defer=!1,o.type="text/javascript",o.id=t,o.src=t,o.onload=e,o.onerror=i,o.loadCheck=s,/MSIE/.test(navigator.userAgent)&&(o.onreadystatechange=this.checkReadyState),document.getElementsByTagName("head")[0].appendChild(o)},checkReadyState:function(){"loaded"==this.readyState&&(this.loadCheck()?this.onload():this.onerror())}};Proj4js.Proj=Proj4js.Class({readyToUse:!1,title:null,projName:null,units:null,datum:null,x0:0,y0:0,localCS:!1,queue:null,initialize:function(t,e){if(this.srsCodeInput=t,this.queue=[],e&&this.queue.push(e),t.indexOf("GEOGCS")>=0||t.indexOf("GEOCCS")>=0||t.indexOf("PROJCS")>=0||t.indexOf("LOCAL_CS")>=0)return this.parseWKT(t),this.deriveConstants(),void this.loadProjCode(this.projName);if(0==t.indexOf("urn:")){var i=t.split(":");"ogc"!=i[1]&&"x-ogc"!=i[1]||"def"!=i[2]||"crs"!=i[3]||(t=i[4]+":"+i[i.length-1])}else if(0==t.indexOf("http://")){var s=t.split("#");s[0].match(/epsg.org/)?t="EPSG:"+s[1]:s[0].match(/RIG.xml/)&&(t="IGNF:"+s[1])}this.srsCode=t.toUpperCase(),0==this.srsCode.indexOf("EPSG")?(this.srsCode=this.srsCode,this.srsAuth="epsg",this.srsProjNumber=this.srsCode.substring(5)):0==this.srsCode.indexOf("IGNF")?(this.srsCode=this.srsCode,this.srsAuth="IGNF",this.srsProjNumber=this.srsCode.substring(5)):0==this.srsCode.indexOf("CRS")?(this.srsCode=this.srsCode,this.srsAuth="CRS",this.srsProjNumber=this.srsCode.substring(4)):(this.srsAuth="",this.srsProjNumber=this.srsCode),this.loadProjDefinition()},loadProjDefinition:function(){if(Proj4js.defs[this.srsCode])return void this.defsLoaded();var t=Proj4js.getScriptLocation()+"defs/"+this.srsAuth.toUpperCase()+this.srsProjNumber+".js";Proj4js.loadScript(t,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.loadFromService,this),Proj4js.bind(this.checkDefsLoaded,this))},loadFromService:function(){var t=Proj4js.defsLookupService+"/"+this.srsAuth+"/"+this.srsProjNumber+"/proj4js/";Proj4js.loadScript(t,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.defsFailed,this),Proj4js.bind(this.checkDefsLoaded,this))},defsLoaded:function(){this.parseDefs(),this.loadProjCode(this.projName)},checkDefsLoaded:function(){return!!Proj4js.defs[this.srsCode]},defsFailed:function(){Proj4js.reportError("failed to load projection definition for: "+this.srsCode),Proj4js.defs[this.srsCode]=Proj4js.defs.WGS84,this.defsLoaded()},loadProjCode:function(t){if(Proj4js.Proj[t])return void this.initTransforms();var e=Proj4js.getScriptLocation()+"projCode/"+t+".js"
;Proj4js.loadScript(e,Proj4js.bind(this.loadProjCodeSuccess,this,t),Proj4js.bind(this.loadProjCodeFailure,this,t),Proj4js.bind(this.checkCodeLoaded,this,t))},loadProjCodeSuccess:function(t){Proj4js.Proj[t].dependsOn?this.loadProjCode(Proj4js.Proj[t].dependsOn):this.initTransforms()},loadProjCodeFailure:function(t){Proj4js.reportError("failed to find projection file for: "+t)},checkCodeLoaded:function(t){return!!Proj4js.Proj[t]},initTransforms:function(){if(Proj4js.extend(this,Proj4js.Proj[this.projName]),this.init(),this.readyToUse=!0,this.queue)for(var t;t=this.queue.shift();)t.call(this,this)},wktRE:/^(\w+)\[(.*)\]$/,parseWKT:function(t){var e=t.match(this.wktRE);if(e){var i,s=e[1],o=e[2],n=o.split(",");i="TOWGS84"==s.toUpperCase()?s:n.shift(),i=i.replace(/^\"/,""),i=i.replace(/\"$/,"");for(var a=new Array,r=0,l="",h=0;h<n.length;++h){for(var m=n[h],p=0;p<m.length;++p)"["==m.charAt(p)&&++r,"]"==m.charAt(p)&&--r;l+=m,0===r?(a.push(l),l=""):l+=","}switch(s){case"LOCAL_CS":this.projName="identity",this.localCS=!0,this.srsCode=i;break;case"GEOGCS":this.projName="longlat",this.geocsCode=i,this.srsCode||(this.srsCode=i);break;case"PROJCS":this.srsCode=i;break;case"GEOCCS":break;case"PROJECTION":this.projName=Proj4js.wktProjections[i];break;case"DATUM":this.datumName=i;break;case"LOCAL_DATUM":this.datumCode="none";break;case"SPHEROID":this.ellps=i,this.a=parseFloat(a.shift()),this.rf=parseFloat(a.shift());break;case"PRIMEM":this.from_greenwich=parseFloat(a.shift());break;case"UNIT":this.units=i,this.unitsPerMeter=parseFloat(a.shift());break;case"PARAMETER":var d=i.toLowerCase(),u=parseFloat(a.shift());switch(d){case"false_easting":this.x0=u;break;case"false_northing":this.y0=u;break;case"scale_factor":this.k0=u;break;case"central_meridian":this.long0=u*Proj4js.common.D2R;break;case"latitude_of_origin":this.lat0=u*Proj4js.common.D2R}break;case"TOWGS84":this.datum_params=a;break;case"AXIS":var d=i.toLowerCase(),u=a.shift();switch(u){case"EAST":u="e";break;case"WEST":u="w";break;case"NORTH":u="n";break;case"SOUTH":u="s";break;case"UP":u="u";break;case"DOWN":u="d";break;case"OTHER":default:u=" "}switch(this.axis||(this.axis="enu"),d){case"x":this.axis=u+this.axis.substr(1,2);break;case"y":this.axis=this.axis.substr(0,1)+u+this.axis.substr(2,1);break;case"z":this.axis=this.axis.substr(0,2)+u}}for(var h=0;h<a.length;++h)this.parseWKT(a[h])}},parseDefs:function(){this.defData=Proj4js.defs[this.srsCode];var t,e;if(this.defData){for(var i=this.defData.split("+"),s=0;s<i.length;s++){var o=i[s].split("=");switch(t=o[0].toLowerCase(),e=o[1],t.replace(/\s/gi,"")){case"":break;case"title":this.title=e;break;case"proj":this.projName=e.replace(/\s/gi,"");break;case"units":this.units=e.replace(/\s/gi,"");break;case"datum":this.datumCode=e.replace(/\s/gi,"");break;case"nadgrids":this.nagrids=e.replace(/\s/gi,"");break;case"ellps":this.ellps=e.replace(/\s/gi,"");break;case"a":this.a=parseFloat(e);break;case"b":this.b=parseFloat(e);break;case"rf":this.rf=parseFloat(e);break;case"lat_0":this.lat0=e*Proj4js.common.D2R;break;case"lat_1":this.lat1=e*Proj4js.common.D2R;break;case"lat_2":this.lat2=e*Proj4js.common.D2R;break;case"lat_ts":this.lat_ts=e*Proj4js.common.D2R;break;case"lon_0":this.long0=e*Proj4js.common.D2R;break;case"alpha":this.alpha=parseFloat(e)*Proj4js.common.D2R;break;case"lonc":this.longc=e*Proj4js.common.D2R;break;case"x_0":this.x0=parseFloat(e);break;case"y_0":this.y0=parseFloat(e);break;case"k_0":case"k":this.k0=parseFloat(e);break;case"r_a":this.R_A=!0;break;case"zone":this.zone=parseInt(e,10);break;case"south":this.utmSouth=!0;break;case"towgs84":this.datum_params=e.split(",");break;case"to_meter":this.to_meter=parseFloat(e);break;case"from_greenwich":this.from_greenwich=e*Proj4js.common.D2R;break;case"pm":e=e.replace(/\s/gi,""),this.from_greenwich=Proj4js.PrimeMeridian[e]?Proj4js.PrimeMeridian[e]:parseFloat(e),this.from_greenwich*=Proj4js.common.D2R;break;case"axis":e=e.replace(/\s/gi,"");var n="ewnsud";3==e.length&&-1!=n.indexOf(e.substr(0,1))&&-1!=n.indexOf(e.substr(1,1))&&-1!=n.indexOf(e.substr(2,1))&&(this.axis=e)}}this.deriveConstants()}},deriveConstants:function(){if("@null"==this.nagrids&&(this.datumCode="none"),this.datumCode&&"none"!=this.datumCode){var t=Proj4js.Datum[this.datumCode];t&&(this.datum_params=t.towgs84?t.towgs84.split(","):null,this.ellps=t.ellipse,this.datumName=t.datumName?t.datumName:this.datumCode)}if(!this.a){var e=Proj4js.Ellipsoid[this.ellps]?Proj4js.Ellipsoid[this.ellps]:Proj4js.Ellipsoid.WGS84;Proj4js.extend(this,e)}this.rf&&!this.b&&(this.b=(1-1/this.rf)*this.a),(0===this.rf||Math.abs(this.a-this.b)<Proj4js.common.EPSLN)&&(this.sphere=!0,this.b=this.a),this.a2=this.a*this.a,this.b2=this.b*this.b,this.es=(this.a2-this.b2)/this.a2,this.e=Math.sqrt(this.es),this.R_A&&(this.a*=1-this.es*(Proj4js.common.SIXTH+this.es*(Proj4js.common.RA4+this.es*Proj4js.common.RA6)),this.a2=this.a*this.a,this.b2=this.b*this.b,this.es=0),this.ep2=(this.a2-this.b2)/this.b2,this.k0||(this.k0=1),this.axis||(this.axis="enu"),this.datum=new Proj4js.datum(this)}}),Proj4js.Proj.longlat={init:function(){},forward:function(t){return t},inverse:function(t){return t}},Proj4js.Proj.identity=Proj4js.Proj.longlat,Proj4js.defs={WGS84:"+title=long/lat:WGS84 +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4326":"+title=long/lat:WGS84 +proj=longlat +a=6378137.0 +b=6356752.31424518 +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4269":"+title=long/lat:NAD83 +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees","EPSG:3875":"+title= Google Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"},Proj4js.defs["EPSG:3785"]=Proj4js.defs["EPSG:3875"],Proj4js.defs.GOOGLE=Proj4js.defs["EPSG:3875"],Proj4js.defs["EPSG:900913"]=Proj4js.defs["EPSG:3875"],Proj4js.defs["EPSG:102113"]=Proj4js.defs["EPSG:3875"],Proj4js.common={PI:3.141592653589793,HALF_PI:1.5707963267948966,TWO_PI:6.283185307179586,FORTPI:.7853981633974483,R2D:57.29577951308232,D2R:.017453292519943295,SEC_TO_RAD:484813681109536e-20,EPSLN:1e-10,MAX_ITER:20,COS_67P5:.3826834323650898,AD_C:1.0026,PJD_UNKNOWN:0,PJD_3PARAM:1,PJD_7PARAM:2,PJD_GRIDSHIFT:3,PJD_WGS84:4,PJD_NODATUM:5,SRS_WGS84_SEMIMAJOR:6378137,SIXTH:.16666666666666666,RA4:.04722222222222222,RA6:.022156084656084655,RV4:.06944444444444445,RV6:.04243827160493827,msfnz:function(t,e,i){var s=t*e;return i/Math.sqrt(1-s*s)},tsfnz:function(t,e,i){var s=t*i,o=.5*t;return s=Math.pow((1-s)/(1+s),o),Math.tan(.5*(this.HALF_PI-e))/s},phi2z:function(t,e){for(var i,s,o=.5*t,n=this.HALF_PI-2*Math.atan(e),a=0;a<=15;a++)if(i=t*Math.sin(n),s=this.HALF_PI-2*Math.atan(e*Math.pow((1-i)/(1+i),o))-n,n+=s,Math.abs(s)<=1e-10)return n;return alert("phi2z has NoConvergence"),-9999},qsfnz:function(t,e){var i;return t>1e-7?(i=t*e,(1-t*t)*(e/(1-i*i)-.5/t*Math.log((1-i)/(1+i)))):2*e},asinz:function(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)},e0fn:function(t){return 1-.25*t*(1+t/16*(3+1.25*t))},e1fn:function(t){return.375*t*(1+.25*t*(1+.46875*t))},e2fn:function(t){return.05859375*t*t*(1+.75*t)},e3fn:function(t){return t*t*t*(35/3072)},mlfn:function(t,e,i,s,o){return t*o-e*Math.sin(2*o)+i*Math.sin(4*o)-s*Math.sin(6*o)},srat:function(t,e){return Math.pow((1-t)/(1+t),e)},sign:function(t){return t<0?-1:1},adjust_lon:function(t){return t=Math.abs(t)<this.PI?t:t-this.sign(t)*this.TWO_PI},adjust_lat:function(t){return t=Math.abs(t)<this.HALF_PI?t:t-this.sign(t)*this.PI},latiso:function(t,e,i){if(Math.abs(e)>this.HALF_PI)return+Number.NaN;if(e==this.HALF_PI)return Number.POSITIVE_INFINITY;if(e==-1*this.HALF_PI)return-1*Number.POSITIVE_INFINITY;var s=t*i;return Math.log(Math.tan((this.HALF_PI+e)/2))+t*Math.log((1-s)/(1+s))/2},fL:function(t,e){return 2*Math.atan(t*Math.exp(e))-this.HALF_PI},invlatiso:function(t,e){var i=this.fL(1,e),s=0,o=0;do{s=i,o=t*Math.sin(s),i=this.fL(Math.exp(t*Math.log((1+o)/(1-o))/2),e)}while(Math.abs(i-s)>1e-12);return i},sinh:function(t){var e=Math.exp(t);return e=(e-1/e)/2},cosh:function(t){var e=Math.exp(t);return e=(e+1/e)/2},tanh:function(t){var e=Math.exp(t);return e=(e-1/e)/(e+1/e)},asinh:function(t){return(t>=0?1:-1)*Math.log(Math.abs(t)+Math.sqrt(t*t+1))},acosh:function(t){return 2*Math.log(Math.sqrt((t+1)/2)+Math.sqrt((t-1)/2))},atanh:function(t){return Math.log((t-1)/(t+1))/2},gN:function(t,e,i){var s=e*i;return t/Math.sqrt(1-s*s)},pj_enfn:function(t){var e=new Array;e[0]=this.C00-t*(this.C02+t*(this.C04+t*(this.C06+t*this.C08))),e[1]=t*(this.C22-t*(this.C04+t*(this.C06+t*this.C08)));var i=t*t;return e[2]=i*(this.C44-t*(this.C46+t*this.C48)),i*=t,e[3]=i*(this.C66-t*this.C68),e[4]=i*t*this.C88,e},pj_mlfn:function(t,e,i,s){return i*=e,e*=e,s[0]*t-i*(s[1]+e*(s[2]+e*(s[3]+e*s[4])))},pj_inv_mlfn:function(t,e,i){for(var s=1/(1-e),o=t,n=Proj4js.common.MAX_ITER;n;--n){var a=Math.sin(o),r=1-e*a*a;if(r=(this.pj_mlfn(o,a,Math.cos(o),i)-t)*(r*Math.sqrt(r))*s,o-=r,Math.abs(r)<Proj4js.common.EPSLN)return o}return Proj4js.reportError("cass:pj_inv_mlfn: Convergence error"),o},C00:1,C02:.25,C04:.046875,C06:.01953125,C08:.01068115234375,C22:.75,C44:.46875,C46:.013020833333333334,C48:.007120768229166667,C66:.3645833333333333,C68:.005696614583333333,C88:.3076171875},Proj4js.datum=Proj4js.Class({initialize:function(t){if(this.datum_type=Proj4js.common.PJD_WGS84,t.datumCode&&"none"==t.datumCode&&(this.datum_type=Proj4js.common.PJD_NODATUM),t&&t.datum_params){for(var e=0;e<t.datum_params.length;e++)t.datum_params[e]=parseFloat(t.datum_params[e]);0==t.datum_params[0]&&0==t.datum_params[1]&&0==t.datum_params[2]||(this.datum_type=Proj4js.common.PJD_3PARAM),t.datum_params.length>3&&(0==t.datum_params[3]&&0==t.datum_params[4]&&0==t.datum_params[5]&&0==t.datum_params[6]||(this.datum_type=Proj4js.common.PJD_7PARAM,t.datum_params[3]*=Proj4js.common.SEC_TO_RAD,t.datum_params[4]*=Proj4js.common.SEC_TO_RAD,t.datum_params[5]*=Proj4js.common.SEC_TO_RAD,t.datum_params[6]=t.datum_params[6]/1e6+1))}t&&(this.a=t.a,this.b=t.b,this.es=t.es,this.ep2=t.ep2,this.datum_params=t.datum_params)},compare_datums:function(t){return this.datum_type==t.datum_type&&(!(this.a!=t.a||Math.abs(this.es-t.es)>5e-11)&&(this.datum_type==Proj4js.common.PJD_3PARAM?this.datum_params[0]==t.datum_params[0]&&this.datum_params[1]==t.datum_params[1]&&this.datum_params[2]==t.datum_params[2]:this.datum_type==Proj4js.common.PJD_7PARAM?this.datum_params[0]==t.datum_params[0]&&this.datum_params[1]==t.datum_params[1]&&this.datum_params[2]==t.datum_params[2]&&this.datum_params[3]==t.datum_params[3]&&this.datum_params[4]==t.datum_params[4]&&this.datum_params[5]==t.datum_params[5]&&this.datum_params[6]==t.datum_params[6]:this.datum_type!=Proj4js.common.PJD_GRIDSHIFT&&t.datum_type!=Proj4js.common.PJD_GRIDSHIFT||(alert("ERROR: Grid shift transformations are not implemented."),!1)))},geodetic_to_geocentric:function(t){var e,i,s,o,n,a,r,l=t.x,h=t.y,m=t.z?t.z:0;if(h<-Proj4js.common.HALF_PI&&h>-1.001*Proj4js.common.HALF_PI)h=-Proj4js.common.HALF_PI;else if(h>Proj4js.common.HALF_PI&&h<1.001*Proj4js.common.HALF_PI)h=Proj4js.common.HALF_PI;else if(h<-Proj4js.common.HALF_PI||h>Proj4js.common.HALF_PI)return Proj4js.reportError("geocent:lat out of range:"+h),null;return l>Proj4js.common.PI&&(l-=2*Proj4js.common.PI),n=Math.sin(h),r=Math.cos(h),a=n*n,o=this.a/Math.sqrt(1-this.es*a),e=(o+m)*r*Math.cos(l),i=(o+m)*r*Math.sin(l),s=(o*(1-this.es)+m)*n,t.x=e,t.y=i,t.z=s,0},geocentric_to_geodetic:function(t){var e,i,s,o,n,a,r,l,h,m,p,d,u,c,g,f,_=t.x,v=t.y,y=t.z?t.z:0;if(!1,e=Math.sqrt(_*_+v*v),i=Math.sqrt(_*_+v*v+y*y),e/this.a<1e-12){if(!0,c=0,i/this.a<1e-12)return g=Proj4js.common.HALF_PI,void(f=-this.b)}else c=Math.atan2(v,_);s=y/i,o=e/i,n=1/Math.sqrt(1-this.es*(2-this.es)*o*o),l=o*(1-this.es)*n,h=s*n,u=0;do{u++,r=this.a/Math.sqrt(1-this.es*h*h),f=e*l+y*h-r*(1-this.es*h*h),a=this.es*r/(r+f),n=1/Math.sqrt(1-a*(2-a)*o*o),m=o*(1-a)*n,p=s*n,d=p*l-m*h,l=m,h=p}while(d*d>1e-24&&u<30);return g=Math.atan(p/Math.abs(m)),t.x=c,t.y=g,t.z=f,t},geocentric_to_geodetic_noniter:function(t){var e,i,s,o,n,a,r,l,h,m,p,d,u,c,g,f,_,v=t.x,y=t.y,x=t.z?t.z:0;if(v=parseFloat(v),y=parseFloat(y),x=parseFloat(x),_=!1,0!=v)e=Math.atan2(y,v);else if(y>0)e=Proj4js.common.HALF_PI;else if(y<0)e=-Proj4js.common.HALF_PI;else if(_=!0,e=0,x>0)i=Proj4js.common.HALF_PI;else{if(!(x<0))return i=Proj4js.common.HALF_PI,void(s=-this.b);i=-Proj4js.common.HALF_PI}return n=v*v+y*y,o=Math.sqrt(n),a=x*Proj4js.common.AD_C,l=Math.sqrt(a*a+n),m=a/l,d=o/l,p=m*m*m,r=x+this.b*this.ep2*p,f=o-this.a*this.es*d*d*d,h=Math.sqrt(r*r+f*f),u=r/h,c=f/h,g=this.a/Math.sqrt(1-this.es*u*u),s=c>=Proj4js.common.COS_67P5?o/c-g:c<=-Proj4js.common.COS_67P5?o/-c-g:x/u+g*(this.es-1),0==_&&(i=Math.atan(u/c)),t.x=e,t.y=i,t.z=s,t},geocentric_to_wgs84:function(t){if(this.datum_type==Proj4js.common.PJD_3PARAM)t.x+=this.datum_params[0],t.y+=this.datum_params[1],t.z+=this.datum_params[2];else if(this.datum_type==Proj4js.common.PJD_7PARAM){var e=this.datum_params[0],i=this.datum_params[1],s=this.datum_params[2],o=this.datum_params[3],n=this.datum_params[4],a=this.datum_params[5],r=this.datum_params[6],l=r*(t.x-a*t.y+n*t.z)+e,h=r*(a*t.x+t.y-o*t.z)+i,m=r*(-n*t.x+o*t.y+t.z)+s;t.x=l,t.y=h,t.z=m}},geocentric_from_wgs84:function(t){if(this.datum_type==Proj4js.common.PJD_3PARAM)t.x-=this.datum_params[0],t.y-=this.datum_params[1],t.z-=this.datum_params[2];else if(this.datum_type==Proj4js.common.PJD_7PARAM){var e=this.datum_params[0],i=this.datum_params[1],s=this.datum_params[2],o=this.datum_params[3],n=this.datum_params[4],a=this.datum_params[5],r=this.datum_params[6],l=(t.x-e)/r,h=(t.y-i)/r,m=(t.z-s)/r;t.x=l+a*h-n*m,t.y=-a*l+h+o*m,t.z=n*l-o*h+m}}}),Proj4js.Point=Proj4js.Class({initialize:function(t,e,i){if("object"==typeof t)this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("string"==typeof t&&void 0===e){var s=t.split(",");this.x=parseFloat(s[0]),this.y=parseFloat(s[1]),this.z=parseFloat(s[2])||0}else this.x=t,this.y=e,this.z=i||0},clone:function(){return new Proj4js.Point(this.x,this.y,this.z)},toString:function(){return"x="+this.x+",y="+this.y},toShortString:function(){return this.x+", "+this.y}}),Proj4js.PrimeMeridian={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},Proj4js.Ellipsoid={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},"APL4.":{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS72:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}},Proj4js.Datum={WGS84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},GGRS87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},NAD83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},NAD27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},OSGB36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"}},Proj4js.WGS84=new Proj4js.Proj("WGS84"),Proj4js.Datum.OSB36=Proj4js.Datum.OSGB36,Proj4js.wktProjections={"Lambert Tangential Conformal Conic Projection":"lcc",Mercator:"merc","Popular Visualisation Pseudo Mercator":"merc",Mercator_1SP:"merc",Transverse_Mercator:"tmerc","Transverse Mercator":"tmerc","Lambert Azimuthal Equal Area":"laea","Universal Transverse Mercator System":"utm"},Proj4js.Proj.tmerc={init:function(){this.e0=Proj4js.common.e0fn(this.es),this.e1=Proj4js.common.e1fn(this.es),this.e2=Proj4js.common.e2fn(this.es),this.e3=Proj4js.common.e3fn(this.es),this.ml0=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(t){var e,i,s,o=t.x,n=t.y,a=Proj4js.common.adjust_lon(o-this.long0),r=Math.sin(n),l=Math.cos(n);if(this.sphere){var h=l*Math.sin(a);if(Math.abs(Math.abs(h)-1)<1e-10)return Proj4js.reportError("tmerc:forward: Point projects into infinity"),93;i=.5*this.a*this.k0*Math.log((1+h)/(1-h)),e=Math.acos(l*Math.cos(a)/Math.sqrt(1-h*h)),n<0&&(e=-e),s=this.a*this.k0*(e-this.lat0)}else{var m=l*a,p=Math.pow(m,2),d=this.ep2*Math.pow(l,2),u=Math.tan(n),c=Math.pow(u,2);e=1-this.es*Math.pow(r,2);var g=this.a/Math.sqrt(e),f=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,n);i=this.k0*g*m*(1+p/6*(1-c+d+p/20*(5-18*c+Math.pow(c,2)+72*d-58*this.ep2)))+this.x0,s=this.k0*(f-this.ml0+g*u*(p*(.5+p/24*(5-c+9*d+4*Math.pow(d,2)+p/30*(61-58*c+Math.pow(c,2)+600*d-330*this.ep2)))))+this.y0}return t.x=i,t.y=s,t},inverse:function(t){var e,i,s,o,n,a;if(this.sphere){var r=Math.exp(t.x/(this.a*this.k0)),l=.5*(r-1/r),h=this.lat0+t.y/(this.a*this.k0),m=Math.cos(h);e=Math.sqrt((1-m*m)/(1+l*l)),n=Proj4js.common.asinz(e),h<0&&(n=-n),a=0==l&&0==m?this.long0:Proj4js.common.adjust_lon(Math.atan2(l,m)+this.long0)}else{var p=t.x-this.x0,d=t.y-this.y0;for(e=(this.ml0+d/this.k0)/this.a,i=e,o=0;!0&&(s=(e+this.e1*Math.sin(2*i)-this.e2*Math.sin(4*i)+this.e3*Math.sin(6*i))/this.e0-i,i+=s,!(Math.abs(s)<=Proj4js.common.EPSLN));o++)if(o>=6)return Proj4js.reportError("tmerc:inverse: Latitude failed to converge"),95;if(Math.abs(i)<Proj4js.common.HALF_PI){var u=Math.sin(i),c=Math.cos(i),g=Math.tan(i),f=this.ep2*Math.pow(c,2),_=Math.pow(f,2),v=Math.pow(g,2),y=Math.pow(v,2);e=1-this.es*Math.pow(u,2);var x=this.a/Math.sqrt(e),w=x*(1-this.es)/e,E=p/(x*this.k0),b=Math.pow(E,2);n=i-x*g*b/w*(.5-b/24*(5+3*v+10*f-4*_-9*this.ep2-b/30*(61+90*v+298*f+45*y-252*this.ep2-3*_))),a=Proj4js.common.adjust_lon(this.long0+E*(1-b/6*(1+2*v+f-b/20*(5-2*f+28*v-3*_+8*this.ep2+24*y)))/c)}else n=Proj4js.common.HALF_PI*Proj4js.common.sign(d),a=this.long0}return t.x=a,t.y=n,t}},Proj4js.defs.UTMK="+title=UTMK +proj=tmerc +lat_0=38.0 +lon_0=127.5 +x_0=1000000.0 +y_0=2000000.0 +k=0.9996 +a=6378137.0 +b=6356752.3141403 +ellps=GRS80 +towgs84=0,0,0 +no_defs",Proj4js.defs.KATECH="+title=KATECH +proj=tmerc +lat_0=38.0 +lon_0=128.0 +x_0=400000.0 +y_0=600000.0 +k=0.9999 +a=6377397.155 +b=6356078.9633422494 +ellps=bessel +towgs84=-115.80,474.99,674.11,1.16,-2.31,-1.63,6.43 +no_defs",$class("olleh.maps.Coord").define({$static:{DEFAULT_EPSILON_IN_METER:.001},Coord:function(){if("olleh.maps.Coord"===this.$classname)throw new TypeError("Cannot instantiate olleh.maps.Coord directly.")},equals:function(t){return t&&this.x===t.x&&this.y===t.y&&t.getClass()===this.getClass()},almostEquals:function(t,e){return this.distanceTo(t)<(e||olleh.maps.Coord.DEFAULT_EPSILON_IN_METER)},distanceTo:function(t){var e=this.asDefault(),i=t?t.asDefault():{x:0,y:0},s={x:e.x-i.x,y:e.y-i.y};return Math.sqrt(Math.abs(s.x*s.x+s.y*s.y))},xy:function(){return{x:this.x,y:this.y}},transform:function(t){return this.getClass()===t?this:new t(Proj4js.transform(this.getClass().PROJ,t.PROJ,this.xy()))},asDefault:function(){return olleh.maps.UTMK.valueOf(this)},clone:function(){return new this.constructor(this.xy())}}),$class("olleh.maps.UTMK").extend(olleh.maps.Coord).define({$static:{PROJ:new Proj4js.Proj("UTMK"),_projs:{},valueOf:function(){var t,e,i;switch(arguments.length){case 0:return olleh.maps.UTMK;case 1:return arguments[0].transform(olleh.maps.UTMK);case 2:e=arguments[0],i=arguments[1];break;default:e={x:arguments[0],y:arguments[1]},i=arguments[2]}return"UTMK"!=i&&(t=olleh.maps.UTMK._projs[i],t||(t=olleh.maps.UTMK._projs[i]=new Proj4js.Proj(i)),e=Proj4js.transform(t,olleh.maps.UTMK.PROJ,e)),new olleh.maps.UTMK(e)}},UTMK:function(t,e){arguments.length>1?(this.x=+t,this.y=+e):(this.x=+t.x,this.y=+t.y)},toString:function(){return"{x: "+this.x+", y: "+this.y+"}"},asDefault:function(){return this}}),$class("olleh.maps.LatLng").extend(olleh.maps.Coord).define({$static:{PROJ:new Proj4js.Proj("WGS84"),valueOf:function(t){return arguments.length?t.transform(olleh.maps.LatLng):olleh.maps.LatLng}},LatLng:function(t,e){arguments.length>1?(this.y=+t,this.x=+e):t.lat!==undefined?(this.y=+t.lat,this.x=+t.lng):(this.y=+t.y,this.x=+t.x)},toString:function(){return"{lat: "+this.y+", lng: "+this.x+"}"}}),$class("olleh.maps.Katech").extend(olleh.maps.Coord).define({$static:{PROJ:new Proj4js.Proj("KATECH"),valueOf:function(t){return arguments.length?t.transform(olleh.maps.Katech):olleh.maps.Katech}},Katech:function(t,e){arguments.length>1?(this.x=+t,this.y=+e):(this.x=+t.x,this.y=+t.y)}}),$class("olleh.maps.Path").define({Path:function(t){this._coords=t||[]},clear:function(){this._coords=[],this._notifyListeners()},getCoords:function(){return this._coords},getAt:function(t){return this._coords[t]},getLength:function(){return this._coords.length},insertAt:function(t,e){this._coords.splice(t,0,e),this._notifyListeners()},pop:function(){var t=this._coords.pop();return this._notifyListeners(),t},push:function(t){this._coords.push(t),this._notifyListeners()},removeAt:function(t){return this._coords.splice(t,1)[0]},setAt:function(t,e){this._coords[t]=e,this._notifyListeners()},onChange:function(t,e){var i=this._getEventListener(t,!0);-1===olleh.maps.util.indexOf(i.ctxs,e)&&i.ctxs.push(e)},unsubscribeChange:function(t,e){var i=this._getEventListener(t,!1);if(i){olleh.maps.util.removeFromArray(i.ctxs,e)>-1&&0===i.ctxs.length&&olleh.maps.util.removeFromArray(this._listeners,i)}},_notifyListeners:function(){if(this._listeners)for(var t=0,e=this._listeners.length;t<e;t++)for(var i=this._listeners[t],s=i.callbackFn,o=i.ctxs,n=0,e=o.length;n<e;n++)s.call(o[n],this)},_getEventListener:function(t,e){var i,s=this._listeners;if(s)for(var o=0,n=s.length;o<n;o++)if(s[o].callbackFn===t){i=s[o];break}return!i&&e&&(s||(this._listeners=[]),i={callbackFn:t,ctxs:[]},this._listeners.push(i)),i},getFirst:function(){return this.getAt(0)},getLast:function(){return this.getAt(this.getLength()-1)},getDistance:function(){var t=this._coords;if(t.length<2)return 0;for(var e=0,i=1;i<t.length;i++)e+=t[i-1].distanceTo(t[i]);return e},getArea:function(){var t=this._coords;if(t.length<3)return 0;for(var e=t.length-1,i=0,s=0;s<t.length;s++){var o=t[e],n=t[s];i+=(o.x+n.x)*(o.y-n.y),e=s}return i/=2,i<0&&(i=-i),i},getType:function(){return 0===this._coords.length?null:this._coords[0].getClass()},getCenteroid:function(){var t=this._coords,e=t.length;if(0===e)return null;if(1===e)return t[0];for(var i=0,s=0,o=0,n=e-1;o<e;o++){var a=t[n],r=t[o];i+=(a.x+r.x)*(a.x*r.y-r.x*a.y),s+=(a.y+r.y)*(a.x*r.y-r.x*a.y),n=o}var l=this.getArea(),h=i/(6*l),m=s/(6*l);return new(this.getType())({x:h,y:m})},getBounds:function(){if(!this._coords.length)return null;for(var t=Infinity,e=Infinity,i=0,s=0,o=0;o<this.getLength();o++){var n=this.getAt(o);t>n.x&&(t=n.x),e>n.y&&(e=n.y),i<n.x&&(i=n.x),s<n.y&&(s=n.y)}var a=this.getType(),r=new a({x:t,y:e}),l=new a({x:i,y:s});return new olleh.maps.Bounds(r,l)},distanceTo:function(t,e){t=t.asDefault();for(var i,s=this._coords,o=0;o<s.length;o++){var n,a;if(o==s.length-1){if(!e)break;n=s[o].asDefault(),a=s[0].asDefault()}else n=s[o].asDefault(),a=s[o+1].asDefault();var r=this._distanceToSegment(t,{x1:n.x,y1:n.y,x2:a.x,y2:a.y});(i===undefined||r<i)&&(i=r)}return i},_distanceToSegment:function(t,e){var i,s,o=t.x,n=t.y,a=e.x1,r=e.y1,l=e.x2,h=e.y2,m=l-a,p=h-r,d=(m*(o-a)+p*(n-r))/(Math.pow(m,2)+Math.pow(p,2));return d<=0?(i=a,s=r):d>=1?(i=l,s=h):(i=a+d*m,s=r+d*p),Math.sqrt(Math.pow(i-o,2)+Math.pow(s-n,2))},simplify:function(t){var e=this._coords;if(e.length<3)return this;var i=e.length-1,s=[];for(s.push(0),s.push(i);e[0].equals(e[i]);)i--,s.push(i);this._douglasPeuckerReduction(e,0,i,t,s);var o=[];s.sort(function(t,e){return t-e});for(var n=0;n<s.length;n++)o.push(e[s[n]]);return new olleh.maps.Path(o)},_douglasPeuckerReduction:function(t,e,i,s,o){for(var n,a=0,r=0,l=e;l<i;l++)(n=this._perpendicularDistance(t[e],t[i],t[l]))>a&&(a=n,r=l);a>s&&r!=e&&(o.push(r),this._douglasPeuckerReduction(t,e,r,s,o),this._douglasPeuckerReduction(t,r,i,s,o))},_perpendicularDistance:function(t,e,i){return Math.abs(.5*(t.x*e.y+e.x*i.y+i.x*t.y-e.x*t.y-i.x*e.y-t.x*i.y))/Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))*2}}),$class("olleh.maps.Bounds").define({Bounds:function(t,e){if(t.getClass()!=e.getClass())throw new TypeError("Coordinate system mismatch: "+t.$classname+", "+e.$classname);this.leftBottom=t,this.rightTop=e},getType:function(){return this.leftBottom.getClass()},equals:function(t){return this.leftBottom.equals(t.leftBottom)&&this.rightTop.equals(t.rightTop)},almostEquals:function(t,e){return this.leftBottom.almostEquals(t.leftBottom,e)&&this.rightTop.almostEquals(t.rightTop,e)},getLeft:function(){return this.leftBottom.x},getBottom:function(){return this.leftBottom.y},getRight:function(){return this.rightTop.x},getTop:function(){return this.rightTop.y},getLeftTopCoord:function(){return new(this.getType())({x:this.getLeft(),y:this.getTop()})},getRightBottomCoord:function(){return new(this.getType())({x:this.getRight(),y:this.getBottom()})},getWidth:function(){var t=this.asDefault();return t.getRight()-t.getLeft()},getHeight:function(){var t=this.asDefault();return t.getTop()-t.getBottom()},getCenter:function(){var t=this.asDefault();return new olleh.maps.UTMK((t.getLeft()+t.getRight())/2,(t.getBottom()+t.getTop())/2)},intersects:function(t){if(!t)return!1;if(t.x!==undefined&&t.y!==undefined)return this._containsCoord(t);var e=this.asDefault(),i=t.asDefault();return e.getLeft()<=i.getRight()&&e.getBottom()<=i.getTop()&&e.getRight()>=i.getLeft()&&e.getTop()>=i.getBottom()},contains:function(t){if(!t)return!1;if(t.x!==undefined&&t.y!==undefined)return this._containsCoord(t);var e=this.asDefault(),i=t.asDefault();return e.getLeft()<=i.getLeft()&&e.getBottom()<=i.getBottom()&&e.getRight()>=i.getRight()&&e.getTop()>=i.getTop()},_containsCoord:function(t){var e=this.asDefault(),i=t.asDefault();return e.getLeft()<=i.x&&e.getBottom()<=i.y&&e.getRight()>=i.x&&e.getTop()>=i.y},intersection:function(t){if(!this.intersects(t))return null;var e=this.asDefault(),i=t.asDefault();return new olleh.maps.Bounds(new olleh.maps.UTMK(Math.max(e.getLeft(),i.getLeft()),Math.max(e.getBottom(),i.getBottom())),new olleh.maps.UTMK(Math.min(e.getRight(),i.getRight()),Math.min(e.getTop(),i.getTop())))},union:function(t){if(this.contains(t))return this;if(t.x!==undefined&&t.y!==undefined)return this._unionCoord(t);var e=this.asDefault(),i=t.asDefault();return new olleh.maps.Bounds(new olleh.maps.UTMK(Math.min(e.getLeft(),i.getLeft()),Math.min(e.getBottom(),i.getBottom())),new olleh.maps.UTMK(Math.max(e.getRight(),i.getRight()),Math.max(e.getTop(),i.getTop())))},_unionCoord:function(t){var e=this.asDefault(),i=t.asDefault();return new olleh.maps.Bounds(new olleh.maps.UTMK(Math.min(e.getLeft(),i.x),Math.min(e.getBottom(),i.y)),new olleh.maps.UTMK(Math.max(e.getRight(),i.x),Math.max(e.getTop(),i.y)))},expand:function(t,e){var i=this.asDefault();return new olleh.maps.Bounds(new olleh.maps.UTMK(i.getLeft()-t/2,i.getBottom()-e/2),new olleh.maps.UTMK(i.getRight()+t/2,i.getTop()+e/2))},transform:function(t){return this.getType()===t?this:new olleh.maps.Bounds(t.valueOf(this.leftBottom),t.valueOf(this.rightTop))},asDefault:function(){return this.transform(olleh.maps.UTMK)}}),$class("olleh.maps.Point").define({$static:{zero:function(){return olleh.maps.Point._zero||(olleh.maps.Point._zero=new olleh.maps.Point(0,0))}},Point:function(t,e){this.x=+t,this.y=+e},clone:function(){return new olleh.maps.Point(this.x,this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},add:function(t){return this.clone()._add(t)},_add:function(t,e){return 1===arguments.length?(this.x+=t.x,this.y+=t.y):(this.x+=t,this.y+=e),this},subtract:function(t){return this.clone()._subtract(t)},_subtract:function(t,e){return 1===arguments.length?(this.x-=t.x,this.y-=t.y):(this.x-=t,this.y-=e),this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},distanceTo:function(t){var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},toCSSString:function(){return this.x+"px "+this.y+"px"}}),$class("olleh.maps.Size").define({$static:{zero:function(){return olleh.maps.Size._zero||(olleh.maps.Size._zero=new olleh.maps.Size(0,0))},full:function(){return olleh.maps.Size._full||(olleh.maps.Size._full=new olleh.maps.Size(100,100,"%"))}},Size:function(t,e,i){this.width=+t,this.height=+e,this.unit=i||"px"},clone:function(){return new olleh.maps.Size(this.width,this.height,this.unit)},equals:function(t){return this.width===t.width&&this.height===t.height&&this.unit===t.unit},add:function(t){return this.clone()._add(t)},_add:function(t,e){if(1===arguments.length){if(this.unit!=t.unit)throw new TypeError("Unit mismatch: "+this.unit+", "+t.unit);this.width+=t.width,this.height+=t.height}else this.width+=t,this.height+=e;return this},subtract:function(t){return this.clone()._subtract(t)},
_subtract:function(t,e){if(1===arguments.length){if(t.unit!=this.unit)throw new TypeError("unit");this.width-=t.width,this.height-=t.height}else this.width-=t,this.height-=e;return this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.width/=t,this.height/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.width*=t,this.height*=t,this},round:function(){return this.clone()._round()},_round:function(){return this.width=Math.round(this.width),this.height=Math.round(this.height),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.width=Math.floor(this.width),this.height=Math.floor(this.height),this},toCSSString:function(){return this.width+this.unit+" "+this.height+this.unit},asPoint:function(){if("px"!=this.unit)throw new TypeError("Unit must be a px: "+this.unit);return new olleh.maps.Point(this.width,this.height)}}),$class("olleh.maps.Element").define({$static:{create:function(t){if(!t)return null;var e=new olleh.maps.Element(document.createElement(t)),i=olleh.maps.browser;return i.browserName===i.BROWSER_NAME.ie&&e.elem.setAttribute("unselectable","on"),e}},Element:function(t){this.elem=t},getProperty:function(t){return this.elem[t]},setProperty:function(t,e){return this.elem[t]=e,this},setProperties:function(t){var e;for(e in t)this.setProperty(e,t[e]);return this},getStyle:function(t){return olleh.maps.util.dom.getStyle(this.elem,t)},setStyle:function(t,e){return olleh.maps.util.dom.setStyle(this.elem,t,e),this},setStyles:function(t){var e;for(e in t)this.setStyle(e,t[e]);return this},addClass:function(t){return olleh.maps.util.dom.addClass(this.elem,t),this},hasClass:function(t){return olleh.maps.util.dom.hasClass(this.elem,t)},removeClass:function(t){return olleh.maps.util.dom.removeClass(this.elem,t),this},replaceClass:function(t,e){return olleh.maps.util.dom.replaceClass(this.elem,t,e),this},toggleClass:function(t){return olleh.maps.util.dom.toggleClass(this.elem,t),this},appendChild:function(t){return this.elem.appendChild(t.elem||t),this},removeChild:function(t){return this.elem.removeChild(t.elem||t),this},pushElement:function(t){return olleh.maps.util.dom.pushElement(this.elem,t.elem||t)},popElement:function(t){return olleh.maps.util.dom.popElement(this.elem,t.elem||t)},getComputedStyle:function(t){return olleh.maps.util.dom.getComputedStyle(this.elem,t)},forceReflow:function(){this.elem.clientWidth;return this},addEventListener:function(t,e){var i=this.elem;return i.addEventListener?i.addEventListener(t,e,!1):i.attachEvent?i.attachEvent("on"+t,e):i["on"+t]=e,this},removeEventListener:function(t,e){var i=this.elem;return i.removeEventListener?i.removeEventListener(t,e,!1):i.detachEvent?i.detachEvent("on"+t,e):i["on"+t]=null,this}}),$class("olleh.maps.SpritedImage").extend(olleh.maps.Element).define({SpritedImage:function(){this.elem=document.createElement("div"),this.setStyles({position:"absolute",backgroundColor:"transparent",backgroundRepeat:"no-repeat"}),olleh.maps.browser.style.backgroundSize||(this.setStyle("overflow","hidden"),this._img=olleh.maps.Element.create("img").setStyle("position","absolute"),this.appendChild(this._img))},setImage:function(t,e,i){return this._img?this._img.setStyles({left:e?-e.x+"px":"0",top:e?-e.y+"px":"0",width:i?i.width+i.unit:e?"":"100%",height:i?i.height+i.unit:e?"":"100%"}).setProperty("src",t):this.setStyles({backgroundImage:"url("+t+")",backgroundPosition:e?-e.x+"px "+-e.y+"px":"",backgroundSize:i?i.toCSSString():e?"auto":"100% 100%"}),this}}),$class("olleh.maps.fx.timing.Timing").define({Timing:function(){if("olleh.maps.fx.timing.Timing"===this.$classname)throw new TypeError("Cannot instantiate olleh.maps.fx.timing.Timing directly.")},getCSSName:function(){return null},getBackwardCSSName:function(){return null},getFn:function(){return this._fn||(this._fn=this.genFn()),this._fn},genFn:function(){return null}}),$class("olleh.maps.fx.timing.Linear").extend(olleh.maps.fx.timing.Timing).define({getCSSName:function(){return"linear"},getBackwardCSSName:function(){return this.getCSSName()},genFn:function(){return function(t){return t}}}),$class("olleh.maps.fx.timing.CubicBezier").extend(olleh.maps.fx.timing.Timing).define({CubicBezier:function(t,e,i,s){this.x1=t,this.y1=e,this.x2=i,this.y2=s},getCSSName:function(){return"cubic-bezier("+this.x1+","+this.y1+","+this.x2+","+this.y2+")"},getBackwardCSSName:function(){return"cubic-bezier("+(1-this.x2)+","+(1-this.y2)+","+(1-this.x1)+","+(1-this.y1)+")"},genFn:function(){var t=this.x1,e=this.y1,i=this.x2,s=this.y2;return function(o){var n,a,r,l,h,m,p,d,u;if(0==o)return 0;for(a=1-3*i+3*t,r=3*i-6*t,l=3*t,h=o,n=0;n<5;n++)m=h*h,p=m*h,d=a*p+r*m+l*h,u=1/(3*a*m+2*r*h+l),h-=(d-o)*u,h=Math.min(1,Math.max(0,h));return 3*Math.pow(1-h,2)*h*e+3*(1-h)*Math.pow(h,2)*s+Math.pow(h,3)}}}),$class("olleh.maps.fx.timing.CubicBezierBasedTiming").extend(olleh.maps.fx.timing.Timing).define({CubicBezierBasedTiming:function(){if("olleh.maps.fx.timing.CubicBezierBasedTiming"===this.$classname)throw new TypeError("Cannot instantiate olleh.maps.fx.timing.CubicBezierBasedTiming directly.")},getBackwardCSSName:function(){return this._curve.getBackwardCSSName()},getFn:function(){return this._curve.getFn()}}),$class("olleh.maps.fx.timing.Ease").extend(olleh.maps.fx.timing.CubicBezierBasedTiming).define({Ease:function(){this._curve=new olleh.maps.fx.timing.CubicBezier(.25,.1,.25,1)},getCSSName:function(){return"ease"}}),$class("olleh.maps.fx.timing.EaseIn").extend(olleh.maps.fx.timing.CubicBezierBasedTiming).define({EaseIn:function(){this._curve=new olleh.maps.fx.timing.CubicBezier(.42,0,1,1)},getCSSName:function(){return"ease-in"}}),$class("olleh.maps.fx.timing.EaseOut").extend(olleh.maps.fx.timing.CubicBezierBasedTiming).define({EaseOut:function(){this._curve=new olleh.maps.fx.timing.CubicBezier(0,0,.58,1)},getCSSName:function(){return"ease-out"}}),$class("olleh.maps.fx.timing.EaseInOut").extend(olleh.maps.fx.timing.CubicBezierBasedTiming).define({EaseInOut:function(){this._curve=new olleh.maps.fx.timing.CubicBezier(.42,0,.58,1)},getCSSName:function(){return"ease-in-out"}}),olleh.maps.namespace("olleh.maps.fx.timing",{linear:new olleh.maps.fx.timing.Linear,ease:new olleh.maps.fx.timing.Ease,easeIn:new olleh.maps.fx.timing.EaseIn,easeOut:new olleh.maps.fx.timing.EaseOut,easeInOut:new olleh.maps.fx.timing.EaseInOut}),$class("olleh.maps.fx.Animation").define({$static:{DEFAULT_DURATION:.3,DEFAULT_TIMING:olleh.maps.fx.timing.ease,REPEAT_FOREVER:-1},Animation:function(t){this.from={},this.to={},this.duration=olleh.maps.fx.Animation.DEFAULT_DURATION,this.timing=olleh.maps.fx.Animation.DEFAULT_TIMING,this.repeat=1,this.comeback=!1,this.callback=null,this.ctx=null,this.pulse=null,olleh.maps.mixin(this,t,!0,["from","to","duration","timing","repeat","comeback","callback","ctx","pulse"])},newAnimator:function(t,e){return e=olleh.maps.mixin({duration:this.duration,timing:this.timing,repeat:this.repeat,comeback:this.comeback,callback:this.callback,ctx:this.ctx,pulse:this.pulse},e,!0),e.from=olleh.maps.mixin(olleh.maps.util.clone(this.from),e.from||{},"remix"),e.to=olleh.maps.mixin(olleh.maps.util.clone(this.to),e.to||{},"remix"),new(0==e.duration?olleh.maps.fx.NoAnimationAnimator:!e.pulse&&olleh.maps.browser.style.transition&&e.timing.getCSSName()?olleh.maps.fx.CSSAnimator:olleh.maps.fx.PulseAnimator)(t,e)},animate:function(t,e){var i=this.newAnimator(t,e);return i.start(),i},animateSync:function(t,e){var i=this.newAnimator(t,e);return i.startSync(),i},applyImmediately:function(t,e){return e||(e={}),e.duration=0,this.animate(t,e)}}),$class("olleh.maps.fx.Pulse").define({Pulse:function(t){this.period=t,this._jobs=[]},add:function(t,e){this._jobs.push(t),1==this._jobs.length&&this.start(e)},remove:function(t){olleh.maps.util.removeFromArray(this._jobs,t),0==this._jobs.length&&this.stop()},isPlaying:function(){return!!this._af},start:function(t){this._af||(this.startTime=olleh.maps.fx.now(),t&&(this.startTime-=1e3*t),this._af=olleh.maps.util.deferAF(this._step,this))},stop:function(){this._af&&(window.cancelAnimationFrame(this._af),this._af=null)},_step:function(t){var e,i;if(0==this._jobs.length)return void this.stop();for(this._af=olleh.maps.util.deferAF(this._step,this),olleh.maps.fx.useAFTime||(t=olleh.maps.fx.now()),i=(t-this.startTime)/1e3,i>=this.period&&(i=this.period,this.startTime=t),e=this._jobs.length-1;e>=0;e--)this._jobs[e](i)}}),$class("olleh.maps.fx.AnimatorBuffer").define({AnimatorBuffer:function(){this._animators=[],this._timer=null},add:function(t){this._animators.push(t),this._timer||(this._timer=olleh.maps.util.defer(this.flush,this))},flush:function(){var t,e;for(t=0,e=this._animators.length;t<e;t++)this._animators[t].startSync();this._animators=[],this._timer&&(window.clearTimeout(this._timer),this._timer=null)}}),$class("olleh.maps.fx.Animator").define({Animator:function(t,e){this.element=t instanceof olleh.maps.Element?t:new olleh.maps.Element(t),olleh.maps.mixin(this,e||{},!0,["from","to","duration","timing","repeat","comeback","callback","ctx","pulse"]),this.status="ready"},start:function(){"ready"===this.status&&(0==this.duration?this.startSync():olleh.maps.fx.animatorBuffer.add(this))},startSync:function(){var t;if("ready"===this.status){if(this.comeback)for(t in this.to)this.to[t]!=undefined&&this.to.hasOwnProperty(t)&&(this.from[t]||(this.from[t]=this.element.getComputedStyle(t),olleh.maps.log.info('Initial style "'+t+'" is not defined; can cause performance issue',this)));this.status="started",this.doInit(),this.doCycle()}},stop:function(){"finished"!==this.status&&("ready"===this.status?this.element.setStyles(this.to):(this.doStop(),this.doClean()),this.status="finished",this.callback&&this.callback.call(this.ctx||this.element.elem,!1))},stopRepeat:function(){"finished"!==this.status&&(this.repeat=!1)},pause:function(){if("started"===this.status)return this.status="paused",this.doPause()},resume:function(){"paused"===this.status&&(this.status="started",this.doResume())},cancel:function(){if("ready"===this.status)return void(this.status="finished");"finished"!==this.status&&(this.status="finished",this.doCancel(),this.doClean())},abort:function(){return"finished"!==this.status&&(this.status="finished"),this.doPause()},ignore:function(){return"finished"!==this.status&&(this.status="finished"),this.doIgnore()},finishCycle:function(){-1===this.repeat&&this.duration>0?this.doCycle():this.repeat>1?(this.repeat--,this.doCycle()):(this.doClean(),this.status="finished"),this.callback&&this.callback.call(this.ctx||this.element.elem,!0)}}),$class("olleh.maps.fx.NoAnimationAnimator").extend(olleh.maps.fx.Animator).define({doInit:function(){},doCycle:function(){this.comeback||this.element.setStyles(this.to),this.finishCycle()},doClean:function(){},doPause:function(){return this.to},doResume:function(){},doCancel:function(){},doIgnore:function(){return this.to}}),$class("olleh.maps.fx.CSSAnimator").extend(olleh.maps.fx.Animator).define({CSSAnimator:function(t,e){var i=olleh.maps.browser;this._styleName=i.style.transition,this._eventType=i.event.transitionend,this._bound_onTransitionend=this._onTransitionend.bind(this),this._isForward=!0},doInit:function(){},doClean:function(){this._listening&&(this.element.setStyle(this._styleName,""),this.element.removeEventListener(this._eventType,this._bound_onTransitionend),this._listening=!1),this._clearEventFallback()},doCycle:function(){this._startTimestamp=+Date.now(),this._playedTimestamp=0,this._receivedEvent=0,this._startTransition(this.comeback?this.duration/2:this.duration)},doStop:function(){var t;if(this.comeback&&this._isForward)for(t in this.to)this.element.setStyle(t,this.from[t])},doPause:function(){var t,e;if(!this._pausedStyles){olleh.maps.log.info("CSS animator paused; can cause performance issue",this),e={};for(t in this.to)e[t]=this.element.getComputedStyle(t),this.element.setStyle(t,e[t]);this.doClean(),this._playedTimestamp+=+Date.now()-this._startTimestamp,this._pausedStyles=e}return this._clearEventFallback(),this._pausedStyles},doResume:function(){this._pausedStyles=null,this._startTimestamp=+Date.now(),this._startTransition((this.comeback?this.duration/2:this.duration)-this._playedTimestamp/1e3)},doCancel:function(){var t;for(t in this.to)this.element.setStyle(t,this.from[t])},doIgnore:function(){return this._listening&&(this.element.removeEventListener(this._eventType,this._bound_onTransitionend),this._listening=!1),this._clearEventFallback(),this[this._isForward?"to":"from"]},_startTransition:function(t){var e,i=[],s=this[this._isForward?"to":"from"],o=this._isForward?this.timing.getCSSName():this.timing.getBackwardCSSName(),n=olleh.maps.util.dom.camelCaseToHyphen,a=olleh.maps.browser.style;this._styleCount=0;for(e in this.to)s[e]!=this.element.getStyle(e)&&(i.push(n(a[e]?a[e]:e)+" "+t+"s "+o),this._styleCount++);this._styleCount>0&&(this.element.addEventListener(this._eventType,this._bound_onTransitionend),this.element.setStyle(this._styleName,i.join(",")),this.element.setStyles(s),this._listening=!0),this._eventFallback=olleh.maps.util.delay(this._finish,1e3*t+100,this)},_onTransitionend:function(t){t.target==this.element.elem&&(t.stopPropagation(),++this._receivedEvent==this._styleCount&&this._finish())},_clearEventFallback:function(){this._eventFallback&&(window.clearTimeout(this._eventFallback),this._eventFallback=null)},_finish:function(){this._clearEventFallback(),this.comeback&&this._isForward?(this._isForward=!1,this.doCycle()):(this._isForward=!0,this.finishCycle())}}),$class("olleh.maps.fx.PulseAnimator").extend(olleh.maps.fx.Animator).define({PulseAnimator:function(t,e){var i=this.timing.getFn(),s=this.pulse;this.comeback?this._fn=function(t){return i(2*(t>.5?1-t:t))}:this._fn=i,s&&s.getPulse?this._pulse=s.getPulse():s&&s.add?this._pulse=s:this._pulse=new olleh.maps.fx.Pulse(this.duration),this._lastStyle=this.from},setPulse:function(t){this._attached&&(this._pulse.remove(this),t.add(this)),this._pulse=t},getPulse:function(){return this._pulse},doInit:function(){var t,e,i,s=olleh.maps.util.dom.parseStyleValue;this._bound_step=this.step.bind(this),this._from={},this._to={};for(t in this.to)this.to[t]!=undefined&&this.to.hasOwnProperty(t)&&(this.from[t]?e=s(this.from[t]):(olleh.maps.log.info('Initial style "'+t+'" is not defined; can cause performance issue',this),e=s(this.element.getComputedStyle(t))),i=s(this.to[t]),this._from[t]=e,this._to[t]=i)},doClean:function(){this._detachPulse()},doCycle:function(){this._attachPulse()},doStop:function(){this._applyStyle(1)},doPause:function(){return this._detachPulse(),this._lastStyle},doResume:function(){this._attachPulse()},doCancel:function(){var t;for(t in this.to)this.element.setStyle(t,this.from[t])},doIgnore:function(){return this._detachPulse(),this._lastStyle},_attachPulse:function(){if(!this._attached){if(this.duration>this._pulse.period)throw new RangeError("Animator duration must be greater than period: "+this.duration+", "+this._pulse.period);this._pulse.add(this._bound_step,this._lastTime),this._attached=!0}},_detachPulse:function(){this._attached&&(this._pulse.remove(this._bound_step),this._attached=!1)},_applyStyle:function(t){var e,i,s,o,n,a,r,l,h,m,p,d,u,c,g=this._fn(t),f=olleh.maps.util.dom.parsedStyleToString;this._lastStyle={};for(e in this._to){for(a=[],l=this._from[e],h=this._to[e],i=0,o=h.length;i<o;i++)if(m=l[i],p=h[i],p.name){for(r=[],s=0,n=p.params.length;s<n;s++)d=m&&m.name?m.params[s].value:0,u=p.params[s],c=d+(u.value-d)*g,r.push({unit:u.unit,value:"px"===u.unit?Math.ceil(c):c});a.push({name:p.name,params:r})}else c=m.value+(p.value-m.value)*g,a.push({unit:p.unit,value:"px"===p.unit?Math.ceil(c):c});this._lastStyle[e]=f(a),this.element.setStyle(e,this._lastStyle[e])}},step:function(t){this._attached&&(this._applyStyle(t/this.duration),this._lastTime=t,t==this._pulse.period&&this.finishCycle())}}),$class("olleh.maps.fx.AnimationFrameQueue").define({AnimationFrameQueue:function(){this._jobs=[],this._enabled=!1},isEnabled:function(){return this._enabled},setEnabled:function(t){t?this.start():this.flush(),this._enabled=t},flush:function(){var t,e=this._jobs;for(this.stop();e.length;)t=e.shift(),t.fn.apply(t.ctx)},clear:function(){this.stop(),this._jobs.length=0},push:function(t,e){this._enabled?(this._jobs.push({fn:t,ctx:e}),this.start()):t.apply(e)},start:function(){!this._af&&this._jobs.length>0&&(this._af=olleh.maps.util.deferAF(this._step,this))},stop:function(){this._af&&(window.cancelAnimationFrame(this._af),this._af=null)},_step:function(){var t,e=this._jobs;if(0==e.length)return void this.stop();this._af=olleh.maps.util.deferAF(this._step,this),t=e.shift(),t.fn.apply(t.ctx)}}),olleh.maps.namespace("olleh.maps.fx",{animatorBuffer:new olleh.maps.fx.AnimatorBuffer,now:function(){return+Date.now()},useAFTime:!1}),function(){window.performance&&window.performance.now&&(olleh.maps.fx.now=function(){return window.performance.now()},olleh.maps.util.deferAF(function(t){olleh.maps.fx.useAFTime=t&&t>1e12&&olleh.maps.fx.now()>1e12}))}(),$class("olleh.maps.event.Event").define({$static:{CAPTURING_PHASE:1,AT_TARGET:2,BUBBLING_PHASE:3,DEFAULT_PHASE:8},Event:function(t,e,i){var s=olleh.maps;if(this._name=t,this._src=e,this._stopPropagation=!1,this._stopImmediatePropagation=!1,this._defaultPrevented=!1,this.eventPhase=0,this.pageXY=undefined,this._point=undefined,this._coord=undefined,this._map=undefined,i){s.mixin(this,i,!0),this.hasOwnProperty("touches")&&(this.targetTouches=this.targetTouches||this.touches,this.changedTouches=this.changedTouches||this.touches);var o=i.originEvent;if(o&&(this.timeStamp=o.timeStamp||+new Date,s.isUndefined(i.pageXY))){var n=o.pageX,a=o.pageY;if(null==n&&null!=o.x){var r=this.targetDOM?this.targetDOM.ownerDocument||document:document,l=r.documentElement,h=l.body;n=o.clientX+(l&&l.scrollLeft||h&&h.scrollLeft||0)-(l&&l.clientLeft||h&&h.clientLeft||0),a=o.clientY+(l&&l.scrollTop||h&&h.scrollTop||0)-(l&&l.clientTop||h&&h.clientTop||0)}this.pageXY=new s.Point(n||0,a||0)}}this.hasOwnProperty("timeStamp")||(this.timeStamp=+new Date)},getName:function(){return this._name},getSource:function(){return this._src},stopPropagation:function(){this._stopPropagation=!0},stopImmediatePropagation:function(){this._stopImmediatePropagation=!0},preventDefault:function(){this._defaultPrevented=!0},getPoint:function(){var t=this.pageXY;if(olleh.maps.isUndefined(t))return null;if(olleh.maps.isUndefined(this._point)){var e=this._getMap();if(!e)return this._point=null;var i=e.layerMgr.getViewportOffset();this._point=t.subtract(i)}return this._point},getCoord:function(){if(null!==this._coord){var t=this.getPoint();if(!t)return this._coord=null;var e=this._getMap();this._coord=e?e.layerMgr.getCoordFromViewportPx(t):null}return this._coord},_getMap:function(){var t=this._src;if(!t||null===this._map)return null;for(var e=t.getMap?t.getMap()||t.getBubble():t.getBubble(),i=olleh.maps.Map;e&&!(e instanceof i);)e=e.getMap?e.getMap()||e.getBubble():e.getBubble();return e=e||t,this._map=e instanceof i?e:null,this._map}}),$class("olleh.maps.event.EventDelegator").define({registerEvent:function(){var t=this._getEventManager();t&&t.registry(this)},registerEventDom:function(t){if(t){var e=this._getEventManager();e&&e.registryDom(this,t)}},unregisterEventDom:function(t){if(t){var e=this._getEventManager();e&&e.unregistryDom(t)}},unregisterEvent:function(){var t=this._getEventManager();t&&t.unregistry(this)},getId:function(){return this.hasOwnProperty("_id")&&null!=this._id||(this._id=olleh.maps.util.genId()),this._id},getBubble:function(){return null},fireEvent:function(t,e,i){if(olleh.maps.isString(t)&&(t=new olleh.maps.event.Event(t,this)),t._stopPropagation)return!1;i>=0?olleh.maps.util.delay(this._handleFireEvent,i,this,t,e):this._handleFireEvent(t,e)},lookupBubbles:function(){for(var t=[],e=this.getBubble();e;)t.push(e),e=e.getBubble();return t},onEvent:function(t,e,i,s){if(!olleh.maps.isFunction(e))throw new TypeError("Specified event listener is not a function: "+e+this.currentStack());if(i&&!olleh.maps.isObject(i))throw new TypeError("Specified event context is not an Object type: "+i+this.currentStack());var o=this._findEventListener(t,e,!0);return e.capture|=s?1:2,!!o&&(i=i||this,-1===olleh.maps.util.indexOf(o.$ctxs,i)&&o.$ctxs.push(i),!0)},propagateEvent:function(t,e){if(!t)return!1;var i,s=olleh.maps.event.Event;return this._notifyListeners(t,e),t.eventPhase!==s.BUBBLING_PHASE&&(t.eventPhase=s.BUBBLING_PHASE),t._stopPropagation||t._stopImmediatePropagation||(i=this.getBubble())&&i.propagateEvent.apply(i,arguments),!0},unsubscribeEvent:function(t,e,i){var s=this._getEventListeners(t);if(s&&0!==s.length)if(e){var o=this._findEventListener(t,e);if(!o)return;if(olleh.maps.isUndefined(i))return void s.splice(olleh.maps.util.indexOf(s,o),1);var n=olleh.maps.util.indexOf(o.$ctxs,i||this);-1!=n&&o.$ctxs.splice(n,1),0===o.$ctxs.length&&(o.$fn=undefined,s.splice(olleh.maps.util.indexOf(s,o),1))}else this._eventListeners[t]=null},_findEventListener:function(t,e,i){var s=this._getEventListeners(t),o=null;if(!s&&i)return s=[],this._eventListeners[t]=s,o={$fn:e,$ctxs:[]},s.push(o),o;for(var n=0,a=s.length;n<a;n++)if((o=s[n])&&o.$fn===e)return o;return s&&i?(o={$fn:e,$ctxs:[]},s.push(o),o):null},_findEventListeners:function(t,e){for(var i=this._getEventListeners(t.getName()),s=[],o=e?1:2,n=0,a=i?i.length:0;n<a;n++)(i[n].$fn.capture&o)==o&&s.push(i[n]);return s},_getEventListeners:function(t){return this.hasOwnProperty("_eventListeners")?this._eventListeners[t]:(this._eventListeners={},null)},_getEventManager:function(){if(!this.hasOwnProperty("_eventMgr")){for(var t=this.getMap?this.getMap()||this.getBubble():this.getBubble(),e=olleh.maps.Map;t&&!(t instanceof e);)t=t.getMap?t.getMap()||t.getBubble():t.getBubble();t=t||this,this._eventMgr=t instanceof e?t.eventMgr:null}return this._eventMgr},_handleFireEvent:function(t,e){var i,s,o,n,a=this.lookupBubbles(),r=olleh.maps.event.Event,l=t.getName();for(t.eventPhase=r.CAPTURING_PHASE;0!=a.length&&!t._stopPropagation&&!t._stopImmediatePropagation;)a.pop()._notifyListeners(t);for(t._stopPropagation||t._stopImmediatePropagation||(this._notifyListeners(t,e),t.eventPhase=r.AT_TARGET,this.propagateEvent(t,e)),a=[this].concat(this.lookupBubbles()),o=0,n=a.length;o<n&&!t._defaultPrevented;o++)i=a[o],this._checkEvent.apply(i,[l,r.DEFAULT_PHASE])&&(s=i["$default_"+l])&&s.apply(i,arguments)},_notifyListeners:function(t,e){var i,s,o,n,a,r=t.eventPhase,l=r===olleh.maps.event.Event.CAPTURING_PHASE,h=this._findEventListeners(t,l),m=h?h.length:0,p=t.getName();if(this._checkEvent(p,r)&&(a=this[(l?"$capture_":"$current_")+p])&&a.apply(this,arguments),t._stopImmediatePropagation)return!0;for(;m--;)if(n=h[m])try{for(s=n.$ctxs,i=s?s.length:0;i--;)if(o=s[i],o&&n.$fn&&n.$fn.apply(o,arguments),t._stopImmediatePropagation)return!0}catch(d){if(olleh.maps.log.error("Error occured during event listener: "+d,this),!d.stack)throw d;olleh.maps.log.error(d.stack,this)}return!0},_checkEvent:function(t,e){var i=olleh.maps.event.Event;e===i.BUBBLING_PHASE&&(e=i.AT_TARGET);var s=this.$EVENTS[t];return!!(s&&s|e)},$afterDefine:function(){var t=this,e=t.prototype,i=olleh.maps.event.Event;e.$EVENTS={};var s=e.$EVENTS;for(var o in e)if(0==o.indexOf("$")){var n=null;1==o.indexOf("capture_")?(n=o.substring(9),s[n]=s[n]|i.CAPTURING_PHASE):1==o.indexOf("current_")?(n=o.substring(9),s[n]=s[n]|i.AT_TARGET):1==o.indexOf("default_")&&(n=o.substring(9),s[n]=s[n]|i.DEFAULT_PHASE)}}}),$class("olleh.maps.event.EventManager").define({$static:{stopPropagation:function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},preventDefault:function(t){t.preventDefault?t.preventDefault():t.returnValue=!1},isRightClick:function(t){return t.which&&3==t.which||t.button&&2==t.button},checkEnabledKeyevent:function(t){if(olleh.maps.isUndefined(t)&&(t=document.activeElement),!t)return!0;var e=t.nodeName;return!("INPUT"===e||"SELECT"===e||"TEXTAREA"===e)}},EventManager:function(t,e){this._map=t,this._root=e,this._hitTargets={},this._recognizers={},this._desktopIE=!1,this._clicked=!1},start:function(){var t,e=olleh.maps.browser;if(this.registryDom(this._map,this._root),this._layerMgr=this._map.layerMgr,this._history={},e.isMobile)this._addEventsListener(document,["touchstart","touchmove","touchend","touchcancel"],this,!1);else{if(e.browserName===e.BROWSER_NAME.ie){var i=document.createElement("div");olleh.maps.util.dom.setStyles(i,{position:"absolute",width:"100%",height:"100%",zIndex:2}),this._desktopIE=!0,this._hackDOM=i,this._root.appendChild(i)}this._mousewheel=e.browserName===e.BROWSER_NAME.firefox?"DOMMouseScroll":"mousewheel",this._addEventsListener(document,["mousedown","mousemove","mouseup"],this,!1),t=this._desktopIE?["dragstart","contextmenu",this._mousewheel]:["dragstart","selectstart","contextmenu",this._mousewheel,"mouseout","mouseover"],this._addEventsListener(this._root,t,this,!1)}this._addEventsListener(window,["resize"],this,!1),this._addEventsListener(this._root,["click"],this,!1),this._started=!0},stop:function(){var t,e=olleh.maps.browser;this.unregistry(this._map),this._history=null,e.isMobile?this._removeEventsListener(document,["touchstart","touchmove","touchend","touchcancel"],this,!1):(this._removeEventsListener(document,["mousedown","mouseup","mousemove"],this,!1),t=this._desktopIE?["dragstart","contextmenu",this._mousewheel]:["dragstart","selectstart","contextmenu",this._mousewheel,"mouseout","mouseover"],this._removeEventsListener(this._root,t,this,!1)),this._removeEventsListener(window,["resize"],this,!1),this._removeEventsListener(this._root,["click"],this,!1),this._started=!1},isStarted:function(){return!!this._started},registry:function(t){var e=t.getId();this._hitTargets[e]=t},registryDom:function(t,e){if(e){var i=t.getId();e.setAttribute("data-id",i),olleh.maps.util.dom.addClass(e,"ollehmap-event"),this._hitTargets[i]=t}},unregistryDom:function(t){t&&(t.removeAttribute("data-id"),olleh.maps.util.dom.removeClass(t,"ollehmap-event"))},unregistry:function(t){this._hitTargets[t.getId()]=null,delete this._hitTargets[t.getId()]},findRecognizer:function(t){return this._recognizers[t]},addRecognizer:function(t){t&&t.isMixinOf(olleh.maps.event.Recognizer)&&(this._recognizers[t.$classname]=t)},removeRecognizer:function(t){this._recognizers[t]=null,delete this._recognizers[t]},_addEventsListener:function(t,e,i,s){var o=e.length;if(t.addEventListener)for(s=!!s,i=i||this;o--;)t.addEventListener(e[o],i,s);else if(t.attachEvent)for(i!==this&&i||(!this._ieHandler&&(this._ieHandler=this.handleEvent.bind(this)),i=this._ieHandler);o--;)t.attachEvent("on"+e[o],i)},_removeEventsListener:function(t,e,i,s){var o=e.length;if(t.removeEventListener)for(s=!!s,i=i||this;o--;)t.removeEventListener(e[o],i,s);else if(t.detachEvent)for((i===this||!i)&&(i=this._ieHandler);o--;)t.detachEvent("on"+e[o],i)},handleEvent:function(t){if(this.isStarted()){var e=olleh.maps.event.EventManager,i=t.target=t.target||t.srcElement;if(t=t||window.event,this._prevDomEvent=this._domEvent,this._domEvent=t,this._prevActiveElement=this._activeElement,this._activeElement=document.activeElement,this._prevDomEvent!==t)switch(t.type){case"mousedown":return this.domMousedownEvent(t);case"mouseup":return this.domMouseupEvent(t);case"mousemove":return this.domMousemoveEvent(t);case"click":return this.domGenericEvent(t);case"mouseover":return this.domMouseoverEvent(t);case"mouseout":return this.domMouseoutEvent(t);case"resize":return this.domResizeEvent(t,"resize");case"selectstart":if(3==i.nodeType&&i.parentElement&&"none"!=olleh.maps.util.dom.getStyle(i.parentElement,"userSelect"))return;case"dragstart":return void e.preventDefault(t);case"contextmenu":return e.preventDefault(t);case"keydown":case"keyup":case"keypress":return this.domKeyboardEvent(t);case"touchstart":case"touchmove":case"touchend":case"touchcancel":return this.handleTouchEvent(t);case this._mousewheel:return this.domGenericEvent(t,"mousewheel");default:return this.domGenericEvent(t)}}},domMouseoverEvent:function(t,e){var i=this.hitTarget(t.target);if(i){var s=this.hitTarget(t.relatedTarget);if(!s||i.target!==s.target){var o=new olleh.maps.event.Event(e||t.type,i.target,{originEvent:t,targetDOM:i.targetDOM,relatedTarget:s});this.handleMapEvent(o)}}},domMouseoutEvent:function(t,e){var i=this.hitTarget(t.target);if(i){var s=this.hitTarget(t.relatedTarget);if(!s||i.target!==s.target){var o=new olleh.maps.event.Event(e||t.type,i.target,{originEvent:t,targetDOM:i.targetDOM,relatedTarget:s});this.handleMapEvent(o)}}},domResizeEvent:function(t,e){var i=this._root,s=this._map,o=i.clientWidth||i.offsetWidth,n=i.clientHeight||i.offsetHeight,a={};olleh.maps.browser.hasOrientationChange&&(a.orientation=window.orientation),a.width=o,a.height=n;var r=new olleh.maps.event.Event(e,s,{originEvent:t,targetDOM:i});s.fireEvent(r,a)},domMousedownEvent:function(t,e){this._desktopIE&&this._hackDOM&&(this._root.removeChild(this._hackDOM),this._hackDOM=null,delete this._hackDOM);var i,s=document,o=this.hitTarget(t.target);if(!o)return this._clicked=!1,void this._removeEventsListener(s,["keyup","keydown","keypress"],this,!1);this._clicked=!0,window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),this._desktopIE&&(olleh.maps.event.EventManager.checkEnabledKeyevent()?window.focus():this._prevActiveElement&&this._prevActiveElement!==t.target&&!olleh.maps.event.EventManager.checkEnabledKeyevent(this._prevActiveElement)&&this._prevActiveElement.blur()),this._addEventsListener(s,["keyup","keydown","keypress"],this,!1),i=new olleh.maps.event.Event(e||t.type,o.target,{originEvent:t,targetDOM:o.targetDOM}),this.handleMapEvent(i)},domMouseupEvent:function(t,e){var i=document,s=this.hitTarget(t.target);s||(this._removeEventsListener(i,["keyup","keydown","keypress"],this,!1),s=this.hitTarget(this._root));var o=new olleh.maps.event.Event(e||t.type,s.target,{originEvent:t,targetDOM:s.targetDOM});this.handleMapEvent(o)},domMousemoveEvent:function(t,e){this._desktopIE&&this._hackDOM&&(this._root.removeChild(this._hackDOM),this._hackDOM=null,delete this._hackDOM);var i=this.hitTarget(t.target)||this.hitTarget(this._root),s=new olleh.maps.event.Event(e||t.type,i.target,{originEvent:t,targetDOM:i.targetDOM});if(this.handleMapEvent(s),this._desktopIE){var o=this._prevEvent;this._prevEvent=s,o&&o.getSource()!==i.target&&(s=new olleh.maps.event.Event("mouseout",o.getSource(),{originEvent:o.originEvent,targetDOM:o.targetDOM,relatedTarget:o.getSource()}),this.handleMapEvent(s)),o&&o.getSource()===i.target||(t.relatedTarget=o?o.targetDOM:null,s=new olleh.maps.event.Event("mouseover",i.target,{originEvent:t,targetDOM:i.targetDOM,relatedTarget:o?o.getSource():null}),this.handleMapEvent(s))}},domKeyboardEvent:function(t){var e={target:this._layerMgr,targetDOM:document},i=new olleh.maps.event.Event(t.type,e.target,{originEvent:t,targetDOM:e.targetDOM});this.handleMapEvent(i)},domGenericEvent:function(t,e){var i=this.hitTarget(t.target);if(i){var s=new olleh.maps.event.Event(e||t.type,i.target,{originEvent:t,targetDOM:i.targetDOM});this.handleMapEvent(s)}},handleTouchEvent:function(t,e){var i=t.type,s=t.target,o=t.changedTouches[0],n=this._prevDomEvent,a=olleh.maps.browser,r=this.hitTarget(s);if("touchstart"===i){if(this._mousedown=!!r,!this._mousedown)return;this._prevActiveElement&&this._prevActiveElement!==t.target&&!olleh.maps.event.EventManager.checkEnabledKeyevent(this._prevActiveElement)&&this._prevActiveElement.blur()}else if(!this._mousedown)return;if(a.hotfixAndroid)"touchstart"===i&&1==t.touches.length?olleh.maps.event.EventManager.preventDefault(t):"touchstart"===n.type&&"touchend"===i&&1==n.touches.length&&!t.touches.length&&t.timeStamp-n.timeStamp<750&&olleh.maps.util.defer(this.handleMapEvent,this,new olleh.maps.event.Event("click",r.target,{
targetDOM:r.targetDOM,pageXY:new olleh.maps.Point(o.pageX,o.pageY),originEvent:t}));else if(a.osName===a.OS_NAME.ios&&n&&"touchend"===n.type&&"touchstart"===i&&!n.touches.length&&n.changedTouches[0].identifier===o.identifier)return olleh.maps.event.EventManager.preventDefault(t),void this.handleMapEvent(new olleh.maps.event.Event("touchcancel",r.target));this.handleMapEvent(new olleh.maps.event.Event(e||i,r.target,{targetDOM:r.targetDOM,pageXY:new olleh.maps.Point(o.pageX,o.pageY),originEvent:t,touch:o,touches:t.touches,targetTouches:t.targetTouches,changedTouches:t.changedTouches}))},setEnable:function(t){this._opts.enabled=!!t},hitTarget:function(t){var e,i,s,o,n,a,r,l=document.body,h=this._domEvent,m=!olleh.maps.browser.hasPointerEvents,p=olleh.maps.util.dom.hasClass,d=[],u=this._layerMgr._root_pane;if(!h.target)return null;for(;t&&t!==window&&t!==l;){if(olleh.maps.isElement(t)){if(m&&p(t,"ollehmap-noevent")){if(t=this._findAncestorNoEventDom(t),(t.parentElement||t.parentNode)===u){r={target:this._layerMgr,targetDOM:u};break}if(0==d.length&&(o=h.clientX,n=h.clientY),d.push(t),t.style.visibility="hidden",t=document.elementFromPoint(o,n),!t||3!==t.nodeType&&"svg"!==t.tagName||(t=t.parentNode),!t){r={target:this._layerMgr,targetDOM:u};break}}if(i=t.getAttribute("data-id")){e=t;break}}t=t.parentElement||t.parentNode}if(m)for(;s=d.pop();)s.style.visibility="";return r||(e&&i&&(a=this._hitTargets[i])?(!("textContent"in e)&&e.innerText&&(e.textContent=e.innerText),{target:a,targetDOM:e}):null)},_findAncestorNoEventDom:function(t){for(var e=olleh.maps.util.dom.hasClass,i=t;(t=t.parentElement||t.parentNode)&&e(t,"ollehmap-noevent");)i=t;return i},handleMapEvent:function(t,e){var i,s,o,n=t.getSource(),a=t.targetDOM;if(n){var r=olleh.maps.mixin;for(var l in this._recognizers)(o=this._recognizers[l].handle(t))&&(i=o.src||n,s=new olleh.maps.event.Event(o.name,i,r({targetDOM:a},o.opts,!0)),i.fireEvent(s,o.payload));t._stopPropagation||n.fireEvent(t,e)}},isMapClicked:function(){return this._clicked}}),$class("olleh.maps.event.Recognizer").define({handle:function(t){if(!this._disabled&&!t._stopPropagation){var e=this[t.getName()];return e&&e.call(this,t)}},setEnabled:function(t){this._disabled=!t},isEnabled:function(){return!this._disabled}}),olleh.maps.namespace("olleh.maps.event.handler",{_EXCLUDES:{$constructor:!0,constructor:!0,getClass:!0,isMixinOf:!0,currentStack:!0,$classname:!0},attach:function(t,e){t.isMixinOf&&t.isMixinOf(olleh.maps.event.EventDelegator)||(t=t.prototype),e=e.prototype;var i,s,o=t.$eventHandler||{},n=olleh.maps.event.Event,a=t.$EVENTS;for(i in e)if(!this._EXCLUDES[i]&&((s=t[i])&&(o[i]=s),t[i]=e[i],0==i.indexOf("$"))){var r=null;1==i.indexOf("capture_")?(r=i.substring(9),a[r]=a[r]|n.CAPTURING_PHASE):1==i.indexOf("current_")?(r=i.substring(9),a[r]=a[r]|n.AT_TARGET):1==i.indexOf("default_")&&(r=i.substring(9),a[r]=a[r]|n.DEFAULT_PHASE)}t.$eventHandler=o},detach:function(t,e){t.isMixinOf&&t.isMixinOf(olleh.maps.event.EventDelegator)||(t=t.prototype),e=e.prototype;var i=t.$eventHandler;for(var s in e)this._EXCLUDES[s]||(i&&i[s]?(t[s]=i[s],delete i[s]):delete t[s])}}),$class("olleh.maps.control.Corner").define({Corner:function(t){var e=olleh.maps.Element.create("div");this.elem=e,this.ctrls=[],this.vAlign=-1!==t.indexOf("top")?"top":"bottom",-1!==t.indexOf("left")?(this.hAlign="left",this.horizontalArea=this._createInnerDom(),this.verticalArea=this._createInnerDom()):(this.hAlign="right",this.verticalArea=this._createInnerDom(),this.horizontalArea=this._createInnerDom(),e.elem.setAttribute("align",this.hAlign)),e.addClass("ollehmap-corner"),e.addClass("ollehmap-noevent"),e.setStyle(this.vAlign,"0px"),e.setStyle(this.hAlign,"0px")},_createInnerDom:function(){var t=olleh.maps.Element.create("div");return t.addClass("ollehmap-corner-area"),t.setStyle("verticalAlign",this.vAlign),this.elem.pushElement(t),t}}),$class("olleh.maps.control.ControlManager").define({ControlManager:function(t){this._ctrls=[],this._corners=[],this.map=t,this._defaultMargin=5;for(var e,i,s=this._corners,o=olleh.maps.control.Corner,n=olleh.maps.control.Control,a=[n.TOP_LEFT,n.TOP_RIGHT,n.BOTTOM_LEFT,n.BOTTOM_RIGHT],r=a.length,l=document.createDocumentFragment();r--;)e=a[r],i=new o(e),s[e]=i,l.appendChild(i.elem.elem);t.elem.appendChild(l)},start:function(){this._started=!0;var t=this._ctrls.length;this._opts=olleh.maps.util.clone(this.map.getOptions());for(var e=0;e<t;e++)this.draw(this._ctrls[e])},_getCtrlClassName:function(t){var e=t.$classname;return e=e.substring(e.lastIndexOf(".")+1),e=e.charAt(0).toLowerCase()+e.substr(1)},isStarted:function(){return!!this._started},add:function(t){this._ctrls.push(t),t.mgr=this,this.isStarted()&&this.draw(t)},draw:function(t){var e=this._opts,i=this._getCtrlClassName(t),s=e[i+"Options"];t.start(),s&&olleh.maps.mixin(t,s,!0),t.elem=t.draw(),t.setDrawn(!0),this._updatePosition(t)},_updatePosition:function(t){var e=this._corners[t.position],i=t.direction,s=e[i+"Area"].elem,o=olleh.maps.Element.create("div"),n=o.elem;e.ctrls.push(t),o.addClass("ollehmap-corner-container"),o.pushElement(t.elem.elem),"vertical"===i?"bottom"===e.vAlign?s.insertBefore(n,s.firstChild):s.appendChild(n):(o.setStyle("verticalAlign",e.vAlign),o.addClass("olleh-maps-inline"),"left"===e.hAlign?s.appendChild(n):s.insertBefore(n,s.firstChild)),"right"===e.hAlign&&(o.addClass("ollehmap-control-rightAlign"),t.elem.elem.setAttribute("align","left")),t.left&&o.setStyle("paddingLeft",t.left+"px"),t.right&&o.setStyle("paddingRight",t.right+"px"),t.top&&o.setStyle("paddingTop",t.top+"px"),t.bottom&&o.setStyle("paddingBottom",t.bottom+"px"),t._containerDOM=o},remove:function(t){var e=this._ctrls;olleh.maps.util.removeFromArray(e,t),e=this._corners[t.position].ctrls,olleh.maps.util.removeFromArray(e,t),this.isStarted()&&(t.destroy(),t._containerDOM&&olleh.maps.util.dom.removeElements(t._containerDOM.elem)),t=null},removeByClass:function(t){for(var e=this._ctrls,i=e.length;i--;){var s=e[i];s instanceof t&&s.setMap(null)}},findByClass:function(t){for(var e=this._ctrls,i=e.length;i--;){var s=e[i];if(s instanceof t)return s}},stop:function(){for(var t=this._ctrls.length;t--;)this._ctrls[t].stop();this._started=!1},removeAll:function(){for(var t,e=this._ctrls;t=e.pop();)t.setMap(null)}}),$class("olleh.maps.control.Control").mixin(olleh.maps.event.EventDelegator,olleh.maps.Adaptable).define({$static:{BOTTOM_LEFT:"bottom_left",BOTTOM_RIGHT:"bottom_right",TOP_LEFT:"top_left",TOP_RIGHT:"top_right",HORIZONTAL:"horizontal",VERTICAL:"vertical",IMG_URL:olleh.maps.env.RESOURCE_URL+"img/controls.png"},Control:function(t){this.mgr,this.elem=null,this.padding=5,this._isDrawn=!1,this._opts=t},start:function(){this._started=!0,this.initOptions()},initOptions:function(){olleh.maps.mixin(this,this._opts,!0)},stop:function(){this._started=!1},isStarted:function(){return!!this._started},setPosition:function(t){this.position=t,this.isStarted()&&(this.mgr.remove(this),this.mgr.add(this))},setDirection:function(t){this.direction=t,this.isStarted()&&(this.mgr.remove(this),this.mgr.add(this))},attach:function(){this.mgr=this.map.controlMgr,this.mgr.add(this)},detach:function(){this.mgr.remove(this)},isDrawn:function(){return this._isDrawn},setDrawn:function(t){this._isDrawn=t},draw:function(){},destroy:function(){this.unregisterEvent(),this.mgr=null,this.elem&&(olleh.maps.util.dom.removeElements(this.elem.elem),this.elem=null),this._isDrawn=!1},getBubble:function(){return this.mgr.map}}),$class("olleh.maps.layer.Layer").extend(olleh.maps.Initializable).mixin(olleh.maps.event.EventDelegator,olleh.maps.Plugin).define({name:"Layer",layerType:"ground",zIndex:0,Layer:function(t){this.layerMgr=null,this._constructorOpts=t||{}},init:function(){olleh.maps.mixin(this,this._constructorOpts,!0,["name","layerType","zIndex","label","group","autoActivate","copyright"]);var t={};this.label&&(t.label=this.label),"base"===this.layerType?t.group="$baseLayer":this.group&&(t.group=this.group),t.autoActivate=this.autoActivate,!this.autoActivate&&this.setVisible(!1),this.setPluginInfo(t),this._constructorOpts.map&&this.setMap(this._constructorOpts.map),delete this._constructorOpts},getBubble:function(){return this.layerMgr},getPane:function(){return null},move:function(){this.moveStart(),this.moveEnd()},moveStart:function(){},moveEnd:function(){},draw:function(t){},zoomStart:function(t,e,i,s){},zoomEnd:function(t,e){},setVisible:function(t){},isVisible:function(){},isVisibleForZoom:function(){return!0},start:function(){this._started=!0},stop:function(){this._started=!1},isStarted:function(){return!!this._started},doActivate:function(){this.setVisible(!0),"base"===this.layerType?this.layerMgr.setActiveBaseLayer(this):this.layerMgr.isStarted()&&this.draw()},setActive:function(t){this.setVisible(t),olleh.maps.Plugin.prototype.setActive.call(this,t)},isActive:function(){return!!this.layerMgr&&("base"===this.layerType?this.layerMgr.getActiveBaseLayer()===this:this.isVisible())},attach:function(){this.map.layerMgr.addLayer(this)},detach:function(){this.map.layerMgr.removeLayer(this)}}),$class("olleh.maps.layer.LayerManager").mixin(olleh.maps.event.EventDelegator).define({$static:{getResolutionForZoom:function(t){return 2048/Math.pow(2,t)}},defaultOpts:{zoom:7,minZoom:0,maxZoom:13,maxExtent:null,panAnimDuration:1,zoomAnimDuration:.2,useCSSTransform:!0},LayerManager:function(t,e){if(null===t)throw new Error("map is null");this._center=null,this._zoom=null,this._minZoom=null,this._maxZoom=null,this._map=t,this._mapElem=e,this._viewportSize=null,this._viewportOffset=null,this._layerOffset=new olleh.maps.Point(0,0),this._pendingZoom=null,this._pendingCenter=null,this._isZooming=!1,this._baseLayers=[],this._groundLayers=[],this._activeBaseLayer=null,this._overlayLayer=null,this._root_pane=null,this._transparent_pane=null,this._layer_container=null,this._panAnimTiming=null},getBubble:function(){return this._map},getMap:function(){return this._map},_initPanes:function(){var t=this._createPane("layer_container",0);this._layer_container=t,olleh.maps.util.dom.setStyles(t,{width:"100%",height:"100%"}),this._mapElem.appendChild(t),this._root_pane=this._createPane("root_pane",0),t.appendChild(this._root_pane);var e=this._createPane("transparent_pane",99999);this._transparent_pane=e,t.appendChild(e),olleh.maps.util.dom.setStyles(e,{width:"100%",height:"100%",display:"none"}),olleh.maps.util.dom.addClass(this._transparent_pane,"ollehmap-transparent")},_createPane:function(t,e){var i=document.createElement("div");return i.id=t,i.style.position="absolute",olleh.maps.isNumber(e)&&(i.style.zIndex=e),i},addLayer:function(t){"base"===t.layerType?this.addBaseLayer(t):this.addGroundLayer(t,t.zIndex)},addBaseLayer:function(t){t.layerMgr=this,t.setVisible(!1),t.getPane().style.zIndex="-2",this._baseLayers.push(t);var e=function(){!t.isStarted()&&t.start();var i=t.getPane();this._root_pane.insertBefore(i,this._root_pane.firstChild),this.unsubscribeEvent("started",e),t.fireEvent("added")};this.isStarted()?(e.call(this),this._activeBaseLayer||this.setActiveBaseLayer(t)):this.onEvent("started",e,this)},addGroundLayer:function(t,e){t.layerMgr=this,t.getPane().style.zIndex=e,this._groundLayers.push(t);var i=function(){!t.isStarted()&&t.start();var e=t.getPane();e.style.position="absolute",this._root_pane.appendChild(e),t.isVisible()&&t.draw(),this.unsubscribeEvent("started",i),t.fireEvent("added")};this.isStarted()?i.call(this):this.onEvent("started",i,this)},removeLayer:function(t){if(olleh.maps.isString(t)&&(t=this.getLayer(t)),t.layerMgr=null,this.isStarted()){var e=t.getPane();e&&e.parentNode&&e.parentNode.removeChild(e),t.fireEvent("removed")}-1===olleh.maps.util.removeFromArray(this._groundLayers,t)&&olleh.maps.util.removeFromArray(this._baseLayers,t)},getLayer:function(t){var e,i,s;for(e=0,i=this._baseLayers.length;e<i;e++)if(s=this._baseLayers[e],s.name===t)return s;for(e=0,i=this._groundLayers.length;e<i;e++)if(s=this._groundLayers[e],s.name===t)return s;if("olleh.maps.overlay.OverlayLayer"===t)return this._overlayLayer},getBaseLayers:function(){return this._baseLayers},getGroundLayers:function(){return this._groundLayers},getOverlayLayer:function(){return this._overlayLayer},setActiveBaseLayer:function(t){if(olleh.maps.isString(t)&&(t=this.getLayer(t)),this._activeBaseLayer!==t){var e=this._activeBaseLayer;if(this._activeBaseLayer=t,t.getPane().style.zIndex="-1",t.setActive(!0),this.isStarted()){e&&(t instanceof olleh.maps.layer.TileLayer?(e.getPane().style.zIndex="-2",this._hideLayerFn=function(){"-2"==e.getPane().style.zIndex&&e.setActive(!1),t.unsubscribeEvent("loaded",this._hideLayerFn,this),this._hideLayerFn=null},t.onEvent("loaded",this._hideLayerFn,this)):e.setActive(!1));var i=this._updateMinMaxZoom(),s=Math.min(Math.max(this._zoom,this._minZoom),this._maxZoom);s!==this._zoom?this.moveTo(null,s,"redraw"):this._activeBaseLayer.draw(),i&&this.fireEvent("zoomrange_changed")}else e&&e.setActive(!1)}this.fireEvent("set_base_layer")},setMinZoom:function(t){this.isStarted()&&(this._opts.minZoom=t,this._updateZoomRange())},setMaxZoom:function(t){this.isStarted()&&(this._opts.maxZoom=t,this._updateZoomRange())},_updateZoomRange:function(){var t=this._updateMinMaxZoom(),e=Math.min(Math.max(this._zoom,this._minZoom),this._maxZoom);e!==this._zoom&&this.moveTo(null,e,"redraw"),t&&this.fireEvent("zoomrange_changed")},_updateMinMaxZoom:function(){var t=this._activeBaseLayer,e=this._map.getOptions().maxZoom,i=this._opts.minZoom,s=e&&e<=15?e:this._opts.maxZoom;olleh.maps.isNumber(t.minZoom)&&(i=Math.max(t.minZoom,i)),!olleh.maps.isNumber(t.maxZoom)||e&&e<=15||(s=Math.min(t.maxZoom,s));var o=!1;return i===this._minZoom&&s===this._maxZoom||(this._minZoom=i,this._maxZoom=s,o=!0),o},getActiveBaseLayer:function(){return this._activeBaseLayer},getZoomForBounds:function(t){t=t.transform(olleh.maps.UTMK);for(var e=this._minZoom,i=t.getWidth(),s=t.getHeight();e<=this._maxZoom;e++){var o=this._getCoordSizeForZoom(e);if(o.width<i||o.height<s)return e===this._minZoom?this._minZoom:e-1}return e},isValidCoord:function(t){return this.getBounds().contains(t)},start:function(){var t,e,i=olleh.maps.util.clone(this.defaultOpts);if(i=olleh.maps.mixin(i,this._map.getOptions(),!0),this._opts=i,this._minZoom=i.minZoom,this._maxZoom=i.maxZoom,this._viewportSize=new olleh.maps.Size(this._mapElem.clientWidth,this._mapElem.clientHeight),this._viewportOffset=olleh.maps.util.dom.getXY(this._mapElem),this._disableLoadingWhilePanning=this._map.getOption("disableLoadingWhilePanning",!1),!this._center&&this._initialBounds){var s=this._initialBounds;this._center=s.getCenter(),this._zoom=this.getZoomForBounds(s),delete this._initialBounds}if(!this._center&&(this._center=i.center.asDefault()),!olleh.maps.isNumber(this._zoom)&&(this._zoom=+i.zoom),this._panAnimTiming=new olleh.maps.fx.timing.CubicBezier(0,i.panAnimEaseLinearity1,i.panAnimEaseLinearity2,1),this._zoomPulse=!!olleh.maps.browser.usePulseForZoom&&new olleh.maps.fx.Pulse(i.zoomAnimDuration),this._initPanes(),this._updateMinMaxZoom(),i.overlayLayer){this._overlayLayer=i.overlayLayer,this._overlayLayer.map=this._map,this._overlayLayer.layerMgr=this;var o=this._overlayLayer.panes;for(var n in o)this._root_pane.appendChild(o[n])}for(this.registerEventDom(this._layer_container),t=0,e=this._baseLayers.length;t<e;t++)this._baseLayers[t].start();for(t=0,e=this._groundLayers.length;t<e;t++)this._groundLayers[t].start();if(this._overlayLayer&&this._overlayLayer.start(),this._disableLoadingWhilePanning){var a=new olleh.maps.layer.BackgroundLayer;a.layerMgr=this,a.start();var r=a.getPane();this._root_pane.appendChild(r),this._backgroundLayer=a}this._started=!0,this._center&&this.moveTo(this._center,this._zoom,"redraw"),this.fireEvent("started")},stop:function(){var t,e;for(t=0,e=this._baseLayers.length;t<e;t++)this._baseLayers[t].stop();for(t=0,e=this._groundLayers.length;t<e;t++)this._groundLayers[t].stop();this._overlayLayer&&this._overlayLayer.stop(),this.unregisterEvent(),this._started=!1},isStarted:function(){return!!this._started},getResolution:function(){return 2048/Math.pow(2,this._zoom)},getViewportSize:function(){return this._viewportSize},getViewportCenter:function(){return new olleh.maps.Point(Math.floor(this._viewportSize.width/2),Math.floor(this._viewportSize.height/2))},getViewportOffset:function(){return this._viewportOffset},_getCoordSizeForZoom:function(t){var e=olleh.maps.layer.LayerManager.getResolutionForZoom(t);return this._viewportSize.multiplyBy(e)},getLayerOffset:function(){return this._layerOffset},_getCoordOrigin:function(t){if(!this._center)throw new Error("Center must be specified.");var e=t?this.getPendingZoom():this._zoom,i=t?this.getPendingCenter():this._center,s=this._getCoordSizeForZoom(e),o=i.x-s.width/2,n=i.y+s.height/2;return new olleh.maps.UTMK(o,n)},getViewportPxFromCoord:function(t,e){e=!1!==e,t=t.asDefault();var i=this._getCoordOrigin(!!e),s=t.x-i.x,o=i.y-t.y,n=e?this.getPendingZoom():this._zoom,a=olleh.maps.layer.LayerManager.getResolutionForZoom(n);return new olleh.maps.Point(s/a,o/a)._round()},getLayerPxFromCoord:function(t,e){e=!1!==e;var i=this.getViewportPxFromCoord(t,!!e);return new olleh.maps.Point(i.x-this._layerOffset.x,i.y-this._layerOffset.y)._round()},getCoordFromViewportPx:function(t,e){e=!1!==e;var i=e?this.getPendingZoom():this._zoom,s=olleh.maps.layer.LayerManager.getResolutionForZoom(i),o=this._getCoordOrigin(!!e),n=t.x*s,a=t.y*s;return new olleh.maps.UTMK(o.x+n,o.y-a)},getCoordFromLayerPx:function(t,e){e=!1!==e;var i=new olleh.maps.Point(t.x+this._layerOffset.x,t.y+this._layerOffset.y);return this.getCoordFromViewportPx(i,e)},getLayerPxFromViewportPx:function(t){return new olleh.maps.Point(t.x-this._layerOffset.x,t.y-this._layerOffset.y)},getViewportPxFromLayerPx:function(t){return new olleh.maps.Point(t.x+this._layerOffset.x,t.y+this._layerOffset.y)},getCenter:function(){return this._center},getBounds:function(){var t=this._getCoordSizeForZoom(this._zoom),e=this._center.x-t.width/2,i=this._center.y-t.height/2,s=this._center.x+t.width/2,o=this._center.y+t.height/2;return new olleh.maps.Bounds(new olleh.maps.UTMK(e,i),new olleh.maps.UTMK(s,o))},getZoom:function(){return this._zoom},getMinZoom:function(){return this._minZoom},getMaxZoom:function(){return this._maxZoom},_getScaleForZoom:function(t){return Math.pow(2,t-this._zoom)},_getScaleForChanges:function(t){return Math.pow(2,t)},_getZoomForScale:function(t){return this._zoom+Math.log(t)/Math.LN2},setZoom:function(t){this.moveTo(null,t,"on")},zoomIn:function(){this.setZoom(this.getPendingZoom()+1)},zoomOut:function(){this.setZoom(this.getPendingZoom()-1)},panToBounds:function(t){var e=t.getCenter(),i=this.getZoomForBounds(t);this.panTo(e,i)},fitBounds:function(t){if(this.isStarted()){var e=t.getCenter(),i=this.getZoomForBounds(t);this.moveTo(e,i,"redraw")}else this._initialBounds=t},panBy:function(t,e){var i=this.calcNewCenter(t,e);this.panTo(i,this._zoom)},calcNewCenter:function(t,e){var i=this.getResolution(),s=t*i,o=e*i;return new olleh.maps.UTMK(this._center.x+s,this._center.y-o)},panTo:function(t,e,i){t=t.asDefault(),this.moveTo(t,e,i||"auto")},_moveRootPane:function(t,e){arguments.length>=2?this._layerOffset._add(t,e):(this._layerOffset.x=0,this._layerOffset.y=0);var i=this._getPositionStyles();olleh.maps.util.dom.setStyles(this._root_pane,i)},_getPositionStyles:function(){return olleh.maps.util.dom.getPositionStyles(this._layerOffset.x,this._layerOffset.y,this._opts.useCSSTransform,olleh.maps.browser.use3DRootPane)},_panRootPane:function(t,e,i,s){var o=this._getPositionStyles();this._layerOffset._add(t,e);var n=this._getPositionStyles();this._rootPaneAnimator=new olleh.maps.fx.Animation({from:o,to:n,duration:i,timing:this._panAnimTiming,callback:s?s.bind(this):null,pulse:!0}).animate(this._root_pane)},_abortPanAnimationAndUpdateCenter:function(){if(!this._isZooming&&this._rootPaneAnimator&&"started"===this._rootPaneAnimator.status){var t=this._rootPaneAnimator.abort(),e=olleh.maps.util.dom.getPointFromStyle(t),i=this._layerOffset.subtract(e);this._layerOffset=e;var s=this.calcNewCenter(i.x,i.y);this._center=s,this._disableLoadingWhilePanning||this._moveLayers(),this._resetIdleTimer()}},setCenter:function(t){t=t.asDefault(),this.moveTo(t,null,"redraw")},resize:function(t,e){if(this.isStarted()){var i,s=new olleh.maps.Size(this._mapElem.clientWidth,this._mapElem.clientHeight);if("center"===t)i=this._center;else{var o=s.divideBy(2).asPoint();if(i=this.getCoordFromViewportPx(o),"right"===t||"bottom"===e){var n=this._viewportSize.divideBy(2).asPoint();this._viewportSize=s;var a=this.getCoordFromViewportPx(n),r="right"===t?a.x:i.x,l="bottom"===e?a.y:i.y;i=new olleh.maps.UTMK(r,l)}}this._viewportSize=s,this._viewportOffset=olleh.maps.util.dom.getXY(this._mapElem),this._viewportSizeChanged=!0,this.moveTo(i,null,"redraw")}},_adjustCenter:function(t,e){var i=this._opts.restrictedExtent;if(!i)return t;var s,o,n,a,r=this._getCoordSizeForZoom(e);r.width>i.getWidth()?(s=i.getRight()-r.width/2,o=i.getLeft()+r.width/2):(s=i.getLeft()+r.width/2,o=i.getRight()-r.width/2),r.height>i.getHeight()?(n=i.getTop()-r.height/2,a=i.getBottom()+r.height/2):(n=i.getBottom()+r.height/2,a=i.getTop()-r.height/2);var l=new olleh.maps.Bounds(new olleh.maps.UTMK(s,n),new olleh.maps.UTMK(o,a));if(l.contains(t))return t;var h=Math.max(l.getLeft(),Math.min(l.getRight(),t.x)),m=Math.max(l.getBottom(),Math.min(l.getTop(),t.y));return new olleh.maps.UTMK(h,m)},moveTo:function(t,e,i,s){if(e&&(e=+e),!this.isStarted())return t&&(this._center=t),void(olleh.maps.isNumber(e)&&(this._zoom=e));if(!this._pinch_started){t||(t=this._isZooming?this._pendingCenter:this._center),olleh.maps.isNumber(e)||(e=this._isZooming?this._pendingZoom:this._zoom),e=Math.max(this._minZoom,e),e=Math.min(this._maxZoom,e),t=this._adjustCenter(t,e);var o=this._zoom,n=this._center,a=this._isZooming?e!==this._pendingZoom:e!==o,r=this._isZooming?!t.equals(this._pendingCenter):!t.equals(n),l=!1,h=!1;this._abortPanAnimationAndUpdateCenter();var m=olleh.maps.isNumber(s)?s:this._opts.panAnimDuration,p=olleh.maps.isNumber(s)?s:this._opts.zoomAnimDuration;if("redraw"===i||olleh.maps.isUndefined(i)||a&&0===p||r&&0===m)l=!0;else if("on"===i)h=!0;else{var d=this._getCoordSizeForZoom(Math.min(e,this._zoom)),u=this._center.x-3*d.width/2,c=this._center.y-3*d.height/2,g=this._center.x+3*d.width/2,f=this._center.y+3*d.height/2;t.x<u||t.y<c||t.x>g||t.y>f?l=!0:h="auto"===i}if(!h&&a&&(l=!0),l||r||a)if(!this._center||l)this._isZooming&&(this._zoomEndReq&&(window.cancelAnimationFrame(this._zoomEndReq),this._zoomEndReq=null),this._isZooming=!1,this._pendingZoom=null,this._pendingCenter=null),this._setBounds(t,e),this._moveRootPane(),this._drawLayers(),this._fireBoundsChangedEvent();else if(a){var _;if(this._isZooming){if(_=this._initialOriginLayerPx,this._initialCenterLayerPx){var v=this._initialCenterLayerPx,y=this._getScaleForZoom(e),x=_.subtract(v);x._multiplyBy(1-1/y);var w=v.add(x);w=this.getCoordFromLayerPx(w,!1),t=w}}else{if(_=this.getLayerPxFromCoord(t,!1),r){var E=this.getLayerPxFromCoord(this._center,!1),x=_.subtract(E),y=this._getScaleForZoom(e);x._divideBy(1-1/y),_=E.add(x),this._initialCenterLayerPx=E}this._initialOriginLayerPx=_}this._pendingZoom=e,this._pendingCenter=t;var y=this._getScaleForChanges(e-o);this.fireEvent("zoom_change",{origin:_,scale:y,duration:p,newZoom:e,oldZoom:o}),this._hideLayerFn&&this._hideLayerFn.call(this),this._zoomStartLayers(y,_,p),this._triggerZoomEnd(t,e,o,p)}else if(!this._isZooming){var b=this.getResolution(),P=Math.floor((t.x-this._center.x)/b),C=Math.floor((t.y-this._center.y)/b);h?(this._panRootPane(-P,C,m,this._moveEndLayers),this._setBounds(t,this._zoom),this._moveStartLayers()):(this._moveRootPane(-P,C),this._setBounds(t,this._zoom),this._disableLoadingWhilePanning||this._moveLayers(),this._resetIdleTimer(),this._fireBoundsChangedEvent())}}},_triggerZoomEnd:function(t,e,i,s){this._isZooming=!0,this._zoomEndReq&&window.cancelAnimationFrame(this._zoomEndReq),this._zoomEndReq=olleh.maps.util.deferAF(this._triggerZoomEnd2,this,t,e,i,s)},_triggerZoomEnd2:function(t,e,i,s,o){null!==this._zoomTimer&&window.clearTimeout(this._zoomTimer),this._zoomEndReq=null,this._zoomTimer=olleh.maps.util.delay(this._triggerZoomEnd3,1e3*o+100,this,e,s,i)},_triggerZoomEnd3:function(t,e,i){this._isZooming=!1,this._setBounds(t,i),this._pendingZoom=null,this._pendingCenter=null,this._zoomEndLayers(e,i),this._initialCenterLayerPx=null,this._zoomTimer=null,this._fireBoundsChangedEvent()},_setBounds:function(t,e){var i=this._center!==t,s=this._zoom!==e;if(i||s){if(i){var o=this._center;this._center=t,this._centerChanged={newCenter:t,oldCenter:o}}if(s){var n=this._zoom;this._zoom=e,this._zoomChanged={newZoom:e,oldZoom:n}}}},_fireBoundsChangedEvent:function(){this._centerChanged&&this.fireEvent("center_changed",this._centerChanged),this._zoomChanged&&this.fireEvent("zoom_changed",this._zoomChanged),(this._zoomChanged||this._centerChanged||this._viewportSizeChanged)&&this.fireEvent("bounds_changed"),this._centerChanged=null,this._zoomChanged=null,this._viewportSizeChanged=null},isZooming:function(){return this._isZooming},getPendingZoom:function(){return olleh.maps.isNumber(this._pendingZoom)?this._pendingZoom:this._zoom},getPendingCenter:function(){return this._pendingCenter?this._pendingCenter:this._center},_drawLayers:function(){this._forEachLayers("draw",[!this.isStarted()]),this.isStarted()?this._resetIdleTimer():this._idle()},_moveEndLayers:function(){this._forEachLayers("moveEnd"),this._fireBoundsChangedEvent(),this._idle()},_moveStartLayers:function(){this._forEachLayers("moveStart")},_moveLayers:function(){this._forEachLayers("move")},_zoomStartLayers:function(t,e,i){this._forEachLayers("zoomStart",[t,e,i,this._zoomPulse])},_zoomEndLayers:function(t,e){this._forEachLayers("zoomEnd",[t,e]),this._zoomPulse&&this._zoomPulse.stop(),this._idle()},_forEachLayers:function(t,e){e||(e=[]),this._backgroundLayer&&this._backgroundLayer[t].apply(this._backgroundLayer,e),this._activeBaseLayer&&this._activeBaseLayer[t].apply(this._activeBaseLayer,e);for(var i=0,s=this._groundLayers.length;i<s;i++){var o=this._groundLayers[i];(o.isVisible()&&o.isVisibleForZoom()||-1!=t.indexOf("End"))&&o[t].apply(o,e)}this._overlayLayer&&this._overlayLayer[t].apply(this._overlayLayer,e)},setEditMode:function(t){var e=t?"block":"none";this._transparent_pane.style.display=e},getMaxExtent:function(){return this._opts.maxExtent},getRestrictedExtent:function(){return this._opts.restrictedExtent},_resetIdleTimer:function(){this._idleTimer&&window.clearTimeout(this._idleTimer),this._idleTimer=olleh.maps.util.delay(this.__resetIdleTimer,200,this)},__resetIdleTimer:function(){this._isZooming||this._rootPaneAnimator&&"started"==this._rootPaneAnimator.status||(this._disableLoadingWhilePanning&&this._moveLayers(),this.fireEvent("idle")),this._idleTimer=null},_idle:function(){this._idleTimer||this.fireEvent("idle")}}),$class("olleh.maps.layer.BackgroundLayer").extend(olleh.maps.layer.Layer).define({start:function(){var t=olleh.maps.browser,e=this.layerMgr.getViewportSize();this._pane=document.createElement("div"),this._buffer=3e3;var i={position:"absolute",zIndex:"-1000",width:e.width+2*this._buffer+"px",height:e.height+2*this._buffer+"px",backgroundImage:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAALUlEQVR4Xu3SMQEAMAgDwVD/2mDDDnXAb0w5Ab8k2nTlCDyBg4ADwVMx/8CBDz7/CnKqkouSAAAAAElFTkSuQmCC)",backgroundRepeat:"repeat"};t.has3D&&(i.transform="translate3d(0,0,0)"),olleh.maps.util.dom.setStyles(this._pane,i),this._updatePosition(),this.layerMgr.onEvent("idle",this._onIdle,this)},getPane:function(){return this._pane},_onIdle:function(){this._idleTimer&&window.clearTimeout(this._idleTimer),this._idleTimer=olleh.maps.util.delay(this._resetIdleTimer,500,this)},_resetIdleTimer:function(){this._updatePosition(),this._idleTimer=null},_updatePosition:function(){var t=this.layerMgr.getLayerOffset();olleh.maps.util.dom.setStyles(this._pane,{left:-t.x-this._buffer+"px",top:-t.y-this._buffer+"px"})}}),$class("olleh.maps.overlay.OverlayLayer").extend(olleh.maps.layer.Layer).define({name:"olleh.maps.overlay.OverlayLayer",label:"오버레이",autoActivate:!0,buffeSize:.2,baseIndex:1e3,disableShadow:!1,paneIds:["lower_overlay_pane","overlay_shadow_pane","upper_overlay_pane","infowindow_shadow_pane","infowindow_pane"],OverlayLayer:function(){this._visible=!0,this._overlays=[],this._displayedOverlays={},this.panes={};for(var t,e,i=0;i<this.paneIds.length;i++)e=this.paneIds[i],t=this.panes[e]=document.createElement("div"),t.style.position="absolute",t.style.zIndex=1e3+i;this._gridIndex=new olleh.maps.overlay.GridIndex(1e4)},start:function(){olleh.maps.overlay.OverlayLayer.$super.start.call(this),this.disableShadow=this.map.getOption("disableShadow",!1)},$current_bounds_changed:function(t,e){var i=t.getSource();this._gridIndex.remove(i,e.from),this._gridIndex.add(i),this._updateSingleOverlayDisplayHint(i)},$current_position_changed:function(t,e){var i=t.getSource();i.getBounds()||(this._gridIndex.remove(i,e.from),this._gridIndex.add(i),this._updateSingleOverlayDisplayHint(i))},getPane:function(t){return this.panes[t]},getOverlays:function(){return this._overlays},setVisible:function(t){if(this._visible!=t){this._visible=t,t&&this.draw();var e=this.panes,i=t?"block":"none";for(var s in e)e[s].style.display=i}},isVisible:function(){return this._visible},add:function(t){if(t.layer=this,this.layerMgr.isZooming())return this._toAddOverlaysAtZoomEnd||(this._toAddOverlaysAtZoomEnd=[]),void this._toAddOverlaysAtZoomEnd.push(t);this._overlays.push(t),(t.getPosition()||t.getBounds())&&this._gridIndex.add(t),this.isStarted()&&(t.fireEvent("attached"),this._updateSingleOverlayDisplayHint(t),t.draw(!0))},remove:function(t){this._gridIndex.remove(t),this._toAddOverlaysAtZoomEnd&&-1!==olleh.maps.util.removeFromArray(this._toAddOverlaysAtZoomEnd,t)||(this.isStarted()&&t.erase(!0),t.fireEvent("detached"),olleh.maps.util.removeFromArray(this._overlays,t));var e=t.getId();this._displayedOverlays[e]&&delete this._displayedOverlays[e],t.layer=null},moveStart:function(){},moveEnd:function(){var t,e=this._center,i=this.layerMgr.getCenter();if(e){t=!this._getBufferBounds(new olleh.maps.Bounds(e,e)).contains(i)}else t=!0;t&&(this._center=i,this._onBoundsChanged())},zoomStart:function(t,e,i,s){var o,n,a=this._overlays;for(o=a.length-1;o>=0;o--)n=this._overlays[o],n.zoomStart(t,e,i,s)},zoomEnd:function(){var t,e,i=this._overlays;for(t=i.length-1;t>=0;t--)e=this._overlays[t],e.zoomEnd();if(this._onBoundsChanged(),this._toAddOverlaysAtZoomEnd){var s=this._toAddOverlaysAtZoomEnd;for(delete this._toAddOverlaysAtZoomEnd,t=0,len=s.length;t<len;t++)this.add(s[t])}},draw:function(t){var e,i,s=this._overlays;for(e=s.length-1;e>=0;e--)i=s[e],i.draw(t);this._onBoundsChanged()},_onBoundsChanged:function(){var t=this._bounds;this._bounds=null;var e=this.getBounds();this._updateAllOverlayDisplayHint(),this.fireEvent("overlay_layer_bounds_changed",{from:t,to:e})},_getBufferSize:function(){return this.layerMgr.getViewportSize().multiplyBy(this.buffeSize)},getBounds:function(){return this._bounds||(this._bounds=this._getBufferBounds()),this._bounds},_getBufferBounds:function(t){var e=this.layerMgr,i=e.getResolution(),s=this._getBufferSize();return(t||e.getBounds()).expand(s.width*i,s.height*i)},_updateAllOverlayDisplayHint:function(){var t,e,i,s={},o=this._gridIndex.getOverlays(this.getBounds());for(t=0;t<o.length;t++)i=o[t],s[i.getId()]=i;for(e in this._displayedOverlays)s[e]||(this._displayedOverlays[e].setDisplayHint(!1),delete this._displayedOverlays[e]);for(e in s)this._displayedOverlays[e]||(s[e].setDisplayHint(!0),this._displayedOverlays[e]=s[e])},_updateSingleOverlayDisplayHint:function(t){var e=this.getBounds().intersects(t.getBounds()||t.getPosition());t.setDisplayHint(e),e?this._displayedOverlays[t.getId()]=t:this._displayedOverlays[t.getId()]&&delete this._displayedOverlays[t.getId()]}}),
$class("olleh.maps.overlay.GridIndex").define({GridIndex:function(t){this._cellSize=t,this._grid=[]},add:function(t,e){var i,s,o,n,a=this._getCellRange(e||t.getIndexObject());for(i=a.minX;i<=a.maxX;i++)for(o=this._grid[i],o||(o=this._grid[i]=[]),s=a.minY;s<=a.maxY;s++)n=o[s],n?n.push(t):o[s]=[t]},remove:function(t,e){var i,s,o,n,a,r=this._getCellRange(e||t.getIndexObject());for(s=r.minX;s<=r.maxX;s++)if(n=this._grid[s])for(o=r.minY;o<=r.maxY;o++)(a=n[o])&&-1!=(i=olleh.maps.util.indexOf(a,t))&&a.splice(i,1)},clear:function(){var t,e,i,s,o,n,a,r,l;for(t=0,r=this._grid,s=r?r.length:0;t<s;t++)for(e=0,l=this._grid[t],o=l?l.length:0;e<o;e++)for(i=0,a=this._grid[t][e],n=a?a.length:0;i<n;i++)a[i].setMap(null)},contains:function(t){var e,i,s,o,n=this._getCellRange(t.getIndexObject());for(e=n.minX;e<=n.maxX;e++)if(s=this._grid[e])for(i=n.minY;i<=n.maxY;i++)if((o=s[i])&&-1!=olleh.maps.util.indexOf(o,t))return!0;return!1},getOverlays:function(t){var e,i,s,o,n,a=[],r=this._getCellRange(t);for(e=r.minX;e<=r.maxX;e++)if(s=this._grid[e])for(i=r.minY;i<=r.maxY;i++)if(o=s[i])for(var l=0;l<o.length;l++)n=o[l],t.intersects(n.getIndexObject())&&a.push(n);return a},_getCellRange:function(t){var e,i,s,o,n=this._cellSize;return t=t.asDefault(),t.x!==undefined&&t.y!==undefined?(e=s=Math.floor(t.x/n),i=o=Math.floor(t.y/n)):(e=Math.floor(t.leftBottom.x/n),i=Math.floor(t.leftBottom.y/n),s=Math.floor(t.rightTop.x/n),o=Math.floor(t.rightTop.y/n)),{minX:e,minY:i,maxX:s,maxY:o}}}),$class("olleh.maps.PluginRegistry").mixin(olleh.maps.event.EventDelegator).define({PluginRegistry:function(){this._plugins=[],this._drawingTools=[]},add:function(t){t.pluginRegistry=this,this._plugins.push(t),this.fireEvent("plugin_added",{plugin:t}),t.pluginInfo&&t.pluginInfo.drawingTool&&this._drawingTools.push(t)},remove:function(t){t.active&&t.deactivate(),olleh.maps.util.removeFromArray(this._plugins,t),olleh.maps.util.removeFromArray(this._drawingTools,t),this.fireEvent("plugin_removed",{plugin:t}),t.pluginRegistry=null},getPlugins:function(){return this._plugins},getLabeledPluginsByGroup:function(){for(var t=this._plugins,e={},i=0,s=t.length;i<s;i++){var o=t[i],n=o.pluginInfo;if(n&&n.label){var a=n.group?n.group:"$nogroup",r=e[a];r||(r=[],e[a]=r),r.push(o)}}return e},drawingToolActivate:function(t){for(var e=this._drawingTools.length-1;e>=0;e--)this._drawingTools[e]!==t&&this._drawingTools[e].deactivate()}}),$class("olleh.maps.Map").mixin(olleh.maps.event.EventDelegator).define({$static:{DEFAULT_MAX_EXTENT_LEFT:171162,DEFAULT_MAX_EXTENT_BOTTOM:1214781,DEFAULT_MAX_EXTENT_RIGHT:1744026,DEFAULT_MAX_EXTENT_TOP:2787645,ROADMAP:"ROADMAP",SATELLITE:"SATELLITE",HYBRID:"HYBRID",ENGMAP:"ENGMAP",DEFAULT_NORMAL_MAX_ZOOM:13},defaultOpts:{mapTypeId:"ROADMAP",maxExtent:new olleh.maps.Bounds(new olleh.maps.UTMK(171162,1214781),new olleh.maps.UTMK(1744026,2787645)),restrictedExtent:new olleh.maps.Bounds(new olleh.maps.UTMK(171162,1214781),new olleh.maps.UTMK(1744026,2787645)),trackWindowSize:!0,panAnimEaseLinearity1:.5,panAnimEaseLinearity2:olleh.maps.browser.isMobile?.7:.25,disableDraggingCursor:!0,draggingCursor:"url("+olleh.maps.env.RESOURCE_URL+"cursor/closedhand_8_8.cur), move",draggableCursor:"url("+olleh.maps.env.RESOURCE_URL+"cursor/openhand_8_8.cur), default",disableLoadingWhilePanning:"Android"===olleh.maps.browser.osName,useEngMap:!1},Map:function(t,e){if(!t)throw Error("Map element must be specified.");olleh.maps.isString(t)&&(t=document.getElementById(t));var i=olleh.maps.$skeleton;this._defaultOpts=olleh.maps.util.clone(this.defaultOpts),this._opts=e,this._cursor="ollehmap-default",olleh.maps.util.dom.addClass(t,"ollehmap"),this.elem=t,this._cursors=[],this._setUseEngMap(this._opts.useEngMap),this.hasMobileStylesheet=!1,this.services={},this._mapTypeRegistry={},this.pluginRegistry=new olleh.maps.PluginRegistry,this.eventMgr=new olleh.maps.event.EventManager(this,t),this.layerMgr=new olleh.maps.layer.LayerManager(this,t),this.controlMgr=new olleh.maps.control.ControlManager(this);for(var s=0,o=i.length;s<o;s++)(new i[s]).setMap(this);this._opts.center&&this.start()},start:function(){this._opts=olleh.maps.mixin(this._opts,this._defaultOpts),this._opts.mapTypeId&&this.setMapTypeId(this._opts.mapTypeId),this._started=!0,this.eventMgr.start(),this.layerMgr.start(),this.controlMgr.start(),this.fireEvent("started"),this.setCursor(null),olleh.maps.browser.hasOrientationChange&&(this._orientation=window.orientation)},_setUseEngMap:function(t){this._useEngMap=t},getUseEngMap:function(){return this._useEngMap},stop:function(){this._started=!1,this.fireEvent("stopped")},isStarted:function(){return!!this._started},registerMapType:function(t,e){(t!==olleh.maps.Map.ENGMAP||this.getUseEngMap())&&(olleh.maps.isString(e)&&(e=this.layerMgr.getLayer(e)),this._mapTypeRegistry[t]=e,e.setMap(this),this._mapTypeId===t&&(this._mapTypeId=null,this.setMapTypeId(t)))},unregisterMapType:function(t){delete this._mapTypeRegistry[t]},getMapTypeRegistry:function(){return this._mapTypeRegistry},setMapTypeId:function(t){var e=olleh.maps.log;if(e.isLevel(e.INFO)&&e.info("Map#setMapTypeId: "+t),t!==olleh.maps.Map.ENGMAP||this.getUseEngMap()||(t=olleh.maps.Map.ROADMAP),this._mapTypeId!==t){var i=this._mapTypeRegistry[this._mapTypeId];i&&i.deactivate(),this._mapTypeId=t;this._mapTypeRegistry[t].activate(),this.fireEvent("maptypeid_changed",{mapTypeId:t})}},getMapTypeId:function(){return this._mapTypeId},getLayer:function(t){return this.layerMgr.getLayer(t)},getBaseLayers:function(){return this.layerMgr.getBaseLayers()},getGroundLayers:function(){return this.layerMgr.getGroundLayers()},getZoomForBounds:function(t){return this.layerMgr.getZoomForBounds(t)},isValidCoord:function(t){return this.layerMgr.isValidCoord(t)},getOverlayLayer:function(){return this.layerMgr.getOverlayLayer()},setCenter:function(t){var e=olleh.maps.log;e.isLevel(e.INFO)&&e.info("Map#setCenter: "+t),this.layerMgr.isZooming()&&this._warnZooming("setCenter"),this.layerMgr.setCenter(t),this._checkStart()},getCenter:function(){return this.layerMgr.isZooming()&&this._warnZooming("getCenter"),this.layerMgr.getCenter()},getZoom:function(){return this.layerMgr.isZooming()&&this._warnZooming("getZoom"),this.layerMgr.getZoom()},getBounds:function(){return this.layerMgr.isZooming()&&this._warnZooming("getBounds"),this.layerMgr.getBounds()},getMinZoom:function(){return this.layerMgr.getMinZoom()},getMaxZoom:function(){return this.layerMgr.getMaxZoom()},setZoom:function(t){var e=olleh.maps.log;e.isLevel(e.INFO)&&e.info("Map#setZoom: "+t),this.layerMgr.isZooming()&&this._warnZooming("setZoom"),this.layerMgr.setZoom(t)},zoomIn:function(){var t=olleh.maps.log;t.isLevel(t.INFO)&&t.info("Map#zoomIn"),this.layerMgr.isZooming()&&this._warnZooming("zoomIn"),this.layerMgr.zoomIn()},zoomOut:function(){var t=olleh.maps.log;t.isLevel(t.INFO)&&t.info("Map#zoomOut"),this.layerMgr.isZooming()&&this._warnZooming("zoomOut"),this.layerMgr.zoomOut()},fitBounds:function(t){var e=olleh.maps.log;e.isLevel(e.INFO)&&e.info("Map#fitBounds: "+t),this.layerMgr.isZooming()&&this._warnZooming("fitBounds"),this.layerMgr.fitBounds(t),this._checkStart()},panToBounds:function(t){var e=olleh.maps.log;e.isLevel(e.INFO)&&e.info("Map#panToBounds: "+t.leftBottom.x+", "+t.leftBottom.y+", "+t.rightTop.x+", "+t.rightTop.x+", "),this.layerMgr.isZooming()&&this._warnZooming("panToBounds"),this.layerMgr.panToBounds(t),this._checkStart()},panTo:function(t,e,i){var s=olleh.maps.log;s.isLevel(s.INFO)&&s.info("Map#panTo: coord: "+t+", zoom: "+e),this.layerMgr.isZooming()&&this._warnZooming("panTo"),this.layerMgr.panTo(t,e,i),this._checkStart()},panBy:function(t,e){var i=olleh.maps.log;i.isLevel(i.INFO)&&i.info("Map#panBy: dx: "+t+" ,dy:"+e),this.layerMgr.isZooming()&&this._warnZooming("panBy"),this.layerMgr.panBy(t,e)},_warnZooming:function(t){var e=olleh.maps.log;e.isLevel(e.INFO)&&e.info("경고: 줌애니메이션 수행되는 중간에 "+t+" 함수를 호출하면 그 결과가 보장되지 않습니다. 애니메이션이 끝난 후에 호출하세요.")},getViewportSize:function(){return this.layerMgr.getViewportSize()},getMaxExtent:function(){return this._opts.maxExtent},setCursor:function(t){if(!olleh.maps.browser.isMobile){var e=this.elem;if(e&&this._cursors[this._cursors.length-1]!==t){var i=this._opts;switch(t||(t=i.disableDraggingCursor?"default":"draggable"),t){case"draggable":t=i.draggableCursor;break;case"dragging":t=i.draggingCursor}this._cursors.push(t),e.style.cursor=t}}},resetCursor:function(){this._cursors.length<=1||(this._cursors.pop(),this.elem.style.cursor=this._cursors[this._cursors.length-1])},_checkStart:function(){this.isStarted()||this.start()},getOptions:function(){return this._opts},checkDefaultControl:function(t){var e=this.getOption(t),i=this.getOption("disableDefaultUI",!1);return!0===e||!i&&!1!==e},getOption:function(t,e){var i=this._opts[t];return i!==undefined?i:e},mergeDefaultOptions:function(t){olleh.maps.mixin(this._defaultOpts,t,!0)},$default_resize:function(t,e){if(this._opts.trackWindowSize){var i="left";e.orientation!==undefined&&e.orientation!==this._orientation&&(i="center",this._orientation=e.orientation),this.layerMgr.resize(i)}},resize:function(t,e){this.layerMgr.resize(t,e)},getTooltip:function(){return!this._tooltip&&olleh.maps.overlay.Tooltip&&(this._tooltip=new olleh.maps.overlay.Tooltip),this._tooltip}}),$class("olleh.maps.layer.Tile").mixin(olleh.maps.event.EventDelegator).define({Tile:function(t){this.setLayer(t),this._animationPolicy="none",this._loading=!1},getLayer:function(){return this._layer},setLayer:function(t){this._layer=t},getBubble:function(){return this._layer},setEffectPolicy:function(t){this._animationPolicy=t},isLoading:function(){return this._loading},getPosition:function(){return this._position},setPosition:function(t){this._position=t,this._root&&this._updatePosition()},_getTileSize:function(){var t=olleh.maps.Map.DEFAULT_NORMAL_MAX_ZOOM,e=this._layer.tileSize,i=this._layer.layerMgr.getZoom();return{width:i>t?e.width*(2*(i-t)):e.width,height:i>t?e.height*(2*(i-t)):e.height}},_updatePosition:function(){var t=this._getTileSize();this._root.setStyles({left:this._position.x+"px",top:this._position.y+"px",width:t.width+"px",height:t.height+"px"})},getURL:function(){return this._url},setPositionAndUrl:function(t,e,i){this._position=t,this._url=e,i&&(this._animationPolicy=i),this._root&&this._update()},_update:function(){var t=this._getTileSize(),e=this._root,i=this._img,s=this._layer.tileAnimation;this.stopAnimator(),this._updatePosition(),i.getProperty("src")!=this._url?(i.setStyle({visibility:"hidden",width:t.width+"px",height:t.height+"px"}),this._loading=!0,s&&("always"==this._animationPolicy||"once"==this._animationPolicy&&!this._layer.cachedTileURLs[this._url])&&(e.setStyles(s.from),this._animator=s.newAnimator(e,{callback:this._fadedin.bind(this)})),i.setStyle("visibility","").setProperty("src",this._url)):this._loading||this.fireEvent("loaded")},getElement:function(){var t=olleh.maps.browser,e=this._getTileSize(),i=this._root,s=this._img;return i||(t.has3D&&!t.use3DRootPane?(i=this._root=olleh.maps.Element.create("div").setStyles({position:"absolute",width:e.width+"px",height:e.height+"px",transform:"translateZ(0)"}),s=this._img=olleh.maps.Element.create("img").setStyles({width:e.width+"px",height:e.height+"px"}),i.appendChild(s)):(i=s=this._root=this._img=olleh.maps.Element.create("img").setStyles({position:"absolute",width:e.width+"px",height:e.height+"px"}),t.has3D&&"iOS"==t.osName&&s.setStyle("transform","translate3d(0,0,0)")),this._bound_onload=this._onload.bind(this),this._bound_onerror=this._onerror.bind(this),s.addEventListener("load",this._bound_onload),s.addEventListener("error",this._bound_onerror),this._update()),i.elem},stopAnimator:function(){this._animator&&(this._animator.stop(),this._animator=null)},destroy:function(){this.stopAnimator(),this._root&&(this._img.removeEventListener("load",this._bound_onload),this._img.removeEventListener("error",this._bound_onerror),this._root=this._img=null)},_onerror:function(){this._loading&&(this.stopAnimator(),this._loading=!1,this._img.setProperty("src",this._layer.errorTileURL))},_onload:function(){this._loading&&(this._layer.cachedTileURLs[this._url]=!0,this._animator?this._animator.start():(this._loading=!1,this.fireEvent("loaded")))},_fadedin:function(t){t&&(this._loading=!1,this.fireEvent("loaded"))}}),$class("olleh.maps.layer.TileLayer").extend(olleh.maps.layer.Layer).define({$static:{ERROR_TILE_URL:olleh.maps.env.RESOURCE_URL+"img/tile_transparent.png",DEFAULT_TILE_SIZE:new olleh.maps.Size(256,256),DEFAULT_MAX_WAIT_TIME:3,DEFAULT_UPDATE_INTERVAL:.1,DEFAULT_BUFFER_NUM:0,DEFAULT_TILE_FADE_IN_DURATION:.2},TileLayer:function(t){var e=olleh.maps.layer.TileLayer;this.Tile=olleh.maps.layer.Tile,this.tileSize=e.DEFAULT_TILE_SIZE,this.minZoom=0,this.maxZoom=15,this.errorTileURL=e.ERROR_TILE_URL,this.maxWaitTime=e.DEFAULT_MAX_WAIT_TIME,this._tileQueue=new olleh.maps.fx.AnimationFrameQueue,this._tileQueue.setEnabled(!1),this._tiles=[],this._movingBuffer=[],this._visible=!0,this._pane=olleh.maps.Element.create("div").addClass("ollehmap-noevent").setStyle("position","absolute"),this._createGridDiv()},init:function(){olleh.maps.mixin(this,this._constructorOpts,!0,["tileSize","getTileSize","minZoom","maxZoom","errorTileURL","maxWaitTime"]),olleh.maps.layer.TileLayer.$super.init.apply(this,arguments)},start:function(){var t=olleh.maps.layer.TileLayer,e=this.map.getOption("tileFadeInDuration",t.DEFAULT_TILE_FADE_IN_DURATION);olleh.maps.browser.style.opacity&&0!==e&&(this.tileAnimation=new olleh.maps.fx.Animation({from:{opacity:"0"},to:{opacity:"1"},duration:e,timing:olleh.maps.fx.timing.easeOut})),this.bufferNum=this.map.getOption("tileLayerBufferNum",t.DEFAULT_BUFFER_NUM),this._updateInterval=this.map.getOption("tileLayerUpdateInterval",t.DEFAULT_UPDATE_INTERVAL),this._disableLoadingWhilePanning=this.map.getOption("disableLoadingWhilePanning",!1);var i=this.map.getOptions().maxZoom;this.maxZoom=i&&i<=15?i:this.maxZoom},getPane:function(){return this._pane.elem},getTileSize:function(){var t=olleh.maps.Map.DEFAULT_NORMAL_MAX_ZOOM,e=this.layerMgr.getZoom();return e>t?this.tileSize.multiplyBy(2*(e-t)):this.tileSize},setVisible:function(t){this._visible!=t&&(this._visible=t,this._updateVisibility())},isVisible:function(){return this._visible},_updateVisibility:function(){this._pane.setStyle("display",this._visible&&this.isVisibleForZoom()?"block":"none")},isVisibleForZoom:function(){var t;return!!this.map&&(t=this.map.getZoom(),this.minZoom<=t&&t<=this.maxZoom)},_getLayerSize:function(){var t=this._gridNum;if(t){var e=this.getTileSize();return new olleh.maps.Size(e.width*t.x,e.height*t.y)}},_getDisplayOffset:function(){var t=this._offset,e=this.layerMgr.getLayerOffset();return new olleh.maps.Point(t.x+e.x,t.y+e.y)},_getTilePosition:function(t,e){var i=this._offset,s=this.getTileSize();return new olleh.maps.Point(i.x+t*s.width,i.y+(this._gridNum.y-1-e)*s.height)},_createGridDiv:function(){this._div=olleh.maps.Element.create("div").setStyle("position","absolute").addClass("ollehmap-noevent"),this._pane.appendChild(this._div)},_removeTileFromArray:function(t,e){var i,s;for(i=0,s=e.length;i<s;i++)if(e[i].getURL()==t)return e.splice(i,1)[0];return null},_getGridNum:function(){var t=this.layerMgr.getViewportSize(),e=this.getTileSize(),i=this.bufferNum;return{x:Math.ceil(t.width/e.height)+1+2*i,y:Math.ceil(t.height/e.width)+1+2*i}},_cleanup:function(t){this.cachedTileURLs={},this._loadedTileNum=0,this._unloadedTileNum=0,this._updateVisibility(),this._stopUpdateTimer(),this._stopZoomAnimation(),t||this._cleanZoomingBufferDiv(),this._tileQueue.clear()},_calculate:function(){var t=this.getTileSize(),e=this.tileOrigin,i=this.layerMgr.getResolution(),s=this.layerMgr.getBounds().leftBottom,o={width:t.width*i,height:t.height*i},n={x:s.x-e.x,y:s.y-e.y},a={x:Math.floor(n.x/o.width),y:Math.floor(n.y/o.height)},r=new olleh.maps.UTMK(a.x*o.width+e.x,a.y*o.height+e.y);this._gridNum=this._getGridNum(),this.index=a,this._offset=this.layerMgr.getLayerPxFromCoord(r)._subtract(0,t.height*this._gridNum.y)},draw:function(t){var e,i,s,o,n,a,r,l=this.Tile,h=this._tiles,m=[],p=[],d=0;if(this._cleanup(t),this.isVisible()&&this.isVisibleForZoom()){for(this._calculate(),this._grid=[],r=this._gridNum,e=0;e<r.x;e++)for(this._grid[e]=[],i=0;i<r.y;i++)(a=this.getTileURL(e,i))&&(n=this._getTilePosition(e,i),s=this._removeTileFromArray(a,h),s?(s.setPosition(n),m.push(s),this._grid[e][i]=s):p.push({x:e,y:i,position:n,url:a}));for(;o=p.pop();)s=h.length?h.pop():new l(this),s.setPositionAndUrl(o.position,o.url,"always"),d++,this._grid[o.x][o.y]=s,m.push(s),s.getElement().parentNode||this._div.appendChild(s.getElement());for(this._tiles=m;s=h.pop();)s.getElement().parentNode&&this._div.removeChild(s.getElement()),s.destroy();this._loadedTileNum==d?olleh.maps.util.defer(this._onload,this):this._unloadedTileNum=d}},isMoving:function(){return this._tileQueue.isEnabled()},move:function(){this._updateTimer||(this._updateTimer=olleh.maps.util.delay(this._update,1e3*this._updateInterval,this))},_stopUpdateTimer:function(){this._updateTimer&&(window.clearTimeout(this._updateTimer),this._updateTimer=null)},_update:function(){this._updateTimer=null,this._tileQueue.setEnabled(!1),this._shiftGrid(!1)},moveStart:function(){this._stopUpdateTimer(),this._disableLoadingWhilePanning||(this._tileQueue.setEnabled(!0),this._shiftGrid(!0))},moveEnd:function(){this._disableLoadingWhilePanning?this._shiftGrid(!1):this._tileQueue.setEnabled(!1),this._cleanMovingBuffer()},_shiftGrid:function(t){var e,i,s,o,n;if(!this.layerMgr.isZooming()&&(i=this.layerMgr.getViewportSize(),s=this._getLayerSize(),o=this.getTileSize().multiplyBy(this.bufferNum),s)){do{e=!1,n=this._getDisplayOffset(),-n.x<o.width?(this._shiftCol(-1,t),e=!0):s.width- -n.x-i.width<o.width&&(this._shiftCol(1,t),e=!0),-n.y<o.height?(this._shiftRow(1,t),e=!0):s.height- -n.y-i.height<o.height&&(this._shiftRow(-1,t),e=!0)}while(e);this._loadedTileNum==this._unloadedTileNum&&olleh.maps.util.defer(this._onload,this)}},_shiftCol:function(t,e){var i,s,o,n,a,r=this._gridNum;for(t<0?(i=0,o=Array.prototype.pop,n=Array.prototype.unshift):(i=r.x-1,o=Array.prototype.shift,n=Array.prototype.push),this.index.x=this.index.x+t,this._offset.x+=t*this.getTileSize().width,a=o.call(this._grid),s=0;s<r.y;s++)a[s]=this._shiftTile(a[s],i,s,e);n.call(this._grid,a)},_shiftRow:function(t,e){var i,s,o,n,a,r,l=this._gridNum;for(t<0?(s=0,o=Array.prototype.pop,n=Array.prototype.unshift):(s=l.y-1,o=Array.prototype.shift,n=Array.prototype.push),this.index.y=this.index.y+t,this._offset.y-=t*this.getTileSize().height,i=0;i<l.x;i++)a=o.call(this._grid[i]),r=this._shiftTile(a,i,s,e),n.call(this._grid[i],r)},_shiftTile:function(t,e,i,s){var o,n=this._getTilePosition(e,i),a=this.getTileURL(e,i);return s?(this._movingBuffer.push(t),(o=this._removeTileFromArray(a,this._movingBuffer))||(o=new this.Tile(this),this._appendTileLater(o))):o=t,o.setPositionAndUrl(n,a,"once"),this._unloadedTileNum++,o},_appendTileLater:function(t){this._tileQueue.push(function(){t&&!t.getElement().parentNode&&(this._div.appendChild(t.getElement()),this._tiles.push(t))},this)},_cleanMovingBuffer:function(){for(var t;t=this._movingBuffer.pop();)t.getElement().parentNode&&(t.isLoading()&&this._unloadedTileNum>0&&this._unloadedTileNum--,this._div.removeChild(t.getElement()),olleh.maps.util.removeFromArray(this._tiles,t)),t.destroy()},isZooming:function(){return!!this._zoomingScale},zoomStart:function(t,e,i,s){var o,n,a,r;if(this._zoomingScale!=t){if(this._stopCleanTimer(),this._stopUpdateTimer(),this._tileQueue.clear(),!this.isZooming()){for(this._cleanZoomingBufferDiv(),r=this._zoomingTiles=this._tiles,o=0,n=r.length;o<n;o++)a=r[o],a.setEffectPolicy("none"),"animating"==a.status&&a.stopAnimator();this._tiles=[],this._unloadedTileNum=0,this._zoomingBufferDiv=this._div.setStyle("zIndex","-1"),this._createGridDiv(),this._movingBuffer=[]}olleh.maps.browser.style.transform?this._zoomWithTransform(t,e,i,s):this._zoomWithoutTransform(t,e,i,s),this._zoomingScale=t}},_zoomWithTransform:function(t,e,i,s){var o,n;this.isZooming()?(o=this._zoomingBufferDiv,n=this._zoomAnimator.ignore()):(o=this._zoomingBufferDiv.setStyle("transformOrigin",e.x+"px "+e.y+"px"),n={transform:olleh.maps.util.dom.getScaleString(1)}),this._zoomAnimator=new olleh.maps.fx.Animation({from:n,to:{transform:olleh.maps.util.dom.getScaleString(t)},duration:i,pulse:s,timing:olleh.maps.fx.timing.easeOut}).animate(o)},_zoomWithoutTransform:function(t,e,i,s){var o,n,a=this.getTileSize(),r=this._gridNum,l=e.add(this._offset.subtract(e).multiplyBy(t));for(this._zoomAnimators||(this._zoomAnimators=[]),o=0;o<r.x;o++)for(this._zoomAnimators[o]||(this._zoomAnimators[o]=[]),n=0;n<r.y;n++)this._zoomAnimators[o][n]=new olleh.maps.fx.Animation({from:this._zoomAnimators[o][n]?this._zoomAnimators[o][n].ignore():{width:a.width+"px",height:a.height+"px",left:this._grid[o][n].getPosition().x+"px",top:this._grid[o][n].getPosition().y+"px"},to:{width:a.width*t+"px",height:a.height*t+"px",left:l.x+o*a.width*t+"px",top:l.y+(r.y-n-1)*a.height*t+"px"},duration:i,timing:olleh.maps.fx.timing.easeOut,pulse:s}).animate(this._grid[o][n].getElement())},zoomEnd:function(){this.maxWaitTime>=0&&this.isVisibleForZoom()?this._cleanTimer=olleh.maps.util.delay(this._cleanZoomingBufferDiv,1e3*this.maxWaitTime,this):this._cleanZoomingBufferDiv(),this.draw(!0)},_stopCleanTimer:function(){this._cleanTimer&&(window.clearTimeout(this._cleanTimer),this._cleanTimer=null)},_stopZoomAnimation:function(){var t,e;if(this._zoomingScale=null,this._zoomAnimator)this._zoomAnimator.stop(),this._zoomAnimator=null;else if(this._zoomAnimators){for(t=0;t<this._zoomAnimators.length;t++)for(e=0;e<this._zoomAnimators[t].length;e++)this._zoomAnimators[t][e].stop();this._zoomAnimators=null}this._stopCleanTimer()},_cleanZoomingBufferDiv:function(){var t,e;if(this._zoomingBufferDiv){for(this._pane.removeChild(this._zoomingBufferDiv),this._zoomingBufferDiv=null,t=0,e=this._zoomingTiles.length;t<e;t++)this._zoomingTiles[t].destroy();this._zoomingTiles=null}this._stopCleanTimer()},$capture_loaded:function(t){t.getSource()!==this&&(t.stopPropagation(),++this._loadedTileNum==this._unloadedTileNum&&this._onload())},_onload:function(){this._zoomAnimator||this._zoomAnimators||this._cleanZoomingBufferDiv(),this._loadedTileNum=0,this._unloadedTileNum=0,this.fireEvent("loaded")}}),$class("olleh.maps.layer.OllehTileLayer").extend(olleh.maps.layer.TileLayer).define({logoType:"black",_OUT_OF_BOUND_TILE_URL:olleh.maps.env.RESOURCE_URL+"img/tile_transparent.png",tileOrigin:new olleh.maps.UTMK(171162,1214781),tileMaxBounds:new olleh.maps.Bounds(new olleh.maps.UTMK(171162,1214781),new olleh.maps.UTMK(1744026,2787645)),OllehTileLayer:function(t){this.errorTileURL=olleh.maps.layer.OllehTileLayer.OUT_OF_BOUND_TILE_URL,this._maxTileIndex=[]},init:function(){olleh.maps.mixin(this,this._constructorOpts,!0,["tileURLTmpl","logoType"]),olleh.maps.layer.OllehTileLayer.$super.init.apply(this,arguments),"black"!==this.logoType&&(this.logoType="white")},getMaxTileIndex:function(){var t=this.layerMgr.getZoom(),e=this.getTileSize(),i=this._maxTileIndex[t];if(!i){var s=this.tileMaxBounds,o=this.layerMgr.getResolution(),n={width:e.width*o,height:e.height*o};i=this._maxTileIndex[t]={x:Math.floor((s.getRight()-s.getLeft())/n.width)-1,y:Math.floor((s.getTop()-s.getBottom())/n.height)-1}}return i},getTileURL:function(t,e){var i=olleh.maps.Map.DEFAULT_NORMAL_MAX_ZOOM,s=this.layerMgr.getZoom()>i?i:this.layerMgr.getZoom(),o=this.getMaxTileIndex(),n=this.index.x+t,a=o.y-(this.index.y+e);if(n<0||n>o.x||a<0||a>o.y)return this._OUT_OF_BOUND_TILE_URL;var r=this.tileURLTmpl.indexOf("gis.kt.com")>=0?{x:n,y:a,z:s}:{x:this._fillZero(n.toString(16),8),y:this._fillZero(a.toString(16),8),z:this._fillZero(s,2)};return olleh.maps.util.applyTemplate(this.tileURLTmpl,r)},_fillZero:function(t,e){return"00000000".substr(0,e-(t+"").length)+t}}),$class("olleh.maps.plugin.DefaultComponents").extend(olleh.maps.Adaptable).define({attach:function(){var t=this.map.getOption("hd",olleh.maps.browser.isHDTile)&&olleh.maps.browser.isHDTile,e=olleh.maps.env,i=new olleh.maps.layer.OllehTileLayer({name:"OllehBase",label:olleh.maps.msg("일반지도"),layerType:"base",logoType:"black",tileSize:t?new olleh.maps.Size(128,128):new olleh.maps.Size(256,256),tileURLTmpl:t?e.TILE_URL.HD_BASE:e.TILE_URL.BASE,errorTileURL:olleh.maps.env.RESOURCE_URL+"img/tile_nodata.jpg",copyright:t?e.TILE_COPYRIGHT.HD_BASE:e.TILE_COPYRIGHT.BASE,maxZoom:13});this.map.registerMapType("ROADMAP",i)},detach:function(){}}),olleh.maps.$skeleton.push(olleh.maps.plugin.DefaultComponents),$class("olleh.maps.layer.OllehAirMapType").extend(olleh.maps.Plugin).define({doActivate:function(){this.map.getLayer("OllehAir").activate(),this.map.layerMgr.setMaxZoom(14)}}),$class("olleh.maps.layer.OllehEngMapType").extend(olleh.maps.Plugin).define({doActivate:function(){this.map.getLayer("OllehEng").activate(),this.map.layerMgr.setMaxZoom(13)}}),$class("olleh.maps.layer.OllehHybridMapType").extend(olleh.maps.Plugin).define({doActivate:function(){this.map.layerMgr.setMaxZoom(13),this.map.getLayer("OllehAir").activate(),this.map.getLayer("OllehAirLabel").activate()},doDeactivate:function(){this.map.getLayer("OllehAirLabel").deactivate()}}),$class("olleh.maps.layer.OllehTilesPlugin").extend(olleh.maps.Adaptable).define({attach:function(){this.env=olleh.maps.env,this.useHD=this.map.getOption("hd",olleh.maps.browser.isHDTile)&&olleh.maps.browser.isHDTile,this.setAirMap(),this.setEngMap(),this.setHybridMap()},setHybridMap:function(){new olleh.maps.layer.OllehTileLayer({name:"OllehAirLabel",label:olleh.maps.msg("하이브리드 라벨"),layerType:"ground",zIndex:0,tileSize:this.useHD?new olleh.maps.Size(128,128):new olleh.maps.Size(256,256),tileURLTmpl:this.useHD?this.env.TILE_URL.HD_HYBRID:this.env.TILE_URL.HYBRID,maxWaitTime:.7,maxZoom:13}).setMap(this.map),this.ollehHybridMapType=new olleh.maps.layer.OllehHybridMapType,this.map.registerMapType("HYBRID",this.ollehHybridMapType)},setAirMap:function(){new olleh.maps.layer.OllehTileLayer({name:"OllehAir",label:olleh.maps.msg("위성지도"),layerType:"base",logoType:"white",tileURLTmpl:this.env.TILE_URL.AIR,errorTileURL:this.env.RESOURCE_URL+"img/tile_nodata.jpg",copyright:this.env.TILE_COPYRIGHT.AIR,maxZoom:14}).setMap(this.map),this.ollehAirMapType=new olleh.maps.layer.OllehAirMapType,this.map.registerMapType("SATELLITE",this.ollehAirMapType)},setEngMap:function(){new olleh.maps.layer.OllehTileLayer({name:"OllehEng",label:olleh.maps.msg("영문지도"),layerType:"base",logoType:"black",tileURLTmpl:this.env.TILE_URL.ENG,errorTileURL:this.env.RESOURCE_URL+"img/tile_nodata.jpg",copyright:this.env.TILE_COPYRIGHT.ENG,maxZoom:13}).setMap(this.map),this.ollehEngMapType=new olleh.maps.layer.OllehEngMapType,this.map.registerMapType("ENGMAP",this.ollehEngMapType)},detach:function(){}}),olleh.maps.$skeleton.push(olleh.maps.layer.OllehTilesPlugin),$class("olleh.maps.fx.timing.EaseInQuad").extend(olleh.maps.fx.timing.Timing).define({genFn:function(){return function(t){return t*t}}}),$class("olleh.maps.fx.timing.EaseOutQuad").extend(olleh.maps.fx.timing.Timing).define({genFn:function(){return function(t){return t*(2-t)}}}),$class("olleh.maps.fx.timing.EaseInOutQuad").extend(olleh.maps.fx.timing.Timing).define({genFn:function(){return function(t){return t<.5?2*t*t:(4-2*t)*t-1}}}),$class("olleh.maps.control.TrafficInfoControl").extend(olleh.maps.control.Control).define({$static:{SPEED_INFO:{"원활":{color:"green",loadSpeed:{"국도,일반":"30㎞/h↑","도시고속":"60㎞/h↑","고속도로":"70㎞/h↑"}},"서행":{color:"yellow",loadSpeed:{"국도,일반":"20~30㎞/h","도시고속":"40~60㎞/h","고속도로":"50~70㎞/h"}},"지체":{color:"orange",loadSpeed:{"국도,일반":"10~20㎞/h","도시고속":"20~40㎞/h","고속도로":"30~50㎞/h"}},"정체":{color:"red",loadSpeed:{"국도,일반":"10㎞/h↓","도시고속":"20㎞/h↓","고속도로":"30㎞/h↓"}}}},TrafficInfoControl:function(t){var e=olleh.maps.mixin({position:olleh.maps.control.Control.BOTTOM_LEFT,direction:olleh.maps.control.Control.VERTICAL},t,!0);this.position=e.position,this.direction=e.direction},draw:function(){this.tooltips={},this.rdoms=[];var t=0,e=olleh.maps.control.TrafficInfoControl.SPEED_INFO,i=olleh.maps.Element.create("div"),s=document.createElement("h1"),o=document.createElement("div"),n=function(t,e){olleh.maps.util.dom.addClass(e,"ollehmap-hidden")},a=function(t,e){olleh.maps.util.dom.removeClass(e,"ollehmap-hidden")};s.innerHTML=olleh.maps.msg("실시간교통 범례"),this.registerEventDom(i.elem),i.addClass("ollehmap-traffic-control"),i.setStyles({padding:this.padding+"px",position:"relative"}),i.appendChild(s),i.appendChild(o),o.appendChild(document.createTextNode(" "+olleh.maps.msg("원활")+" ")),olleh.maps.util.dom.addClass(o,"imgDiv");for(var r in e){var l=e[r],h=olleh.maps.Element.create("div"),m=l.loadSpeed;if(h.addClass("trafficbar"),h.setStyles({backgroundColor:l.color,pointerEvents:"auto"}),o.appendChild(h.elem),m){var p=document.createElement("div"),d=document.createElement("ul");for(var u in m){var c=m[u],g=document.createElement("li");g.innerHTML='<span class="a1">'+olleh.maps.msg(u)+'</span><span class="a2">: '+c+"</span>",d.appendChild(g)}p.appendChild(d),olleh.maps.util.dom.setStyle(p,"backgroundImage","url("+olleh.maps.env.RESOURCE_URL+"img/controls.png)"),olleh.maps.util.dom.setStyle(p,"left",t+"px"),t+=55,olleh.maps.util.dom.addClass(p,"control-traffic-info"),olleh.maps.util.dom.addClass(p,"tooltip"),olleh.maps.util.dom.addClass(p,"ollehmap-hidden"),i.appendChild(p),this.tooltips[r]=p,h.addEventListener("mouseout",olleh.maps.curry(n,null,p)),h.addEventListener("mouseover",olleh.maps.curry(a,null,p))}this.rdoms.push(h)}o.appendChild(document.createTextNode(" "+olleh.maps.msg("정체")+" "));var f=document.createElement("ul");return f.innerHTML="<li>"+olleh.maps.msg("속도 정보 라인 위를 클릭하면, 상세 정보 확인 가능")+"</li><li>"+olleh.maps.msg("시내 도로는 신호 정차 등으로 실제 속도와 다를 수 있음")+"</li>",i.appendChild(f),i}}),$class("olleh.maps.control.MobileTrafficInfoControl").extend(olleh.maps.control.Control).define({MobileTrafficInfoControl:function(t){var e=olleh.maps.control.Control;this.position=e.TOP_RIGHT,this.direction=e.HORIZONTAL},draw:function(){var t=olleh.maps.Element.create("div").setStyles({padding:this.padding+"px"}),e=this._trafficImg=olleh.maps.Element.create("div").addClass("mobile-traffic-info");return olleh.maps.browser.isHD?e.addClass("retina").setStyle("backgroundImage","url("+olleh.maps.env.RESOURCE_URL+"img/retinas.png)"):e.setStyle("backgroundImage","url("+olleh.maps.env.RESOURCE_URL+"img/mobiles.png)"),t.appendChild(e),t}}),$class("olleh.maps.plugin.TrafficInfoPlugin").mixin(olleh.maps.Plugin).define({serviceId:"trafficInfo",pluginInfo:{label:olleh.maps.msg("실시간 교통"),autoActivate:!1,group:"ground"},attach:function(){this.trafficLayer=new olleh.maps.layer.OllehTileLayer({name:"OllehTraffic",layerType:"ground",zIndex:1,tileURLTmpl:olleh.maps.env.TILE_URL.TRAFFIC,maxWaitTime:.7,map:this.map}),this.trafficInfoControl||(olleh.maps.browser.isMobile?this.trafficInfoControl=new olleh.maps.control.MobileTrafficInfoControl:this.trafficInfoControl=new olleh.maps.control.TrafficInfoControl)},detach:function(){this.trafficLayer.setMap(null),this.trafficLayer=null,this.trafficInfoControl.setMap(null),this.trafficInfoControl=null},doActivate:function(){this.trafficLayer.activate(),this.trafficInfoControl.setMap(this.map)},doDeactivate:function(){this.trafficLayer.deactivate(),this.trafficInfoControl.setMap(null)}}),olleh.maps.$skeleton.push(olleh.maps.plugin.TrafficInfoPlugin),$class("olleh.maps.overlay.Overlay").extend(olleh.maps.Initializable).mixin(olleh.maps.event.EventDelegator,olleh.maps.Adaptable).define({Overlay:function(t){this._constructorOpts=t||{},this._bubble=null},init:function(){this.setOptions(this._constructorOpts),this._constructorOpts=null},setOptions:function(t){t.visible!==undefined&&this.setVisible(t.visible),t.map!==undefined&&this.setMap(t.map)},isAdded:function(){return!!this.layer},draw:function(t){},erase:function(t){},setVisible:function(t){},isVisible:function(){},zoomStart:function(t,e,i,s){},
zoomEnd:function(){},getBounds:function(){return null},getPosition:function(){return null},setBubble:function(t){this._bubble=t},getBubble:function(){return this._bubble||this.layer},getLayer:function(){return this.layer},attach:function(){this.map.getOverlayLayer().add(this)},detach:function(){this.layer&&this.layer.remove(this)},setDisplayHint:function(t){}}),$class("olleh.maps.overlay.BaseOverlay").extend(olleh.maps.overlay.Overlay).define({$static:{MAX_ZINDEX:357913940},BaseOverlay:function(){this._drawn=!1,this._visible=!0,this._zIndex="auto",this._displayHint=!0,this.elements={},this._moveAnimators=[]},setOptions:function(t){t.zIndex!==undefined&&this.setZIndex(t.zIndex),olleh.maps.overlay.BaseOverlay.$super.setOptions.apply(this,arguments)},update:function(){this._updateVisibility(),this._updateZIndex()},isVisible:function(){return this._visible},setVisible:function(t){this._visible!==t&&(this._visible=t,this._drawn&&this._updateVisibility(),this.fireEvent("visible_changed"))},setDisplayHint:function(t){this._displayHint!==t&&(this._displayHint=t,this.isDrawn()&&this._updateVisibility())},_updateVisibility:function(){var t=this._visible&&this._displayHint,e=t?"block":"none";this._display!==e&&(this._display=e,this.forEachElement(function(t,e){olleh.maps.util.dom.setStyle(e,"display",this._display)}))},getCurrentZIndex:function(){return this._currentZIndex},getZIndex:function(){return this._zIndex},setZIndex:function(t){this._zIndex="auto"==t?"auto":Math.min(olleh.maps.overlay.BaseOverlay.MAX_ZINDEX,t),this._drawn&&this._updateZIndex()},_updateZIndex:function(){var t;t=this._isFront?olleh.maps.overlay.BaseOverlay.MAX_ZINDEX:"auto"==this._zIndex?this.getAutoZIndex():this._zIndex,this._currentZIndex=t,this.forEachElement(function(e,i){olleh.maps.util.dom.setStyle(i,"zIndex",t)})},bringToFront:function(){this._isFront||(this._isFront=!0,this._drawn&&this._updateZIndex())},resetZIndex:function(){this._isFront&&(this._isFront=!1,this._drawn&&this._updateZIndex())},isRegistered:function(t,e){return this.elements[t]&&olleh.maps.util.indexOf(this.elements[t],e)>-1},registerElement:function(t,e){this.isRegistered(t,e)||(this.elements[t]?this.elements[t].push(e):this.elements[t]=[e],this.appendElement(t,e))},unregisterElement:function(t,e){this.isRegistered(t,e)&&(olleh.maps.util.removeFromArray(this.elements[t],e),this.removeElement(t,e))},appendElement:function(t,e){if(this._drawn){var i=this.getLayer().getPane(t);e.parentNode&&e.parentNode==i||(olleh.maps.util.dom.setStyles(e,this._currentStyles),i.appendChild(e))}},removeElement:function(t,e){e.parentNode&&e.parentNode.removeChild(e)},appendElements:function(){this.forEachElement(this.appendElement)},removeElements:function(){this.forEachElement(this.removeElement)},isDrawn:function(){return this._drawn},draw:function(t){this.layer&&(this.update(),this._drawn=!0,this.appendElements(),t?this.onAdd():this.ready(),this.registerEvent())},erase:function(t){this._drawn&&(this._drawn=!1,t?this.onRemove():this.cleanup(),this.unregisterEvent())},ready:function(){this.fireEvent("ready")},erased:function(){this.fireEvent("erased")},cleanup:function(){this.removeElements(),this.erased()},onAdd:function(){this._fadeInAnimation=this.getFadeInAnimation(),this._fadeInAnimation?(this._fadeInRequested=0,this._fadeInFinished=0,this.forEachElement(this._fadeInElement)):this.ready()},onRemove:function(){this._fadeOutAnimation=this.getFadeOutAnimation(),this._fadeOutAnimation?(this._removeRequested=0,this._removeFinished=0,this.forEachElement(this._fadeOutElement)):this.cleanup()},getFadeInAnimation:function(){return null},getFadeOutAnimation:function(){return null},_fadeInElement:function(t,e){olleh.maps.util.dom.setStyles(e,this._fadeInAnimation.from),this._fadeInRequested++,this._fadeInAnimation.animate(e,{callback:this._onFadeInFinished,ctx:this})},_fadeOutElement:function(t,e){var i=this;this._removeRequested++,this._fadeOutAnimation.animate(e,{callback:function(){this.parentNode&&this.parentNode.removeChild(this),i._onElementRemoved()}})},_onFadeInFinished:function(){++this._fadeInFinished==this._fadeInRequested&&this.ready()},_onElementRemoved:function(){++this._removeFinished==this._removeRequested&&this.erased()},isMoving:function(){return!!this._moveAnimators.length&&"finished"!=this._moveAnimators[0].status},stopAnimators:function(){var t,e,i=this._moveAnimators;for(t=0,e=i.length;t<e;t++)"finished"!=i[t].status&&i[t].stop();this._moveAnimators=[]},updatePositioningStyles:function(t){this._currentStyles=t,this.forEachElement(function(t,e){olleh.maps.util.dom.setStyles(e,this._currentStyles)})},animateTo:function(t,e,i,s,o){var n=this._currentStyles;this.stopAnimators(),e>0?(this._finishedAnimation=0,this._animationCallback=s,this._animationCallbackCtx=o,this.forEachElement(function(s,o){this._moveAnimators.push(new olleh.maps.fx.Animation({from:n,to:t,duration:e,pulse:i,timing:olleh.maps.fx.timing.easeOut,callback:this._animationFinished,ctx:this}).animate(o))}),this._currentStyles=t):(this.updatePositioningStyles(t),s&&s.call(o||this))},_animationFinished:function(){++this._finishedAnimation==this._moveAnimators.length&&(this._moveAnimators=[],this._animationCallback&&this._animationCallback.call(this._animationCallbackCtx||this))},forEachElement:function(t){var e,i,s,o;for(e in this.elements)if(o=this.elements[e])for(i=0,s=o.length;i<s;i++)t.apply(this,[e,o[i]])},detach:function(){this.stopAnimators(),olleh.maps.overlay.BaseOverlay.$super.detach.apply(this,arguments)}}),$class("olleh.maps.overlay.OverlayGroup").mixin(olleh.maps.event.EventDelegator,olleh.maps.Adaptable).define({OverlayGroup:function(t){this._overlays=[],this.layer=null,this._visible=!0,t&&!1===t.visible&&(this._visible=!1),t&&t.map&&this.setMap(t.map)},attach:function(){var t,e,i;for(t=0,e=this._overlays.length;t<e;t++)i=this._overlays[t],i.setMap(this.map)},detach:function(){var t,e,i;for(t=0,e=this._overlays.length;t<e;t++)i=this._overlays[t],i.setMap(null)},getBubble:function(){return this.map.getOverlayLayer()},add:function(t){this._overlays.push(t),t.setVisible(this._visible),this.map&&t.setMap(this.map),t.setBubble(this)},remove:function(t){olleh.maps.util.removeFromArray(this._overlays,t),this.map&&t.setMap(null),t.setBubble(null)},setVisible:function(t){if(this._visible!==t){var e,i=this._overlays.length;for(this._visible=t;i--;)e=this._overlays[i],e.setVisible(t)}},isVisible:function(){return this._visible}}),$class("olleh.maps.plugin.Overlay").extend(olleh.maps.Adaptable).define({attach:function(){this.map._opts=olleh.maps.mixin(this.map._opts,{overlayLayer:new olleh.maps.overlay.OverlayLayer},!0)},detach:function(){}}),olleh.maps.$skeleton.push(olleh.maps.plugin.Overlay),$class("olleh.maps.overlay.PointedOverlay").extend(olleh.maps.overlay.BaseOverlay).define({PointedOverlay:function(){},setOptions:function(t){t.position&&this.setPosition(t.position),olleh.maps.overlay.PointedOverlay.$super.setOptions.apply(this,arguments)},update:function(){this._updatePosition(),olleh.maps.overlay.PointedOverlay.$super.update.apply(this,arguments)},getIndexObject:function(){return this.getPosition()},getAutoZIndex:function(){var t=this._position.asDefault(),e=this.layer.layerMgr.getMaxExtent().getTop();return Math.round(e-t.y)},getPosition:function(){return this._position},setPosition:function(t){var e=this._position;t=olleh.maps.UTMK.valueOf(t),this._position=t,this.isDrawn()&&this._updatePosition(),this.fireEvent("position_changed",{from:e,to:t})},_updatePosition:function(){if(!this._position)throw new Error("Position is not set.");this._currentLayerPx=this.getOriginalLayerPx(),this.updatePositioningStyles(olleh.maps.util.dom.getPositionStyles(this._currentLayerPx.x,this._currentLayerPx.y))},zoomStart:function(t,e,i,s){var o=this.layer.layerMgr,n=o.getLayerPxFromCoord(this._position,!0);this.moveTo(n,i,s)},zoomEnd:function(){this.stopAnimators()},moveTo:function(t,e,i,s){this.animateTo(olleh.maps.util.dom.getPositionStyles(t.x,t.y),e,i,s),this._currentLayerPx=t},move:function(t,e,i,s){this.moveTo(this._currentLayerPx.add(t),e,i,s)},getOriginalLayerPx:function(){return this.layer.layerMgr.getLayerPxFromCoord(this._position)},getCurrentLayerPx:function(){return this._currentLayerPx},$default_mouseover:function(t,e){t.preventDefault(),this.bringToFront()},$default_mouseout:function(t,e){t.preventDefault(),this.resetZIndex()},$current_position_changed:function(t,e){this.isAdded()&&this._updateZIndex()}}),$class("olleh.maps.overlay.DropTiming").extend(olleh.maps.fx.timing.Timing).define({genFn:function(){return function(t){return t<.5?2*t*t:t*(t-1.5)+1.5}}}),$class("olleh.maps.overlay.Marker").extend(olleh.maps.overlay.PointedOverlay).define({$static:{DEFAULT_ICON:{url:olleh.maps.env.RESOURCE_URL+"img/markers.png",size:new olleh.maps.Size(28,40),origin:new olleh.maps.Point(0,1107)},DEFAULT_MOBILE_ICON:{url:olleh.maps.env.RESOURCE_URL+"img/mobiles.png",size:new olleh.maps.Size(25,37),origin:new olleh.maps.Point(78,80)},DEFAULT_HD_ICON:{url:olleh.maps.env.RESOURCE_URL+"img/retinas.png",size:new olleh.maps.Size(26,35),origin:new olleh.maps.Point(78,81),scaledSize:new olleh.maps.Size(170,155)},DEFAULT_SHADOW:{url:olleh.maps.env.RESOURCE_URL+"img/markers.png",size:new olleh.maps.Size(34,27),anchor:new olleh.maps.Point(6,27),origin:new olleh.maps.Point(0,1147)},DEFAULT_MOBILE_SHADOW:{url:olleh.maps.env.RESOURCE_URL+"img/mobiles.png",size:new olleh.maps.Size(27,20),origin:new olleh.maps.Point(128,80),anchor:new olleh.maps.Point(4,20)},DEFAULT_HD_SHADOW:{url:olleh.maps.env.RESOURCE_URL+"img/retinas.png",size:new olleh.maps.Size(27,20),origin:new olleh.maps.Point(126,80),anchor:new olleh.maps.Point(5,20),scaledSize:new olleh.maps.Size(170,155)},DRAG_POINT:{url:olleh.maps.env.RESOURCE_URL+"img/markers.png",size:new olleh.maps.Size(20,13),anchor:new olleh.maps.Point(10,5),origin:new olleh.maps.Point(0,1092)},DRAG_FLOATING_PX:10,BOUNCE:"bounce",DROP:"drop",bouncePulse:new olleh.maps.fx.Pulse(1),dropTiming:new olleh.maps.overlay.DropTiming,getBounceAnimator:function(t,e){var i,s;return e?(s=10*Math.SQRT1_2,i=-s):(s=10,i=0),new olleh.maps.fx.Animation({from:{marginLeft:-t.x+"px",marginTop:-t.y+"px"},to:{marginLeft:-(t.x+i)+"px",marginTop:-(t.y+s)+"px"},timing:olleh.maps.fx.timing.easeOut,comeback:!0,repeat:-1,duration:1,pulse:olleh.maps.overlay.Marker.bouncePulse})},getDropAnimator:function(t,e){var i,s;return e?(s=200*Math.SQRT1_2,i=-s):(s=200,i=0),new olleh.maps.fx.Animation({from:{marginLeft:-(t.x+i)+"px",marginTop:-(t.y+s)+"px"},to:{marginLeft:-t.x+"px",marginTop:-t.y+"px"},timing:olleh.maps.overlay.Marker.dropTiming,duration:.5})}},Marker:function(t){this._cursor="pointer",this._title="",this._flat=!1,this._draggable=!1,this._angle=0},setOptions:function(t){t.icon&&this.setIcon(t.icon),t.angle&&this.setAngle(t.angle),t.shadow&&this.setShadow(t.shadow),t.caption&&this.setCaption(t.caption),t.cursor&&this.setCursor(t.cursor),t.title&&this.setTitle(t.title),t.draggable&&this.setDraggable(t.draggable),t.flat&&this.setFlat(t.flat),t.animation&&this.setAnimation(t.animation),olleh.maps.overlay.Marker.$super.setOptions.apply(this,arguments)},update:function(){this._updateIcon(),this._updateAngle(),this._updateCursor(),this._updateShadow(),this._updateCaption(),this._updateAnimation(),olleh.maps.overlay.Marker.$super.update.apply(this,arguments)},erase:function(){olleh.maps.overlay.Marker.$super.erase.apply(this,arguments),this._infoWin&&this._infoWin.erase(),this._tooltip&&(this._tooltip.close(),delete this._tooltip)},getIcon:function(){return this._icon},setIcon:function(t){if(olleh.maps.isString(t))t={url:t};else if(!olleh.maps.isObject(t))throw new TypeError("Icon must be String or Object");if(!t.url)throw new TypeError("Icon url is undefined");t.size||(t.size=olleh.maps.overlay.Marker.DEFAULT_ICON.size),t.anchor||(t.anchor=new olleh.maps.Point(t.size.width/2,t.size.height)),this._icon!=t&&(this._icon=t,this.isDrawn()&&(this._updateIcon(),this.fireEvent("icon_changed")))},_updateIcon:function(){var t=this._icon,e=this._iconImg;if(!t){var i=olleh.maps.overlay.Marker;t=olleh.maps.browser.isHD?i.DEFAULT_HD_ICON:olleh.maps.browser.isMobile?i.DEFAULT_MOBILE_ICON:i.DEFAULT_ICON,this._icon=t,this.setIcon(t)}if(!e){var s=olleh.maps.Element.create("div").setStyle("position","absolute");e=this._iconImg=new olleh.maps.SpritedImage,s.appendChild(e),this._updateCursor(),this.registerElement("upper_overlay_pane",s.elem),this.registerEventDom(this._iconImg.elem)}this._currentIcon!=t&&(e.setStyles({width:t.size.width+"px",height:t.size.height+"px",marginLeft:-t.anchor.x+"px",marginTop:-t.anchor.y+"px"}).setImage(t.url,t.origin,t.scaledSize),this._currentIcon=t);var o=100-100*(t.size.width-t.anchor.x)/t.size.width+"% "+(100-100*(t.size.height-t.anchor.y)/t.size.height)+"%";e.setStyle("transformOrigin",o)},setAngle:function(t){this._angle=t,this.isDrawn()&&(this._updateAngle(),this.fireEvent("angle_changed"))},_updateAngle:function(){this._iconImg.setStyles({transform:"rotate("+this._angle+"deg)"})},getAngle:function(){return this._angle},getTitle:function(){return this._title},setTitle:function(t){this._title=t,this.isAdded()&&this.fireEvent("title_changed")},getCursor:function(){return this._cursor},setCursor:function(t){this._cursor=t,this.isDrawn()&&(this._updateCursor(),this.fireEvent("cursor_changed"))},_updateCursor:function(){this._iconImg.setStyle("cursor",this._cursor)},getShadow:function(){return this._shadowImg?this._shadow:null},setShadow:function(t){if(olleh.maps.isString(t))t={url:t};else if(!olleh.maps.isObject(t))throw new TypeError("Shadow must be String or Object");if(!t.url)throw new TypeError("Shadow url is undefined");t.size||(t.size=olleh.maps.overlay.Marker.DEFAULT_SHADOW.size),t.anchor||(t.anchor=new olleh.maps.Point(0,t.size.height)),this._shadow!=t&&(this._shadow=t,this.isDrawn()&&(this._updateShadow(),this.fireEvent("shadow_changed")))},_updateShadow:function(){var t=this._shadow,e=this._shadowImg,i=this.getLayer().disableShadow;t||(olleh.maps.browser.isHD?this._shadow=olleh.maps.overlay.Marker.DEFAULT_HD_SHADOW:olleh.maps.browser.isMobile?this._shadow=olleh.maps.overlay.Marker.DEFAULT_MOBILE_SHADOW:this._shadow=olleh.maps.overlay.Marker.DEFAULT_SHADOW,this.setShadow(this._shadow),t=this._shadow),i||this._flat?e&&(this.unregisterElement("overlay_shadow_pane",e.elem),this._shadowAnimator&&this._shadowAnimator.stop(),this._shadowAnimator=null,this._currentShadow=null,this._shadowImg=null):(e||(e=this._shadowImg=new olleh.maps.SpritedImage,this.registerElement("overlay_shadow_pane",e.elem)),this._currentShadow!=t&&(e.setStyles({width:t.size.width+"px",height:t.size.height+"px",marginLeft:-t.anchor.x+"px",marginTop:-t.anchor.y+"px"}).setImage(t.url,t.origin,t.scaledSize),this._currentShadow=t))},getCaption:function(){return this._caption},setCaption:function(t){if(olleh.maps.isString(t))t={title:t};else if(!olleh.maps.isObject(t))throw new TypeError("Caption must be String or Object");if(null===t.title||t.title===undefined)throw new TypeError("Caption title is undefined");this._caption=t,this.isDrawn()&&(this._updateCaption(),this.fireEvent("caption_changed"))},_updateCaption:function(){var t,e=this._captionDiv,i=this._caption;i?(i.size=i.size||9,i.backgroundColor=i.backgroundColor||"",i.color=i.color||"#000000",e?t=new olleh.maps.Element(e.elem.firstChild):(e=this._captionDiv=olleh.maps.Element.create("div").setStyles({position:"absolute",marginLeft:"-100px",width:"200px",textAlign:"center"}),t=olleh.maps.Element.create("span"),e.appendChild(t),this.registerElement("lower_overlay_pane",e.elem)),t.setStyles({backgroundColor:i.backgroundColor,color:i.color,fontSize:i.size+"pt",fontWeight:"bold",padding:"2px"}),t.elem.innerHTML=""+i.title):e&&(this.unregisterElement("lower_overlay_pane",e.elem),this._captionDiv=null)},isFlat:function(){return this._flat},setFlat:function(t){this._flat=t,this.isDrawn()&&(this._updateShadow(),this.fireEvent("flat_changed"))},isDraggable:function(){return this._draggable},isDragging:function(){return this._isDragging&&this._draggable},setDraggable:function(t){this._draggable!=t&&(this._draggable=t,this.fireEvent("draggable_changed"))},$capture_dragstart:function(t,e){if(this._draggable){var i=this._dragImg,s=olleh.maps.overlay.Marker.DRAG_FLOATING_PX;if(t.preventDefault(),this._isDragging=!0,!i){var o=olleh.maps.overlay.Marker.DRAG_POINT,n=o.size,a=o.anchor||new olleh.maps.Point(n.width/2,n.height);i=this._dragImg=(new olleh.maps.SpritedImage).setStyles({width:n.width+"px",height:n.height+"px",marginLeft:-a.x+"px",marginTop:-a.y+"px",zIndex:olleh.maps.overlay.BaseOverlay.MAX_ZINDEX}).setImage(o.url,o.origin)}this._tooltip&&(this._tooltip.close(),delete this._tooltip),this._iconImg.addClass("ollehmap-dragging"),this.registerElement("upper_overlay_pane",i.elem),this._float(s),this._infoWin&&this._infoWin._dragStart(new olleh.maps.Point(0,-s),new olleh.maps.Point(s,-s))}},$capture_drag:function(t,e){this.isDragging()&&(t.preventDefault(),this.move(e.movementXY),this._infoWin&&this._infoWin._drag(e.movementXY))},$capture_dragend:function(t,e){if(this.isDragging()){var i;t.preventDefault(),this.unregisterElement("upper_overlay_pane",this._dragImg.elem),this._sink(olleh.maps.overlay.Marker.DRAG_FLOATING_PX),i=this.getLayer().layerMgr.getCoordFromLayerPx(this._currentLayerPx),this.setPosition(i),this._infoWin&&this._infoWin._dragEnd(i),this._iconImg.removeClass("ollehmap-dragging"),this._isDragging=!1}},_float:function(t){var e,i,s;this._animation!=olleh.maps.overlay.Marker.BOUNCE&&(e=this._icon,i=e.anchor||new olleh.maps.Point(e.size.width/2,e.size.height),this._iconImg.setStyles({marginTop:-(i.y+t)+"px"}),this._shadowImg&&(e=this._shadow,i=e.anchor||new olleh.maps.Point(0,e.size.height),s=t*Math.SQRT1_2,this._shadowImg.setStyles({marginTop:-(i.y+s)+"px",marginLeft:-(i.x-s)+"px"})))},_sink:function(t){var e,i;this._animation!=olleh.maps.overlay.Marker.BOUNCE&&(e=this._icon,i=e.anchor||new olleh.maps.Point(e.size.width/2,e.size.height),this._iconImg.setStyles({marginTop:-i.y+"px"}),this._shadowImg&&(e=this._shadow,i=e.anchor||new olleh.maps.Point(0,e.size.height),this._shadowImg.setStyles({marginTop:-i.y+"px",marginLeft:-i.x+"px"})))},getAnimation:function(){return this._animation},setAnimation:function(t){this._animation!=t&&(this._animation=t,this.isDrawn()&&(this._updateAnimation(),this.fireEvent("animation_changed")))},_updateAnimation:function(){var t;this._animation?this._animation===olleh.maps.overlay.Marker.BOUNCE&&(this.stopAnimationImmediately(),t=this._icon.anchor||new olleh.maps.Point(this._icon.size.width/2,this._icon.size.height),this._iconAnimator=olleh.maps.overlay.Marker.getBounceAnimator(t).animate(this._iconImg.elem),this._shadowImg&&(t=this._shadow.anchor||new olleh.maps.Point(0,this._shadow.size.height),this._shadowAnimator=olleh.maps.overlay.Marker.getBounceAnimator(t,!0).animate(this._shadowImg.elem))):this.stopAnimation()},stopAnimation:function(){this._iconAnimator&&this._iconAnimator.stopRepeat(),this._shadowAnimator&&this._shadowAnimator.stopRepeat()},stopAnimationImmediately:function(){this._iconAnimator&&this._iconAnimator.stop(),this._shadowAnimator&&this._shadowAnimator.stop()},onAdd:function(){var t,e;this._animation===olleh.maps.overlay.Marker.DROP?(t=this._icon.anchor||new olleh.maps.Point(this._icon.size.width/2,this._icon.size.height),e=olleh.maps.overlay.Marker.getDropAnimator(t),this._iconImg.setStyles(e.from),e.animate(this._iconImg.elem,{callback:this.ready,ctx:this}),this._shadowImg&&(t=this._shadow.anchor||new olleh.maps.Point(0,this._shadow.size.height),e=olleh.maps.overlay.Marker.getDropAnimator(t,!0),this._shadowImg.setStyles(e.from),e.animate(this._shadowImg.elem))):this.ready()},getBounds:function(){return this._infoWin?this._infoWin.getBounds().union(this._position):null},setInfoWindow:function(t){null==t&&this.resetZIndex(),this._infoWin=t},setPosition:function(t){olleh.maps.overlay.Marker.$super.setPosition.apply(this,arguments),this._infoWin&&this._infoWin.setPosition(t)},detach:function(){this.stopAnimationImmediately(),this._infoWin&&(this._infoWin.close(),this._infoWin=null),olleh.maps.overlay.Marker.$super.detach.apply(this,arguments)},$default_mouseover:function(t,e){if(!this.isDragging()&&this._title){var i=this.map.getTooltip();i&&(i.setContent(this._title),i.setPixelOffset(new olleh.maps.Point(0,0)),i.open(this.map,this),this._tooltip=i)}olleh.maps.overlay.Marker.$super.$default_mouseover.apply(this,arguments)},$default_mouseout:function(t,e){this._tooltip&&(this._tooltip.close(),delete this._tooltip),this._infoWin||olleh.maps.overlay.Marker.$super.$default_mouseout.apply(this,arguments)},zoomStart:function(t,e,i){this.isDragging()||olleh.maps.overlay.Marker.$super.zoomStart.apply(this,arguments)},zoomEnd:function(){this.isDragging()?this.moveTo(this.getCurrentLayerPx()):olleh.maps.overlay.Marker.$super.zoomEnd.apply(this,arguments)}}),$class("olleh.maps.overlay.ContentOverlay").extend(olleh.maps.overlay.PointedOverlay).define({ContentOverlay:function(t){this.name="olleh.maps.overlay.ContentOverlay",this._defaultCss=null,this._defaultPadding=0,this._body=null,this._shadow=null,this._marginPx=null,this._topleftPx=null,this._bounds=null,this._opts={},this._opts.pixelOffset=new olleh.maps.Point(0,0),this._contentAttacted=!1,this.contentSize={minWidth:10,minHeight:10,maxWidth:800,maxHeight:800}},$default_detached:function(t,e){this._eliminateElements(),t.preventDefault()},setOptions:function(t){if(t.maxWidth){var e=parseInt(t.maxWidth);t.maxWidth=Math.min(e,this.contentSize.maxWidth)}else this._opts.maxWidth?t.maxWidth=this._opts.maxWidth:t.maxWidth=this.contentSize.maxWidth;this._setMaxWidth(t.maxWidth),t.padding&&(t.padding=parseInt(t.padding),this._setPadding(t.padding)),t.pixelOffset&&this.setPixelOffset(t.pixelOffset),olleh.maps.mixin(this._opts,t,!0),t.content?this.setContent(t.content):t.padding==undefined&&t.maxWidth==undefined||this._body&&this._updateContent(this._body.contentElem.children[0]),olleh.maps.overlay.ContentOverlay.$super.setOptions.call(this,this._opts)},update:function(){this._body||this._updateElements(),olleh.maps.overlay.ContentOverlay.$super.update.apply(this,arguments)},draw:function(t){olleh.maps.overlay.ContentOverlay.$super.draw.apply(this,arguments),this._contentAttacted||(this._contentAttacted=!0,this.fireEvent("domready"))},setContent:function(t){this._opts.content=t,this._contentAttacted=!1,this.isAdded()&&(this._updateContent(),this.isDrawn()&&(this._contentAttacted=!0,this.fireEvent("domready")),this.fireEvent("content_changed"))},_updateContent:function(t){this.isAdded()&&(this._eliminateElements(),this._updateElements(t),olleh.maps.overlay.ContentOverlay.$super.update.apply(this,arguments))},getContent:function(t){return this._opts.content},setPosition:function(t){var e=this._position;this._opts.position=t,this._position=t,this.isAdded()&&(this._updateMargin(),this._updateBounds(),this.isDrawn()&&this._updatePosition(),this.fireEvent("position_changed",{from:e,to:t}))},getPosition:function(){return this._opts.position},setPixelOffset:function(t){this._opts.pixelOffset=t,this.isAdded()&&(this._updateMargin(),this._updateBounds(),this.isDrawn()&&this._updatePosition())},getPixelOffset:function(){return this._opts.pixelOffset},createBodyElem:function(t,e){},createShadowElem:function(t,e){},_setMaxWidth:function(t){this._opts.maxWidth=t},_setPadding:function(t){if(2*t>=this.contentSize.maxWidth)throw new RangeError("padding 값이 너무 큽니다."+this.contentSize.maxWidth/2+"보다 작아야 합니다.");this._opts.padding=t},_updateElements:function(t){var e=olleh.maps.util.dom,i=this._opts,s=this._checkContentSize(t),o=i.position,n=this.layer.layerMgr,a=n.getLayerPxFromCoord(o);if(a=new olleh.maps.Point(Math.round(a.x),Math.round(a.y)),this._body=this.createBodyElem(s,a),this._topLeftPx={body:this._body.topLeftPoint.subtract(a)},t==undefined){var r=i.content,l=document.createElement("div");olleh.maps.isString(r)?l.innerHTML=r:e.pushElement(l,r),e.addClass(l,this._defaultCss),e.pushElement(this._body.contentElem,l)}else e.pushElement(this._body.contentElem,t);this.registerElement("infowindow_pane",this._body.rootElem),this.layer.disableShadow||(this._shadow=this.createShadowElem(s,a),this._shadow&&(this.registerElement("infowindow_shadow_pane",this._shadow.rootElem),this._topLeftPx.shadow=this._shadow.topLeftPoint.subtract(a))),this._appendEvent(),this._updateMargin(),this._updateBounds()},_updateMargin:function(){var t=this._opts.pixelOffset;this._marginPx={body:this._topLeftPx.body.add(t)},this._shadow&&(this._marginPx.shadow=this._topLeftPx.shadow.add(t))},_updateBounds:function(){var t=this._bounds,e=this.layer.layerMgr,i=this._opts.position,s=e.getLayerPxFromCoord(i),o=this._marginPx.body.add(s),n=e.getCoordFromLayerPx(new olleh.maps.Point(o.x,o.y+this._body.size.height)),a=e.getCoordFromLayerPx(new olleh.maps.Point(o.x+this._body.size.width,o.y));if(this._bounds=new olleh.maps.Bounds(n,a),this._shadow){var r=this._marginPx.shadow.add(s),l=e.getCoordFromLayerPx(new olleh.maps.Point(r.x,r.y+this._shadow.size.height)),h=e.getCoordFromLayerPx(new olleh.maps.Point(r.x+this._shadow.size.width,r.y)),m=new olleh.maps.Bounds(l,h);this._bounds=this._bounds.union(m)}this.fireEvent("bounds_changed",{from:t,to:this._bounds})},_updatePosition:function(){var t=this._body,e=this._marginPx.body;if(t.rootElem.style.marginTop=e.y+"px",t.rootElem.style.marginLeft=e.x+"px",this._shadow){var i=this._shadow,s=this._marginPx.shadow;i.rootElem.style.marginTop=s.y+"px",i.rootElem.style.marginLeft=s.x+"px"}olleh.maps.overlay.ContentOverlay.$super._updatePosition.apply(this)},getBounds:function(){return this._body||this._updateElements(),this._bounds},zoomEnd:function(){this._updateBounds(),olleh.maps.overlay.ContentOverlay.$super.zoomEnd.apply(this)},_checkContentSize:function(t){var e=document.createElement("div"),i=document.createElement("div"),s=olleh.maps.util.dom,o=this._opts.maxWidth?this._opts.maxWidth:this.contentSize.maxWidth,n=this._opts.padding==undefined?this._defaultPadding:this._opts.padding,a=2*n;if(s.setStyles(e,{position:"absolute",left:"10000px",top:"0px",width:o-a+"px",height:this.contentSize.maxHeight-a+"px",margin:"0px",padding:"0px",opacity:0}),s.setStyles(i,{position:"absolute",overflow:"auto",minWidth:Math.max(0,this.contentSize.minWidth-a)+"px",minHeight:Math.max(0,this.contentSize.minHeight-a)+"px",maxWidth:o-a+"px",maxHeight:this.contentSize.maxHeight-a+"px"}),s.addClass(i,this._defaultCss),e.appendChild(i),t==undefined){var r=this._opts.content;olleh.maps.isString(r)?i.innerHTML=r:s.pushElement(i,r)}else s.pushElement(i,t);var l=this.layer.getPane("infowindow_pane");s.pushElement(l,e);var h=new olleh.maps.Size(i.offsetWidth,i.offsetHeight);return s.popElement(l,e),h},_appendEvent:function(){var t=this._body;this.registerEventDom(t.contentElem),!this._opts.disableCloseButton&&t.closeElem&&this.registerEventDom(t.closeElem)},_eliminateElements:function(){this.unregisterElement("infowindow_pane",this._body.rootElem),this._shadow&&this.unregisterElement("infowindow_shadow_pane",this._shadow.rootElem),this._topleftPx=null,this._body=null,this._shadow=null,this._marginPx=null,this._contentAttacted=!1}}),$class("olleh.maps.overlay.BaseInfoWindow").extend(olleh.maps.overlay.ContentOverlay).define({$static:{AUTO_PAN_MARGIN:10},BaseInfoWindow:function(t){this.name="olleh.maps.overlay.BaseInfoWindow",this._defaultCss="ollehmap-info-defaultStyle",this._defaultPadding=18,this._anchor=null,this._body=null,this._shadow=null,this._anchorOffset=null,this.contentSize={minWidth:300,minHeight:60,maxWidth:600,maxHeight:500}},$default_attached:function(t,e){t.preventDefault(),this._opts.disableAutoPan||(this._body||this._updateElements(),this._autoPan())},propagateEvent:function(t,e){try{switch(t.getName()){case"attached":case"detached":case"position_changed":case"bounds_changed":case"click":break;default:t.preventDefault(),t.stopPropagation()}}finally{olleh.maps.overlay.BaseInfoWindow.$super.propagateEvent.apply(this,arguments)}},$capture_click:function(t,e){t.stopPropagation(),(this._opts.disableCloseButton||this._body.closeElem!==t.targetDOM)&&t.preventDefault()},$default_click:function(t,e){t.preventDefault(),this._opts.disableCloseButton||this._body.closeElem!==t.targetDOM||(this.fireEvent("close_click"),this.close())},open:function(t,e){if(this._anchor instanceof olleh.maps.overlay.Marker&&this._anchor.setInfoWindow(null),e){this._anchor||(this._optsPosition=this._opts.position);var i=null;if(e instanceof olleh.maps.Coord)i=e;else if(e instanceof olleh.maps.Point)i=t.layerMgr.getCoordFromViewportPx(e);else if(e instanceof olleh.maps.overlay.Marker){e.setInfoWindow(this);var s=e.getIcon(),o=e.getShadow();this._anchorOffset={},this._anchorOffset.body=new olleh.maps.Point(Math.round(s.size.width/2-s.anchor.x),-s.size.height),this._anchorOffset.shadow=o?new olleh.maps.Point(Math.round(o.size.width-o.anchor.x),-o.size.height):new olleh.maps.Point(Math.round(s.size.width/2-s.anchor.x),-s.size.height),i=e.getPosition()}else{if(!(e instanceof olleh.maps.overlay.Overlay))throw new TypeError("anchor parameter is incorrect");if(e.getPosition())i=e.getPosition();else{if(!e.getBounds())throw new TypeError("anchor parameter must have a position");i=e.getBounds().getCenter()}}this._anchor=e,this._setPosition(i)}else if(this._anchor&&this.isAdded()){if(this._anchor=null,this._anchorOffset=null,!this._optsPosition)throw new Error("Option's Position value is not exist");this._setPosition(this._optsPosition),this._optsPosition=null}this.isAdded()?this._opts.disableAutoPan||this._autoPan():this.setMap(t)},close:function(){this.isAdded()&&(this._anchor instanceof olleh.maps.overlay.Marker&&this._anchor.setInfoWindow(null),this.setMap(null))},$default_detached:function(t,e){olleh.maps.overlay.BaseInfoWindow.$super.$default_detached.apply(this,arguments),this._anchor=null,this._anchorOffset=null,this._optsPosition=null},setZIndex:function(t){this._opts.zIndex=t,olleh.maps.overlay.BaseInfoWindow.$super.setZIndex.call(this,t),this.fireEvent("zIndex_changed")},_setPosition:function(t){olleh.maps.overlay.BaseInfoWindow.$super.setPosition.apply(this,arguments)},setPosition:function(t){this._optsPosition&&(this._optsPosition=t),olleh.maps.overlay.BaseInfoWindow.$super.setPosition.apply(this,arguments)},_dragStart:function(t,e){this.bringToFront(),this._dragUpPoint={body:t,shadow:e},this._marginPx.body=this._marginPx.body.add(this._dragUpPoint.body),this._shadow&&(this._marginPx.shadow=this._marginPx.shadow.add(this._dragUpPoint.shadow)),this._updatePosition()},_drag:function(t){this.move(t)},_dragEnd:function(t){this.resetZIndex(),this._marginPx.body=this._marginPx.body.subtract(this._dragUpPoint.body),this._shadow&&(this._marginPx.shadow=this._marginPx.shadow.subtract(this._dragUpPoint.shadow)),this._updatePosition(),this.setPosition(t)},_updateMargin:function(){var t=this._opts.pixelOffset;this._anchor instanceof olleh.maps.overlay.Marker?(this._marginPx={body:this._topLeftPx.body.add(t.add(this._anchorOffset.body))},this._shadow&&(this._marginPx.shadow=this._topLeftPx.shadow.add(t.add(this._anchorOffset.shadow)))):olleh.maps.overlay.BaseInfoWindow.$super._updateMargin.apply(this,arguments)},_autoPan:function(){var t=this.getMap().getOverlayLayer().layerMgr,e=olleh.maps.overlay.BaseInfoWindow,i=t.getLayerPxFromCoord(t.getCenter()),s=new olleh.maps.Point(Math.round(i.x),Math.round(i.y)),o=t.getViewportSize(),n=Math.round(o.width/2),a=Math.round(o.height/2),r=t.getLayerPxFromViewportPx(new olleh.maps.Point(0,0)),l=t.getLayerPxFromViewportPx(t.getViewportSize().asPoint()),h=this._calInfoData(),m=this.getOriginalLayerPx(),p=h.size,d=h.topLeft,u=h.bottomRight,c=m.x,g=m.y,f=d.subtract(r),_=l.subtract(u),v=!0,y=!0;if(f.x>0&&_.x>0&&(v=!1,c=s.x),f.y>0&&_.y>0&&(y=!1,g=s.y),v||y){var x=o.subtract(p),w=x.width<0,E=x.height<0,b=s.subtract(m),P=b.x>0,C=b.y>0
;v&&(c=w?d.x-e.AUTO_PAN_MARGIN+n:P?d.x-e.AUTO_PAN_MARGIN+n:d.x+p.width+e.AUTO_PAN_MARGIN-n),y&&(g=E?d.y-e.AUTO_PAN_MARGIN+a:C?d.y-e.AUTO_PAN_MARGIN+a:a<p.height&&_.y>0?d.y-e.AUTO_PAN_MARGIN+a:u.y+e.AUTO_PAN_MARGIN-a);var T=t.getCoordFromLayerPx(new olleh.maps.Point(c,g));t.panTo(T)}},_calInfoData:function(){var t=this.getOriginalLayerPx(),e=this._body.size,i=t.add(this._marginPx.body),s=i.add(new olleh.maps.Point(e.width,e.height)),o=i.clone(),n=s.clone();t.x<i.x?o.x=t.x:t.x>s.x&&(n.x=t.x),t.y<i.y?o.y=t.y:t.y>s.y&&(n.y=t.y);var a=n.subtract(o);return{topLeft:o,bottomRight:n,size:new olleh.maps.Size(a.x,a.y)}}}),$class("olleh.maps.overlay.InfoWindow").extend(olleh.maps.overlay.BaseInfoWindow).define({$static:{URL:olleh.maps.env.RESOURCE_URL,SHADOW_URL:"img/infowins.png",INFO_URL:"img/infowins.png",CLOSE_URL:"img/infowins.png",BORDER:2,TIP_POS_RATE:0,TIP_POS_MAXLEFT:45,TIP_HEIGHT:26,TIP_NOVIEW_HEIGHT:2,SHADOW_LEFT_HYPOTENUSE:-366,SHADOW_RIGHT_HYPOTENUSE:-1106,SHADOW_LEFT_HYPOTENUSE_HEIGHT_WIDTH_GAP:70,SHADOW_IMG_TIP_GAP:18,SHADOW_IMG_TIP_WIDTH:40,SHADOW_IMG_TOP_HEIGHT:10,SHADOW_IMG_TOP_WIDTH:70,SHADOW_IMG_BOTTOM_HEIGHT:30,SHADOW_IMG_BOTTOM_WIDTH:70,SHADOW_IMG_LEFTTOP_WIDTH:40,SHADOW_IMG_RIGHTTOP_WIDTH:30,SHADOW_IMG_LEFTBOTTOM_WIDTH:52,SHADOW_IMG_RIGHTBOTTOM_WIDTH:30,SHADOW_IMG_LEFTBOTTOM_W_PADDING:3,INFO_TMPL:['<div class="ollehmap-info-area" style="width:#{infoBodyWidth}px;height:#{infoBodyHeight}px;">','<div class="ollehmap-info-content" style="max-width:#{contentMaxWidth}px;">','<div class="ollehmap-info-content-overflow" style="padding:#{contentPadding}px;width:#{contentWidth}px;height:#{contentHeight}px;"></div>',"</div>",'<div class="ollehmap-info-close">','<img class="ollehmap-info-close-img" src="#{closeUrl}" draggable="false"></img>',"</div>","</div>",'<div class="ollehmap-info-tip" style="top:#{infoTopofTip}px;left:#{infoleftofTip}px;">','<img class="ollehmap-info-tip-img" src="#{infoUrl}"></img>',"</div>"].join(""),INFO_SHADOW_TMPL:['<div class="ollehmap-info-shadow-topleft" style="left:#{topLeftPoint}px;">','<img src="#{url}" draggable="false">',"</div>",'<div class="ollehmap-info-shadow-topright" style="left:#{topRightPoint}px;">','<img src="#{url}" draggable="false">',"</div>",'<div class="ollehmap-info-shadow-bottomleft" style="left:#{bottomLeftPointX}px; top:#{bottomLeftPointY}px; ">','<img src="#{url}" draggable="false">',"</div>",'<div class="ollehmap-info-shadow-bottomright" style="left:#{bottomRightPointX}px; top:#{bottomRightPointY}px;">','<img src="#{url}" draggable="false">',"</div>",'<div class="ollehmap-info-shadow-bottomtip" style="left:#{bottomTipPointX}px; top:#{bottomTipPointY}px;">','<img src="#{url}" draggable="false">',"</div>",'<div class="ollehmap-info-shadow-topcenter" style="left:#{topCenterPointX}px; top:#{topCenterPointY}px; width:#{topCenterWidth}px; ">','<img src="#{url}" draggable="false">',"</div>",'<div class="ollehmap-info-shadow-centerleft" style="left:#{middleLeftPointX}px; top:#{middleLeftPointY}px; width:#{middleLeftWidth}px; height:#{middleLeftHeight}px;">','<img style="left:#{middleLeftImgLeftPx}px;" src="#{url}" draggable="false">',"</div>",'<div class="ollehmap-info-shadow-centerright" style="left:#{middleRightPointX}px; top:#{middleRightPointY}px; width:#{middleRightWidth}px; height:#{middleRightHeight}px;">','<img style="left:#{middleRightImgLeftPx}px;" src="#{url}" draggable="false">',"</div>",'<div class="ollehmap-info-shadow-bottomleftoftip" style="left:#{bottomLeftOfTipPointX}px; top:#{bottomLeftOfTipPointY}px; width:#{bottomLeftOfTipWidth}px;">','<img src="#{url}" draggable="false">',"</div>",'<div class="ollehmap-info-shadow-bottomrightoftip" style="left:#{bottomRightOfTipPointX}px; top:#{bottomRightOfTipPointY}px; width:#{bottomRightOfTipRightWidth}px;">','<img src="#{url}" draggable="false">',"</div>",'<div class="ollehmap-info-shadow-center" style="left:#{middlePointX}px; top:#{middlePointY}px; width:#{middleWidth}px; height:#{middleHeight}px;">','<img src="#{url}" draggable="false">',"</div>"].join("")},createBodyElem:function(t,e){var i=olleh.maps.overlay.InfoWindow,s=olleh.maps.util.dom,o=this._opts.padding==undefined?this._defaultPadding:this._opts.padding,n=t.width+2*o,a=t.height+2*o,r=n+2*i.BORDER,l=a+i.TIP_HEIGHT+2*i.BORDER,h=e.y-l,m=i.TIP_POS_RATE*t.width;m>i.TIP_POS_MAXLEFT&&(m=0);var p=o+i.BORDER+Math.ceil(t.width/2-m),d=e.x-p-i.BORDER,u=a+2*i.BORDER-i.TIP_NOVIEW_HEIGHT,c=document.createElement("div"),g={infoBodyWidth:n,infoBodyHeight:a,contentPadding:o,closeUrl:i.URL+i.CLOSE_URL,infoUrl:i.URL+i.INFO_URL,contentMaxWidth:this._opts.maxWidth,contentWidth:t.width,contentHeight:t.height,infoTopofTip:u,infoleftofTip:p};s.addClass(c,"ollehmap-info"),c.innerHTML=olleh.maps.util.applyTemplate(i.INFO_TMPL,g);var f=c.childNodes[0].childNodes[1];return this._opts.disableCloseButton&&(s.removeElements(f),f=null),{rootElem:c,contentElem:c.childNodes[0].childNodes[0].children[0],closeElem:f,size:new olleh.maps.Size(r,l),topLeftPoint:new olleh.maps.Point(d,h)}},createShadowElem:function(t,e){var i=olleh.maps.util.dom,s=olleh.maps.overlay.InfoWindow,o=this._opts.padding==undefined?this._defaultPadding:this._opts.padding,n=t.width+2*s.BORDER+2*o,a=t.height+2*s.BORDER+2*o,r=a+s.TIP_HEIGHT,l=s.TIP_POS_RATE*t.width;l>s.TIP_POS_MAXLEFT&&(l=0);var h=o+Math.ceil(t.width/2-l),m=Math.round(r/2),p=n,d=h-s.SHADOW_IMG_TIP_GAP,u=e.y-m,c=e.x-h,g=document.createElement("div");i.addClass(g,"ollehmap-info-shadow"),i.addClass(g,"ollehmap-noevent");var f=m-s.SHADOW_IMG_TOP_HEIGHT-s.SHADOW_IMG_BOTTOM_HEIGHT,_=p-s.SHADOW_IMG_LEFTTOP_WIDTH-s.SHADOW_IMG_RIGHTTOP_WIDTH,v=d-s.SHADOW_IMG_LEFTBOTTOM_WIDTH,y=p-d-s.SHADOW_IMG_TIP_WIDTH-s.SHADOW_IMG_RIGHTBOTTOM_WIDTH,x=s.SHADOW_IMG_BOTTOM_WIDTH,w=s.SHADOW_IMG_TOP_HEIGHT+f,E=new olleh.maps.Point(0,w),b=new olleh.maps.Point(x,w),P=v;x+=v;var C=new olleh.maps.Point(x,w);x+=s.SHADOW_IMG_TIP_WIDTH;var T=new olleh.maps.Point(x,w),M=y;x+=y;var S=new olleh.maps.Point(x,w),A=f+s.SHADOW_LEFT_HYPOTENUSE_HEIGHT_WIDTH_GAP;x=s.SHADOW_IMG_LEFTBOTTOM_W_PADDING,w=s.SHADOW_IMG_TOP_HEIGHT;var O=new olleh.maps.Point(x,w),L=new olleh.maps.Size(A,f),I=s.SHADOW_LEFT_HYPOTENUSE+A;x+=A;var D=new olleh.maps.Point(x,w),R=new olleh.maps.Size(Math.max(p-A,0),f);x+=parseFloat(R.width);var k=new olleh.maps.Point(x,w),z=new olleh.maps.Size(A,f),F=s.SHADOW_RIGHT_HYPOTENUSE+A;x=s.SHADOW_IMG_LEFTBOTTOM_W_PADDING+A-s.SHADOW_IMG_TOP_WIDTH;var B=new olleh.maps.Point(x,0);x+=s.SHADOW_IMG_TOP_WIDTH;var N=new olleh.maps.Point(x,0),j=_;x+=_;var H=new olleh.maps.Point(x,0),Z={topLeftPoint:B.x,topRightPoint:H.x,bottomLeftPointX:E.x,bottomLeftPointY:E.y,bottomRightPointX:S.x,bottomRightPointY:S.y,bottomTipPointX:C.x,bottomTipPointY:C.y,topCenterPointX:N.x,topCenterPointY:N.y,topCenterWidth:j,middleLeftPointX:O.x,middleLeftPointY:O.y,middleLeftWidth:L.width,middleLeftHeight:L.height,middleRightPointX:k.x,middleRightPointY:k.y,middleRightWidth:z.width,middleRightHeight:z.height,bottomLeftOfTipPointX:b.x,bottomLeftOfTipPointY:b.y,bottomLeftOfTipWidth:P,bottomRightOfTipPointX:T.x,bottomRightOfTipPointY:T.y,bottomRightOfTipRightWidth:M,middlePointX:D.x,middlePointY:D.y,middleWidth:R.width,middleHeight:R.height,middleLeftImgLeftPx:I,middleRightImgLeftPx:F,url:s.URL+s.SHADOW_URL};return g.innerHTML=olleh.maps.util.applyTemplate(s.INFO_SHADOW_TMPL,Z),{rootElem:g,size:new olleh.maps.Size(p+m*Math.tan(Math.PI/4),m),topLeftPoint:new olleh.maps.Point(c,u)}}}),$class("olleh.maps.overlay.Tooltip").extend(olleh.maps.overlay.ContentOverlay).define({$static:{BORDER:1,TOOLTIP_TMPL:['<div class="ollehmap-info-tooltip-area" style="width:#{bodyWidth}px;height: #{bodyHeight}px;">','<div class="ollehmap-info-tooltip-content" style="max-width:#{contentMaxWidth}px;max-height:#{contentMaxHeight}px">','<div class="ollehmap-info-content-overflow" style="padding:#{contentPadding}px;width:#{contentWidth}px;height:#{contentHeight}px;"></div>',"</div>","</div>"].join("")},Tooltip:function(t){this._defaultCss="ollehmap-info-tooltip-data",this._defaultPadding=4},setOptions:function(t){t.zIndex==undefined&&(t.zIndex=olleh.maps.overlay.BaseOverlay.MAX_ZINDEX),olleh.maps.overlay.Tooltip.$super.setOptions.call(this,t)},createBodyElem:function(t,e){var i=olleh.maps.overlay.Tooltip;t.width+=1;var s=this._opts.padding==undefined?this._defaultPadding:this._opts.padding,o=t.width+2*s,n=t.height+2*s,a=n+2*i.BORDER,r=o+2*i.BORDER,l=olleh.maps.util.dom,h=document.createElement("div");l.addClass(h,"ollehmap-info");var m={bodyWidth:o,bodyHeight:n,contentPadding:s,contentMaxWidth:this._opts.maxWidth,contentMaxHeight:this.contentSize.maxHeight,contentWidth:t.width,contentHeight:t.height};return h.innerHTML=olleh.maps.util.applyTemplate(i.TOOLTIP_TMPL,m),{rootElem:h,contentElem:h.childNodes[0].childNodes[0].childNodes[0],closeElem:null,size:new olleh.maps.Size(r,a),topLeftPoint:e}},_calTooltipPosition:function(){var t=this.getMap().getOverlayLayer().layerMgr,e=this._body.size,i=this._opts.pixelOffset,s=t.getBounds(),o=this.getOriginalLayerPx(),n=this._calRadiusOfAnchor(),a=new olleh.maps.Point(o.x+i.x+n.right,o.y+i.y+n.bottom),r=t.getCoordFromLayerPx(new olleh.maps.Point(a.x+e.width,a.y+e.height));return s.contains(r)?a.subtract(o):(a=new olleh.maps.Point(o.x-e.width-i.x-n.left,o.y+i.y+n.bottom),r=t.getCoordFromLayerPx(new olleh.maps.Point(a.x,a.y+e.height)),s.contains(r)?a.subtract(o):(a=new olleh.maps.Point(o.x+i.x+n.right,o.y-e.height-i.y-n.top),r=t.getCoordFromLayerPx(new olleh.maps.Point(a.x+e.width,a.y)),s.contains(r)?a.subtract(o):(a=new olleh.maps.Point(o.x-e.width-i.x-n.left,o.y-e.height-i.y-n.top),r=t.getCoordFromLayerPx(new olleh.maps.Point(a.x,a.y)),a.subtract(o))))},_updateMargin:function(){this._marginPx={body:this._calTooltipPosition()}},_calRadiusOfAnchor:function(){var t={top:0,bottom:0,left:0,right:0};if(olleh.maps.overlay.Marker&&this._anchor instanceof olleh.maps.overlay.Marker){var e=this._anchor.getIcon(),i=e.size,s=e.anchor;t.left=s.x,t.right=i.width-s.x,t.top=s.y,t.bottom=i.height-s.y}return t},_setPosition:function(t){olleh.maps.overlay.Tooltip.$super.setPosition.apply(this,arguments)},setPosition:function(t){this._optsPosition&&(this._optsPosition=t),this._isOpenOptions?this._openOptions.position=t:olleh.maps.overlay.Tooltip.$super.setPosition.apply(this,arguments)},setPixelOffset:function(t){this._isOpenOptions?this._openOptions.pixelOffset=t:olleh.maps.overlay.Tooltip.$super.setPixelOffset.apply(this,arguments)},setContent:function(t){this._isOpenOptions?this._openOptions.content=t:olleh.maps.overlay.Tooltip.$super.setContent.apply(this,arguments)},setZIndex:function(t){this._isOpenOptions?this._openOptions.zIndex=t:olleh.maps.overlay.Tooltip.$super.setZIndex.apply(this,arguments)},_setMaxWidth:function(t){this._isOpenOptions?this._openOptions.maxWidth=t:olleh.maps.overlay.Tooltip.$super._setMaxWidth.apply(this,arguments)},open:function(t,e,i){if(i){if(!this._isOpenOptions){var s=this._opts,o={};s.position&&(o.position=this._optsPosition?this._optsPosition:s.position),s.pixelOffset?o.pixelOffset=s.pixelOffset:o.pixelOffset=new olleh.maps.Point(0,0),s.content&&(o.content=s.content),s.zIndex?o.zIndex=s.zIndex:o.zIndex="auto",s.maxWidth?o.maxWidth=s.maxWidth:o.maxWidth=this.contentSize.maxWidth,this._openOptions=o}this.setOptions(i),this._isOpenOptions=!0}else this._isOpenOptions&&(this._isOpenOptions=!1,this.setOptions(this._openOptions));if(e){this._anchor||(this._optsPosition=this._opts.position);var n=null;if(e instanceof olleh.maps.Coord)n=e;else if(e instanceof olleh.maps.Point)n=t.layerMgr.getCoordFromViewportPx(e);else if(olleh.maps.overlay.Marker&&e instanceof olleh.maps.overlay.Marker)n=e.getPosition();else{if(!(e instanceof olleh.maps.overlay.Overlay))throw new TypeError("anchor parameter must have a position");if(e.getPosition())n=e.getPosition();else{if(!e.getBounds())throw new TypeError("anchor parameter must have a position");n=e.getBounds().getCenter()}}this._anchor=e,this._setPosition(n)}else if(this._anchor&&this.isAdded()){if(this._anchor=null,!this._optsPosition)throw new Error("Option's Position value is not exist");this._setPosition(this._optsPosition),this._optsPosition=null}else this.isAdded()&&this.setPosition(this._opts.position);this.isAdded()||this.setMap(t)},close:function(){this._isOpenOptions&&this.setOptions(this._openOptions),this._anchor=null,this._isOpenOptions=null,this._optsPosition=null,this._openOptions=null,this.setMap(null),this.isAdded()&&this.fireEvent("close")}}),$class("olleh.maps.overlay.ProjectedOverlay").extend(olleh.maps.overlay.BaseOverlay).define({ProjectedOverlay:function(t){this._opacity=1,this._fadeIn=!0,this._fadeOut=!0},setOptions:function(t){t.bounds&&this.setBounds(t.bounds),t.opacity&&this.setOpacity(t.opacity),t.fadeIn!==undefined&&this.setFadeIn(t.fadeIn),t.fadeOut!==undefined&&this.setFadeOut(t.fadeOut),olleh.maps.overlay.ProjectedOverlay.$super.setOptions.apply(this,arguments)},update:function(){this._updateBounds(),this._updateOpacity(),olleh.maps.overlay.ProjectedOverlay.$super.update.apply(this,arguments)},getIndexObject:function(){return this.getBounds()},getAutoZIndex:function(){return 0},getBounds:function(){return this._bounds},setBounds:function(t){var e=this._bounds;this._bounds=t,this.isDrawn()&&this._updateBounds(),this.fireEvent("bounds_changed",{from:e,to:t})},_updateBounds:function(){var t,e;if(!this._bounds)throw new Error("Bounds is not set.");this._currentLayerPx=this.getOriginalLayerPx(),this._currentScale=1,t=this.getOriginalSize(),e=olleh.maps.util.dom.getPositionStyles(this._currentLayerPx.x,this._currentLayerPx.y),e.transform&&(e.transform+=" "+olleh.maps.util.dom.getScaleString(1)),e.width=t.width+"px",e.height=t.height+"px",this.updatePositioningStyles(e)},getOpacity:function(){return this._opacity},setOpacity:function(t){this._opacity=t,this._drawn&&this._updateOpacity()},isFadeIn:function(){return this._fadeIn},setFadeIn:function(t){this._fadeIn=t},isFadeOut:function(){return this._fadeOut},setFadeOut:function(t){this._fadeOut=t},_updateOpacity:function(){this.forEachElement(function(t,e){olleh.maps.util.dom.setStyle(e,"opacity",this._opacity)})},zoomStart:function(t,e,i,s){var o,n,a,r,l=this.getOriginalLayerPx();olleh.maps.browser.style.transform?(o=this.getOriginalSize(),n=l.clone()._add(o.width/2,o.height/2),a=e.add(n.subtract(e).multiplyBy(t)),r=a.clone()._subtract(o.width/2,o.height/2).round()):r=e.add(l.subtract(e).multiplyBy(t)).round(),this.moveTo(r,t,i,s)},zoomEnd:function(){this.stopAnimators(),this._updateBounds()},moveTo:function(t,e,i,s,o){var n,a;e||(e=this._currentScale),n=olleh.maps.util.dom.getPositionStyles(t.x,t.y),n.transform?n.transform+=" "+olleh.maps.util.dom.getScaleString(e):(a=this.getOriginalSize(),n.width=Math.round(a.width*e)+"px",n.height=Math.round(a.height*e)+"px"),this.animateTo(n,i,s,o),this._currentLayerPx=t,this._currentScale=e},move:function(t,e,i,s,o){this.moveTo(this._currentLayerPx.add(t),this._currentScale,i,s,o)},getOriginalLayerPx:function(){var t=this.layer.layerMgr,e=t.getLayerPxFromCoord(this._bounds.leftBottom,!1),i=t.getLayerPxFromCoord(this._bounds.rightTop,!1);return new olleh.maps.Point(e.x,i.y)},getOriginalSize:function(){var t=this.layer.layerMgr,e=t.getLayerPxFromCoord(this._bounds.leftBottom,!1),i=t.getLayerPxFromCoord(this._bounds.rightTop,!1);return new olleh.maps.Size(i.x-e.x,e.y-i.y)},getCurrentLayerPx:function(){return this._currentLayerPx},getCurrentScale:function(){return this._currentScale},getFadeInAnimation:function(){return this._fadeIn?new olleh.maps.fx.Animation({from:{opacity:"0"},to:{opacity:this._opacity},duration:.5,timing:olleh.maps.fx.timing.easeOut}):null},getFadeOutAnimation:function(){return this._fadeOut?new olleh.maps.fx.Animation({from:{opacity:this._opacity},to:{opacity:"0"},duration:.5,timing:olleh.maps.fx.timing.easeOut}):null}}),$class("olleh.maps.overlay.GroundOverlay").extend(olleh.maps.overlay.ProjectedOverlay).define({setOptions:function(t){t.url&&this.setURL(t.url),t.title&&this.setTitle(t.title),olleh.maps.overlay.GroundOverlay.$super.setOptions.apply(this,arguments)},update:function(){this._updateURL(),olleh.maps.overlay.GroundOverlay.$super.update.apply(this,arguments)},getURL:function(){return this._url},setURL:function(t){this._url=t,this._drawn&&this._updateURL()},getTitle:function(){return this._title},setTitle:function(t){this._title!==t&&(this._title=t,this.isAdded()&&this.fireEvent("title_changed"))},$default_mouseover:function(t,e){if(this._title){var i=this.map.getTooltip();i&&(i.setContent(this._title),i.setPixelOffset(new olleh.maps.Point(20,0)),i.open(this.map,t.getCoord()),this._tooltip=i)}var s=olleh.maps.overlay.GroundOverlay.$super.$default_mouseover;s&&s.apply(this,arguments)},$default_mousemove:function(t,e){this._tooltip&&this._tooltip.setPosition(t.getCoord());var i=olleh.maps.overlay.GroundOverlay.$super.$default_mousemove;i&&i.apply(this,arguments)},$default_mouseout:function(t,e){this._tooltip&&(this._tooltip.setPixelOffset(new olleh.maps.Point(0,0)),this._tooltip.close(),this._tooltip=null);var i=olleh.maps.overlay.GroundOverlay.$super.$default_mouseout;i&&i.apply(this,arguments)},_updateURL:function(){var t=this._img;if(!this._url)throw new Error("URL is not set.");t||(t=this._img=new olleh.maps.SpritedImage,this.registerElement("lower_overlay_pane",t.elem),this.registerEventDom(t.elem)),t.setImage(this._url,olleh.maps.Point.zero(),olleh.maps.Size.full())}}),$class("olleh.maps.vector.Vector").extend(olleh.maps.overlay.Overlay).define({rendererName:null,editHandlerRegistry:{},Vector:function(t){if("olleh.maps.vector.Vector"===this.$classname)throw new TypeError("Cannot instantiate olleh.maps.vector.Vector directly.");this._drawn=!1,this._visible=!0,this._editable=!1,this._element=null,this._eventDom=null,this.layer=null,this._renderer=null,this._opts=this._getDefaultOptions()},isVisible:function(){return this._visible},setVisible:function(t){this._visible!==t&&(this._visible=t,this._drawn&&this._updateVisiblity(),this.isAdded()&&t&&this.draw(),this.fireEvent("visible_changed"))},bringToFront:function(){if(!this._isFront&&(this._isFront=!0,this._drawn)){var t=olleh.maps.browser.vector;if("VML"===t)this._updateZIndex();else if("SVG"===t){var e=this._element.elem;e.parentNode&&e.parentNode.appendChild(e)}}},_updateVisiblity:function(){olleh.maps.util.dom.setStyle(this._element.elem,"display",this._visible?"block":"none")},_updateZIndex:function(){var t=this._isFront?olleh.maps.overlay.BaseOverlay.MAX_ZINDEX:this._zIndex;olleh.maps.isNumber(t)&&olleh.maps.util.dom.setStyle(this._element.elem,"zIndex",t)},resetZIndex:function(){this._isFront&&(this._isFront=!1,this._drawn&&"VML"===olleh.maps.browser.vector&&this._updateZIndex())},onAdd:function(t){this.isVisible()&&this.draw()},createRenderer:function(){return this.layer.getRendererFactory()["create"+this.rendererName](this._opts)},draw:function(){if(this.isAdded()&&(this._renderer||(this._renderer=this.createRenderer()),this._renderer)){if(this._drawn=!0,this._doDraw(),!this._element){this._element=this._renderer.getRootElement();var t=this._element.elem;this.layer.getContainer().appendChild(t);var e=this._eventDom=this._renderer.getEventDom();this.registerEventDom(e)}this.registerEvent(),this._editable&&this._attachEditHandler()}},onRemove:function(){this.erase()},erase:function(){olleh.maps.vector.Vector.$super.erase.apply(this,arguments),this._element&&(this.unregisterEvent(),this.layer.getContainer().removeChild(this._element.elem),this._element=null,this._eventDom=null,this._drawn=!1,this._editable&&this._detachEditHandler())},isDrawn:function(){return this._drawn},_doDraw:function(){},attach:function(){var t=this.map.getLayer("Vector");if(!t)throw new Error("VectorLayer does not exists.");t.add(this)},detach:function(){this.layer&&this.layer.remove(this)},_getDefaultOptions:function(){return{}},setOptions:function(t){olleh.maps.mixin(this._opts,t,!0),this.isAdded()&&this._renderer&&(this._renderer.setOptions(this._opts),this.isVisible()&&this._doDraw()),t.editable!==undefined&&this.setEditable(t.editable),olleh.maps.vector.Vector.$super.setOptions.apply(this,arguments)},getCenter:function(){},getBounds:function(){},setEditable:function(t){this._editable!==t&&(this._editable=t,t?this._drawn&&this._attachEditHandler():this._detachEditHandler())},isEditable:function(){return this._editable},_attachEditHandler:function(){if(this._editHandler)this._editHandler.refresh();else{var t=olleh.maps.vector.Vector.prototype.editHandlerRegistry[this.$classname];if(t){var e=new t(this);e.activate(),this._editHandler=e}}},_detachEditHandler:function(){this._editHandler&&this._editHandler.deactivate(),this._editHandler=null}}),$class("olleh.maps.vector.Path").extend(olleh.maps.vector.Vector).define({_convertPathToPoints:function(t){for(var e=[],i=this.layer.layerMgr,s=0,o=t.getLength();s<o;s++){var n=t.getAt(s),a=i.getLayerPxFromCoord(n);e.push(a)}return e}}),$class("olleh.maps.vector.Polygon").extend(olleh.maps.vector.Path).define({rendererName:"PolygonRenderer",Polygon:function(t){},init:function(){olleh.maps.vector.Polygon.$super.init.call(this);for(var t=this.getPaths(),e=0;e<t.length;e++)t[e].onChange(this.draw,this)},setPaths:function(t){for(var e=this.getPaths(),i=0;i<e.length;i++)e[i].unsubscribeChange(this.draw,this);if(this.erase(),t=t||[],olleh.maps.isArray(t)||(t=[t]),this._opts.paths=t,t.length>0){for(var i=0;i<t.length;i++)t[i].onChange(this.draw,this);this.draw()}this.fireEvent("paths_changed")},_doDraw:function(){for(var t=this.getPaths(),e=[],i=0;i<t.length;i++){var s=this._convertPathToPoints(t[i]);e.push(s),this._renderer.draw(e)}},getPaths:function(){return olleh.maps.isArray(this._opts.paths)?this._opts.paths:this._opts.paths?[this._opts.paths]:[]},_getDefaultOptions:function(){return{fillColor:"transparent",fillOpacity:1,fillRule:"evenodd",strokeColor:"black",strokeOpacity:1,strokeWeight:5,visible:!0}},getCenter:function(){return this.getBounds().getCenter()},getBounds:function(){return this.getPaths()[0].getBounds()}}),$class("olleh.maps.vector.Polyline").extend(olleh.maps.vector.Path).define({rendererName:"PolylineRenderer",Polyline:function(t){},init:function(){olleh.maps.vector.Polyline.$super.init.call(this),this._opts.path&&this._opts.path.onChange(this.draw,this)},_doDraw:function(){if(this._opts.path){var t=this._convertPathToPoints(this._opts.path);this._renderer.draw(t)}},setPath:function(t){this._opts.path&&this._opts.path.unsubscribeChange(this.draw,this),this._opts.path=t,t?(t.onChange(this.draw,this),this.draw()):this.erase(),this.fireEvent("path_changed")},getPath:function(){return this._opts.path},_getDefaultOptions:function(){return{icons:[],strokeColor:"black",strokeOpacity:1,strokeWeight:5,visible:!0}},getCenter:function(){return this.getBounds().getCenter()},getBounds:function(){return this.getPath().getBounds()}}),$class("olleh.maps.vector.Rectangle").extend(olleh.maps.vector.Vector).define({rendererName:"RectangleRenderer",Rectangle:function(t){},_doDraw:function(){var t=this.layer.layerMgr,e=t.getResolution(),i=this._opts.bounds,s=t.getLayerPxFromCoord(i.getLeftTopCoord()),o=i.getWidth()/e,n=i.getHeight()/e;this._renderer.draw(s,o,n)},setBounds:function(t){this._opts.bounds=t,this.draw(),this.fireEvent("bounds_changed")},getBounds:function(){return this._opts.bounds},_getDefaultOptions:function(){return{fillColor:"transparent",fillOpacity:1,strokeColor:"black",strokeOpacity:1,strokePosition:"center",strokeWeight:5,visible:!0}},getCenter:function(){var t=this.getBounds();return t.getCenter().transform(t.getType())}}),$class("olleh.maps.vector.Circle").extend(olleh.maps.vector.Vector).define({rendererName:"CircleRenderer",Circle:function(t){},getCenter:function(){return this._opts.center},getRadius:function(){return this._opts.radius},_doDraw:function(){var t=this.layer.layerMgr.getLayerPxFromCoord(this._opts.center),e=this.layer.layerMgr.getResolution(),i=this._opts.radius/e;this._renderer.draw(t,i)},setCenterAndRadius:function(t,e){this._opts.center=t,this._opts.radius=e,this.draw(),this.fireEvent("center_changed"),this.fireEvent("radius_changed")},setCenter:function(t){this._opts.center=t,this.draw(),this.fireEvent("center_changed")},setRadius:function(t){this._opts.radius=t,this.draw(),this.fireEvent("radius_changed")},_getDefaultOptions:function(){return{fillColor:"transparent",fillOpacity:1,strokeColor:"black",strokeOpacity:1,strokePosition:"center",strokeWeight:5,visible:!0}},getBounds:function(){var t=this.getRadius(),e=this.getCenter(),i=e.asDefault(),s=i.clone();s.x-=t,s.y-=t;var o=i.clone();return o.x+=t,o.y+=t,new olleh.maps.Bounds(s,o).transform(e.getClass())}}),$class("olleh.maps.vector.BaseRenderer").define({getRootElement:function(){return null},getEventDom:function(){return null},setOptions:function(t){},isDrawn:function(){},prepareToDraw:function(){}}),$class("olleh.maps.vector.ContainerRenderer").define({ContainerRenderer:function(t){t&&(this.layer=t.layer)},createContainer:function(){},setBounds:function(){}}),$class("olleh.maps.vector.PathRenderer").define({PathRenderer:function(t){this.opts=t},moveTo:function(t,e){},lineTo:function(t){},circle:function(t,e,i){},path:function(t){},closePath:function(){},commit:function(){}}),$class("olleh.maps.vector.PolylineRenderer").define({PolylineRenderer:function(t){this.opts=t},draw:function(t){}}),$class("olleh.maps.vector.RectangleRenderer").define({RectangleRenderer:function(t){this.opts=t},draw:function(t,e,i){}}),$class("olleh.maps.vector.CircleRenderer").define({CircleRenderer:function(t){this.opts=t},draw:function(t,e){}}),$class("olleh.maps.vector.PolygonRenderer").define({PolygonRenderer:function(t){this.opts=t},draw:function(t){}}),olleh.maps.browser.hasSVG&&$class("olleh.maps.vector.svg.Renderer").extend(olleh.maps.vector.BaseRenderer).define({$static:{createElement:function(t){var e=document.createElementNS("http://www.w3.org/2000/svg",t);return olleh.maps.util.dom.setStyle(e,"userSelect","none"),e.setAttribute("fill","none"),olleh.maps.browser.browserName===olleh.maps.browser.BROWSER_NAME.ie&&olleh.maps.util.dom.setStyle(e,"pointer-events","visiblePainted"),e}},tag:"path",getEventDom:function(){return this.elem},prepareToDraw:function(){this.getRootElement(),this._drawn=!0,this.setOptions()},isDrawn:function(){return!!this._drawn},getRootElement:function(){if(!this.rootElem){var t=olleh.maps.vector.svg.Renderer.createElement(this.tag);this.rootElem=new olleh.maps.Element(t),this.elem=t}return this.rootElem},setOptions:function(t){if(this.opts=olleh.maps.mixin(this.opts,t,!0),this.isDrawn()){var t=this.opts,e=t.strokeWeight,i=this.elem;if(t.strokeColor?i.setAttribute("stroke",t.strokeColor):i.removeAttribute("stroke"),t.strokeOpacity?i.setAttribute("stroke-opacity",t.strokeOpacity):i.removeAttribute("stroke-opacity"),t.fillColor?i.setAttribute("fill",t.fillColor):i.setAttribute("fill","none"),t.fillOpacity?i.setAttribute("fill-opacity",t.fillOpacity):i.removeAttribute("fill-opacity"),i.setAttribute("stroke-linecap",t.strokeLinecap||"round"),i.setAttribute("stroke-linejoin",t.strokeLinejoin||"round"),t.fillRule?i.setAttribute("fill-rule",t.fillRule):i.removeAttribute("fill-rule"),t.strokeStyle){var s;s=olleh.maps.isArray(t.strokeStyle)?t.strokeStyle.join(" "):this._strokeDashArray(t.strokeStyle,e),i.setAttribute("stroke-dasharray",s)}else i.removeAttribute("stroke-dasharray");i.setAttribute("stroke-width",e||0)}},_strokeDashArray:function(t,e){return e||(e=1),t=t.toLowerCase(),"solid"==t?"0":"dot"==t?e+","+3*e:"dash"==t?4*e+","+3*e:"shortdot"==t?e+","+e:"shortdash"==t?3*e+","+e:"longdash"==t?8*e+","+3*e:"dashdot"==t?4*e+","+3*e+","+e+","+3*e:"shortdashdot"==t?3*e+","+e+","+e+","+e:"longdashdot"==t?8*e+","+3*e+","+e+","+3*e:"shortdashdotdot"==t?3*e+","+e+","+e+","+e+","+e+","+e:"longdashdotdot"==t?8*e+","+3*e+","+e+","+3*e+","+e+","+3*e:t}}),olleh.maps.vector.svg&&$class("olleh.maps.vector.svg.PathRenderer").extend(olleh.maps.vector.PathRenderer).mixin(olleh.maps.vector.svg.Renderer).define({moveTo:function(t,e){this._initCommand(),this._command+="M "+t+" "+e},lineTo:function(t,e){this._initCommand(),this._command+="L "+t+" "+e},circle:function(t,e,i){this._initCommand(),this._command+="M "+t+" "+e+" m -"+i+",0 a "+i+","+i+" 0 1,0 "+2*i+",0 a "+i+","+i+" 0 1,0 -"+2*i+",0"},path:function(t){this._initCommand();for(var e=0;e<t.length;e++){var i=t[e];0==e?this.moveTo(i.x,i.y):this.lineTo(i.x,i.y)}},closePath:function(){this._initCommand(),this._command+="Z"},_initCommand:function(){this._command?this._command+=" ":this._command=""},commit:function(){this.elem.setAttribute("d",this._command),this._command=null}}),olleh.maps.vector.svg&&$class("olleh.maps.vector.svg.ContainerRenderer").extend(olleh.maps.vector.ContainerRenderer).define({buffer:1,createContainer:function(){if(!this._svgElem){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");this._svgElem=t,t.style.position="absolute",olleh.maps.util.dom.setStyle(t,"userSelect","none"),olleh.maps.browser.browserName===olleh.maps.browser.BROWSER_NAME.ie&&olleh.maps.util.dom.setStyle(t,"pointer-events","none"),olleh.maps.util.dom.addClass(t,"ollehmap-noevent")}return this._svgElem},setBounds:function(){var t,e=this.createContainer(),i=this.layer.layerMgr,s=i.getViewportSize(),o=i.getLayerOffset().multiplyBy(-1);if(!(this._bounds&&(t=this._bounds,t.left<=o.x&&o.x<=t.right&&t.top<=o.y&&o.y<=t.bottom))){t={left:o.x-s.width*this.buffer,right:o.x+s.width*this.buffer,top:o.y-s.height*this.buffer,bottom:o.y+s.height*this.buffer},this._bounds=t,e.setAttribute("viewBox",t.left+" "+t.top+" "+s.width*(1+2*this.buffer)+" "+s.height*(1+2*this.buffer));var n=olleh.maps.browser.osName!==olleh.maps.browser.OS_NAME.ios,a=olleh.maps.util.dom.getPositionStyles(t.left,t.top,n);a.width=s.width*(1+2*this.buffer)+"px",a.height=s.height*(1+2*this.buffer)+"px",olleh.maps.util.dom.setStyles(e,a)}}}),olleh.maps.vector.svg&&$class("olleh.maps.vector.svg.PolylineRenderer").extend(olleh.maps.vector.PolylineRenderer).mixin(olleh.maps.vector.svg.Renderer).define({tag:"polyline",draw:function(t){if(t&&t.length){this.prepareToDraw();var e,i,s,o=t.length,n=this.elem,a=[],r=0,l=0;for(e=0;e<o;e++)i=t[e].x,s=t[e].y,i==r&&s==l||a.push(i+","+s),r=i,l=s;1==a.length&&a.push(i+","+s),n.setAttribute("points",a.join(" "))}}}),olleh.maps.vector.svg&&$class("olleh.maps.vector.svg.PolygonRenderer").extend(olleh.maps.vector.PolygonRenderer).mixin(olleh.maps.vector.svg.PathRenderer).define({draw:function(t){if(!olleh.maps.isArray(t))throw TypeError("Type of pointsArray must be array.");this.prepareToDraw(),t[0]instanceof olleh.maps.Point&&(t=[t]);for(var e=0;e<t.length;e++){var i=t[e];this.path(i),this.closePath()}this.commit()}}),olleh.maps.vector.svg&&$class("olleh.maps.vector.svg.CircleRenderer").extend(olleh.maps.vector.CircleRenderer).mixin(olleh.maps.vector.svg.Renderer).define({tag:"circle",draw:function(t,e){if(t instanceof olleh.maps.Point&&olleh.maps.isNumber(e)){this.prepareToDraw();var i=this.elem;i.setAttribute("cx",t.x),i.setAttribute("cy",t.y),i.setAttribute("r",e)}}}),olleh.maps.vector.svg&&$class("olleh.maps.vector.svg.RectangleRenderer").extend(olleh.maps.vector.RectangleRenderer).mixin(olleh.maps.vector.svg.Renderer).define({tag:"rect",draw:function(t,e,i){if(t instanceof olleh.maps.Point&&olleh.maps.isNumber(e)&&olleh.maps.isNumber(i)){this.prepareToDraw();var s=this.rootElem.elem;s.setAttribute("x",t.x),s.setAttribute("y",t.y),olleh.maps.isNumber(e)&&s.setAttribute("width",e),olleh.maps.isNumber(i)&&s.setAttribute("height",i)}}}),olleh.maps.browser.hasVML&&(document.namespaces.add("ollehmap-vml","urn:schemas-microsoft-com:vml"),$class("olleh.maps.vector.vml.Renderer").extend(olleh.maps.vector.BaseRenderer).define({$static:{createElement:function(t){var e=document.createElement("<ollehmap-vml:"+t+">");return e.className="ollehmap-vml",e.unselectable="on",e}},tag:"shape",getEventDom:function(){return this.rootElem.elem},prepareToDraw:function(){this.getRootElement(),this._drawn=!0,
this.setOptions()},isDrawn:function(){return!!this._drawn},getRootElement:function(){if(!this.rootElem){var t=olleh.maps.vector.vml.Renderer.createElement(this.tag);this.rootElem=new olleh.maps.Element(t),this._containerElem=this.rootElem.elem}return this.rootElem},setOptions:function(t){if(this.opts=olleh.maps.mixin(this.opts,t,!0),this.isDrawn()){var t=this.opts,e=this._containerElem,i=olleh.maps.vector.vml.Renderer;e.stroked=!(!t.strokeWeight&&!olleh.maps.isUndefined(t.strokeWeight)),"butt"===t.strokeLinecap&&(t.strokeLinecap="flat"),e.stroked?(!this._stroke&&(this._stroke=i.createElement("stroke")),this._stroke.color=t.strokeColor,this._stroke.weight=t.strokeWeight,this._stroke.opacity=t.strokeOpacity||1,this._stroke.endcap=t.strokeLinecap||"round",this._stroke.joinstyle=t.strokeLinejoin||"round",t.strokeStyle?this._stroke.dashStyle=olleh.maps.isArray(t.strokeStyle)?t.strokeStyle.join(" "):(t.strokeStyle+"").replace(/ *, */g," "):this._stroke.dashStyle="",e.appendChild(this._stroke)):this._stroke&&(e.removeChild(this._stroke),delete this._stroke),e.filled=!("none"===t.fillColor||"transparent"===t.fillColor||olleh.maps.isUndefined(t.fillColor)),e.filled?(!this._fill&&(this._fill=i.createElement("fill")),this._fill.color=t.fillColor,this._fill.opacity=t.fillOpacity||1,e.appendChild(this._fill)):this._fill&&(e.removeChild(this._fill),delete this._fill)}},_updatePosition:function(t){t&&this.isDrawn()&&(this.rootElem.setStyle("left",t.x+"px"),this.rootElem.setStyle("top",t.y+"px"))},_updateSize:function(t,e){if(this._width=t,this._height=e,this.isDrawn()){var i=this.rootElem;i.setStyle("width",t+"px"),i.setStyle("height",e+"px"),"shape"==this.tag&&(i.elem.coordsize=t+" "+e)}}})),olleh.maps.vector.vml&&$class("olleh.maps.vector.vml.PathRenderer").extend(olleh.maps.vector.PathRenderer).mixin(olleh.maps.vector.vml.Renderer).define({PathRenderer:function(){this._translateX=0,this._translateY=0},prepareToDraw:function(){this._command=[],olleh.maps.vector.vml.Renderer.prototype.prepareToDraw.call(this)},moveTo:function(t,e){this._command.push(["M",t,e]),this._bounds?this._union(t,e):this._bounds={left:t,top:e,right:t,bottom:e}},lineTo:function(t,e){this._command.push(["L",t,e]),this._bounds?this._union(t,e):this._bounds={left:t,top:e,right:t,bottom:e}},circle:function(t,e,i){var s=t-i,o=e-i,n=t+i,a=e+i;this._command.push(["AT",t,e,i]),this._bounds?(this._union(s,o),this._union(n,a)):this._bounds={left:s,top:o,right:n,bottom:a}},path:function(t){for(var e=0;e<t.length;e++){var i=t[e];0==e?this.moveTo(i.x,i.y):this.lineTo(i.x,i.y)}},closePath:function(){this._command.push(["X"])},commit:function(){for(var t=this._bounds,e="",i=0;i<this._command.length;i++){var s=this._command[i];e.length>0&&(e+=" "),e+=this._toCommandStr(s,-t.left,-t.top)}this.rootElem.elem.path=e,this._updatePosition({x:t.left,y:t.top}),this._updateSize(t.right-t.left,t.bottom-t.top)},_toCommandStr:function(t,e,i){if("M"==t[0]||"L"==t[0])return t[0]+" "+(t[1]+e)+" "+(t[2]+i);if("AT"==t[0]){var s=t[1]+e,o=t[2]+i,n=t[3],a=s-n,r=o-n,l=s+n,h=o+n,m=s,p=o-n;return"AT "+a+" "+r+" "+l+" "+h+" "+m+" "+p+" "+m+" "+p+" X E"}return t.join(" ")},_union:function(t,e){var i=this._bounds;i.left=Math.min(i.left,t),i.top=Math.min(i.top,e),i.right=Math.max(i.right,t),i.bottom=Math.max(i.bottom,e)}}),olleh.maps.vector.vml&&$class("olleh.maps.vector.vml.PolylineRenderer").extend(olleh.maps.vector.PolylineRenderer).mixin(olleh.maps.vector.vml.Renderer).define({tag:"polyline",_getPoints:function(t){if(!t||!t.length)return null;var e,i,s,o,n,a,r,l,h=x2=t[0].x,m=y2=t[0].y,p=t.length,d=[];for(o=0;o<p;o++)s=t[o],e=s.x,i=s.y,h=Math.min(h,e),m=Math.min(m,i),x2=Math.max(x2,e),y2=Math.max(y2,i);for(o=0;o<p;o++)s=t[o],r=s.x,l=s.y,r==n&&l==a||d.push(r-h+","+(l-m)),n=r,a=l;return{points:d,leftTop:new olleh.maps.Point(h,m),rightBottom:new olleh.maps.Point(x2,y2)}},draw:function(t){if(t&&t.length){this.prepareToDraw();var e=this._getPoints(t);if(e){var i=this.getRootElement().elem,s=e.rightBottom.subtract(e.leftTop),o=e.points.join(" ");i.points?i.points.value=o:i.points=o,this._updatePosition(e.leftTop),this._updateSize(s.x,s.y)}}}}),olleh.maps.vector.vml&&$class("olleh.maps.vector.vml.PolygonRenderer").extend(olleh.maps.vector.PolygonRenderer).mixin(olleh.maps.vector.vml.PathRenderer).define({draw:function(t){if(!olleh.maps.isArray(t))throw TypeError("Type of pointsArray must be array.");this.prepareToDraw(),t[0]instanceof olleh.maps.Point&&(t=[t]);for(var e=0;e<t.length;e++){var i=t[e];this.path(i),this.closePath()}this.commit()}}),olleh.maps.vector.vml&&$class("olleh.maps.vector.vml.CircleRenderer").extend(olleh.maps.vector.CircleRenderer).mixin(olleh.maps.vector.vml.Renderer).define({tag:"oval",draw:function(t,e){if(t instanceof olleh.maps.Point&&olleh.maps.isNumber(e)){this.prepareToDraw();var i=2*e;this._updatePosition(t.subtract(new olleh.maps.Point(e,e))),this._updateSize(i,i)}}}),olleh.maps.vector.vml&&$class("olleh.maps.vector.vml.RectangleRenderer").extend(olleh.maps.vector.RectangleRenderer).mixin(olleh.maps.vector.vml.Renderer).define({tag:"rect",draw:function(t,e,i){t instanceof olleh.maps.Point&&olleh.maps.isNumber(e)&&olleh.maps.isNumber(i)&&(this.prepareToDraw(),this._updatePosition(t),this._updateSize(e,i))}}),olleh.maps.browser.hasCanvas&&$class("olleh.maps.vector.canvas.Renderer").extend(olleh.maps.vector.BaseRenderer).define({weightFactor:Math.sqrt(2),getEventDom:function(){return this.getRootElement().elem},prepareToDraw:function(){this.getRootElement()},isDrawn:function(){return!!this.canvas},getRootElement:function(){if(!this.canvas){var t=document.createElement("canvas"),e=function(t,e){switch(t){case"left":case"top":e=parseFloat(e)-(this._padding||0)+"px"}olleh.maps.Element.prototype.setStyle.call(this,t,e)};this.canvas=olleh.maps.mixin(new olleh.maps.Element(t),{setStyle:e},!0),this.canvas.setStyle("position","absolute");var i=t.getContext("2d");i.lineCap="round",i.lineJoin="round",this.ctx=i}return this.canvas},setOptions:function(t){this.opts=olleh.maps.mixin(this.opts,t,!0)},_updateStyle:function(){var t=this.opts,e=this.ctx;e.save(),t.fillColor&&(e.fillStyle=t.fillColor,t.fillOpacity<1&&(e.globalAlpha=t.fillOpacity),e.fill()),t.strokeColor&&t.strokeWeight&&(e.strokeStyle=t.strokeColor,e.lineWidth=t.strokeWeight,e.lineCap=t.strokeLinecap||"round",e.lineJoin=t.strokeLinejoin||"round",t.strokeOpacity<1&&(e.globalAlpha=t.strokeOpacity),e.stroke()),e.restore()},_updateCanvas:function(t,e,i){if(this.canvas){var s=this.canvas.elem,o=this.opts.strokeWeight,n=o?this.weightFactor*o:0;this.canvas._padding=n;var a=2*n,r=e+a,l=i+a;olleh.maps.isNumber(e)&&s.setAttribute("width",r+"px"),olleh.maps.isNumber(i)&&s.setAttribute("height",l+"px"),this.canvas.setStyle("left",t.x+"px"),this.canvas.setStyle("top",t.y+"px")}}}),olleh.maps.vector.canvas&&$class("olleh.maps.vector.canvas.PolylineRenderer").extend(olleh.maps.vector.PolylineRenderer).mixin(olleh.maps.vector.canvas.Renderer).define({closePath:!1,draw:function(t){if(t&&t.length){this.prepareToDraw();for(var e=this.ctx,i=x2=t[0].x,s=y2=t[0].y,o=0,n=t.length;o<n;o++){var a=t[o];i=Math.min(a.x,i),s=Math.min(a.y,s),x2=Math.max(a.x,x2),y2=Math.max(a.y,y2)}this._updateCanvas(new olleh.maps.Point(i,s),x2-i,y2-s),e.translate(this.canvas._padding,this.canvas._padding),e.beginPath(),e.moveTo(t[0].x-i,t[0].y-s);for(var o=1,n=t.length;o<n;o++){var a=t[o];e.lineTo(a.x-i,a.y-s)}this.closePath&&e.closePath(),this._updateStyle()}}}),olleh.maps.vector.canvas&&$class("olleh.maps.vector.canvas.PolygonRenderer").extend(olleh.maps.vector.canvas.PolylineRenderer).define({closePath:!0}),olleh.maps.vector.canvas&&$class("olleh.maps.vector.canvas.CircleRenderer").extend(olleh.maps.vector.CircleRenderer).mixin(olleh.maps.vector.canvas.Renderer).define({weightFactor:.5,draw:function(t,e){this.prepareToDraw();var i=2*e,s=t.subtract(new olleh.maps.Point(e,e));this._updateCanvas(s,i,i);var o=this.ctx;o.translate(this.canvas._padding,this.canvas._padding),o.beginPath(),o.arc(e,e,e,0,2*Math.PI,!1),this._updateStyle()}}),olleh.maps.vector.canvas&&$class("olleh.maps.vector.canvas.RectangleRenderer").extend(olleh.maps.vector.RectangleRenderer).mixin(olleh.maps.vector.canvas.Renderer).define({weightFactor:.5,draw:function(t,e,i){this.prepareToDraw(),this._updateCanvas(t,e,i);var s=this.ctx;s.translate(this.canvas._padding,this.canvas._padding),s.beginPath(),s.rect(0,0,e,i),this._updateStyle()}}),function(t){t&&$class("olleh.maps.vector.RendererFactory").define({createPolylineRenderer:function(e){var i=t.PolylineRenderer;return i?new i(e):null},createPolygonRenderer:function(e){var i=t.PolygonRenderer;return i?new i(e):null},createRectangleRenderer:function(e){var i=t.RectangleRenderer;return i?new i(e):null},createCircleRenderer:function(e){var i=t.CircleRenderer;return i?new i(e):null},createContainerRenderer:function(e){if(!this._containerRenderer){var i=t.ContainerRenderer;this._containerRenderer=i?new i(e):null}return this._containerRenderer},createPathRenderer:function(e){var i=t.PathRenderer;return i?new i(e):null}})}(olleh.maps.vector[olleh.maps.browser.vector.toLowerCase()]),$class("olleh.maps.vector.VectorLayer").extend(olleh.maps.layer.Layer).define({name:"Vector",label:olleh.maps.msg("벡터"),autoActivate:!0,zIndex:999,VectorLayer:function(){this._vectors=[],this._rendererFactory=new olleh.maps.vector.RendererFactory,this._containerRenderer=this._rendererFactory.createContainerRenderer({layer:this}),this._zoomAnim=!1},start:function(){olleh.maps.browser.style.transform&&(this._zoomAnim=!0),olleh.maps.vector.VectorLayer.$super.start.call(this)},setVisible:function(t){if(this._isVisible!=t){this._isVisible=t,t&&this.draw();var e=this.getPane(),i=t?"visible":"hidden";e.style.visibility=i}},isVisible:function(){return this._isVisible},draw:function(){this._zoomAnim&&this._ensureStopAnimation(),this._containerRenderer&&this._containerRenderer.setBounds(),this.drawAll()},drawAll:function(){var t,e=this._vectors.length;for(t=0;t<e;t++)this._vectors[t].isVisible()&&this._vectors[t].draw()},zoomStart:function(t,e,i,s){if(0!==this._vectors.length){var o=this.getPane();if(this._zoomAnim){var n;this._isZooming?n=this._animator.ignore():(olleh.maps.util.dom.setStyle(o,"transformOrigin",e.x+"px "+e.y+"px"),n={transform:olleh.maps.util.dom.getScaleString(1)}),this._animator=new olleh.maps.fx.Animation({from:n,to:{transform:olleh.maps.util.dom.getScaleString(t)},defaultType:"=",duration:i,pulse:s,timing:olleh.maps.fx.timing.easeOut}).animate(o)}else o.style.visibility="hidden";this._isZooming=!0}},zoomEnd:function(){if(this._isZooming){if(this._zoomAnim)this._ensureStopAnimation();else{this.getPane().style.visibility="visible"}this._isZooming=!1}olleh.maps.browser.browserName===olleh.maps.browser.BROWSER_NAME.chrome&&this._eraseAll(),this.drawAll()},_eraseAll:function(){var t,e=this._vectors.length;for(t=0;t<e;t++)this._vectors[t].isVisible()&&this._vectors[t].erase()},_ensureStopAnimation:function(){var t=this.getPane();this._animator&&"started"===this._animator.status&&this._animator.cancel(),t&&olleh.maps.util.dom.setStyle(t,"transform","")},moveEnd:function(){this._containerRenderer&&this._containerRenderer.setBounds()},getVectors:function(){return this._vectors},getPane:function(){if(!this._pane){var t=document.createElement("div");t.style.position="absolute",this._pane=t}return this._pane},getContainer:function(){if(!this._container){var t=this.getPane();this._containerRenderer?(this._container=this._containerRenderer.createContainer(),t.appendChild(this._container)):this._container=t}return this._container},getRendererFactory:function(){return this._rendererFactory},add:function(t){this._vectors.push(t),t.layer=this,this.isStarted()&&t.onAdd(this)},remove:function(t){olleh.maps.util.removeFromArray(this._vectors,t),this.isStarted()&&t.onRemove(),t.layer=null}}),$class("olleh.maps.vector.EditHandler").define({EditHandler:function(t){this.target=t},activate:function(){},deactivate:function(){},getTarget:function(){return this.target},refresh:function(){}}),$class("olleh.maps.plugin.VectorPlugin").extend(olleh.maps.Adaptable).define({attach:function(){this.vector=new olleh.maps.vector.VectorLayer({map:this.map})},detach:function(){}}),olleh.maps.$skeleton.push(olleh.maps.plugin.VectorPlugin);var Quickhull={getDistant:function(t,e){return(e[0].y-e[1].y)*(t.x-e[0].x)+(e[1].x-e[0].x)*(t.y-e[0].y)},findMostDistantPointFromBaseLine:function(t,e){var i,s,o=0,n=null,a=[];for(i=0,s=e.length;i<s;i++){var r=e[i],l=this.getDistant(r,t);l>0&&(a.push(r),l>o&&(o=l,n=r))}return{maxPoint:n,newPoints:a}},buildConvexHull:function(t,e){var i=[],s=this.findMostDistantPointFromBaseLine(t,e);return s.maxPoint?(i=i.concat(this.buildConvexHull([t[0],s.maxPoint],s.newPoints)),i=i.concat(this.buildConvexHull([s.maxPoint,t[1]],s.newPoints))):[t]},getConvexHull:function(t){var e,i,s,o,n=Number.MIN_VALUE,a=Number.MAX_VALUE;for(e=0,i=t.length;e<i;e++){var r=t[e];r.x>n&&(s=r,n=r.x),r.x<a&&(o=r,a=r.x)}return[].concat(this.buildConvexHull([o,s],t),this.buildConvexHull([s,o],t))}};$class("olleh.maps.overlay.MarkerCluster").extend(olleh.maps.overlay.PointedOverlay).define({$static:{DEFAULT_FONT_SIZE:10,DEFAULT_FONT_COLOR:"#000",DEFAULT_AREA_STYLE:{strokeColor:"#69F",strokeWeight:5,strokeOpacity:.8,fillColor:"#69F",fillOpacity:.4},DEFAULT_ICON_FN:function(t){return{url:olleh.maps.env.RESOURCE_URL+"img/clusters.png",size:new olleh.maps.Size(50,50),anchor:new olleh.maps.Point(25,25),origin:new olleh.maps.Point(51*(4-Math.min(Math.floor(t/20),4)),0)}}},MARKER_ANIMATE_DURATION:.2,MarkerCluster:function(t){var e=olleh.maps.overlay.MarkerCluster;this._clickToExpand=!0,this._clickToZoom=!1,this._displaySize=!0,this._fontSize=e.DEFAULT_FONT_SIZE,this._fontColor=e.DEFAULT_FONT_COLOR,this._displayArea=!0,this._areaStyle=e.DEFAULT_AREA_STYLE,this._iconFn=e.DEFAULT_ICON_FN,this._areaPath=null,this._originMap=null,this._area=null,this._children=[],this._size=-1},isExpanded:function(){var t,e,i=this._children;for(t=0,e=i.length;t<e;t++)if(i[t].isAdded())return!0;return!1},setOptions:function(t){t.resetPosition!==undefined&&this.setResetPosition(t.resetPosition),t.clickToZoom!==undefined&&this.setClickToZoom(t.clickToZoom),t.clickToExpand!==undefined&&this.setClickToExpand(t.clickToExpand),t.displaySize!==undefined&&this.setDisplaySize(t.displaySize),t.fontSize&&this.setFontSize(t.fontSize),t.fontColor&&this.setFontColor(t.fontColor),t.displayArea!==undefined&&this.setDisplayArea(t.displayArea),t.areaStyle&&this.setAreaStyle(t.areaStyle),t.iconFn&&this.setIconFn(t.iconFn),olleh.maps.overlay.MarkerCluster.$super.setOptions.apply(this,arguments)},update:function(){this._updateIcon(),this._updateSize(),olleh.maps.overlay.MarkerCluster.$super.update.apply(this,arguments)},isVisibleAtZoom:function(t){return this.minZoom<=t&&t<=this.maxZoom},isResetPosition:function(){return this._resetPosition},setResetPosition:function(t){this._resetPosition=t},isClickToZoom:function(){return this._clickToZoom},setClickToZoom:function(t){this._clickToZoom=t},isClickToExpand:function(){return this._clickToExpand},setClickToExpand:function(t){this._clickToExpand=t},isDisplaySize:function(){return this._displaySize},setDisplaySize:function(t){this._displaySize=t,this.isDrawn()&&this._updateSize()},_updateSize:function(){this._sizeDiv.setProperty("innerHTML",this._displaySize?this.getSize():"")},getFontSize:function(){return this._fontSize},setFontSize:function(t){this._fontSize=t,this.isDrawn()&&this._updateIcon()},getFontColor:function(){return this._fontColor},setFontColor:function(t){this._fontColor=t,this.isDrawn()&&this._updateIcon()},isDisplayArea:function(){return this._displayArea},setDisplayArea:function(t){this._displayArea=t,this.isDrawn()&&!t&&this.hideArea()},getAreaStyle:function(){return this._areaStyle},setAreaStyle:function(t){this._areaStyle=t},getIconFn:function(){return this._iconFn},setIconFn:function(t){this._iconFn=t},_updateIcon:function(){var t=this._iconFn(this.getSize()),e=this._fontSize,i=this._fontColor,s=this._img;this._img||(s=this._img=new olleh.maps.SpritedImage,this._sizeDiv=olleh.maps.Element.create("div").setStyles({position:"absolute",width:"100%",textAlign:"center",fontWeight:"bold",zIndex:1}),this._sizeDiv.setStyle("userSelect","none"),s.appendChild(this._sizeDiv),this.registerElement("upper_overlay_pane",s.elem),this.registerEventDom(s.elem)),s.setStyles({width:t.size.width+"px",height:t.size.height+"px",marginLeft:-t.anchor.x+"px",marginTop:-t.anchor.y+"px"}).setImage(t.url,t.origin,t.scaledSize),this._sizeDiv.setStyles({paddingTop:t.size.height/2-e/2+"px",fontSize:e+"px",color:i})},getSize:function(){var t,e,i,s,o=this._size;if(-1==o){for(o=0,s=this._children,t=0,e=s.length;t<e;t++)i=s[t],o+=i.getSize?i.getSize():1;this._size=o}return o},_invalidate:function(t){var e=this.parent,i=this._area&&this._area.isAdded();i&&this.hideArea(),this._size=-1,this._bounds=null,this._area=null,e&&-1!=e._size&&e._invalidate(),this.isDrawn()&&(this._updateIcon(),this._updateSize(),i&&this.showArea())},getBounds:function(){var t,e,i,s=this._bounds,o=Infinity,n=Infinity,a=-Infinity,r=-Infinity;if(!s){if(!this._children.length)return null;for(t=this.getAllMarkers(),e=0;e<t.length;e++)i=t[e].getPosition().asDefault(),o>i.x&&(o=i.x),n>i.y&&(n=i.y),a<i.x&&(a=i.x),r<i.y&&(r=i.y);s=this._bounds=new olleh.maps.Bounds(new olleh.maps.UTMK(o,n),new olleh.maps.UTMK(a,r))}return s},getChildren:function(){return this._children},getMarkers:function(){return this._children},getAllMarkers:function(){var t,e,i=this._children,s=[];for(t=0,e=i.length;t<e;t++)child=i[t],child.getAllMarkers?s=s.concat(child.getAllMarkers()):s.push(child);return s},getCenter:function(){var t,e,i=0,s=0,o=this._children,n=o.length;for(t=0;t<n;t++)e=o[t].getPosition().asDefault(),i+=e.x,s+=e.y;return new olleh.maps.UTMK(i/n,s/n)},add:function(t){t.parent!=this&&(t.parent&&t.parent.remove(t),t.parent=this,this._children.push(t),(this._resetPosition||this._children.length<=2)&&this.setPosition(this.getCenter()),this._invalidate())},remove:function(t){t.parent==this&&(t.parent=null,t.setMap(null),olleh.maps.util.removeFromArray(this._children,t),this._resetPosition&&this._children.length&&this.setPosition(this.getCenter()),this._invalidate())},expand:function(){this.maxZoom!==undefined?this.getMap().panTo(this.getPosition(),this.maxZoom+1):this.expandToDepth()},expandToDepth:function(t,e){var i,s,o,n,a,r,l=this.MARKER_ANIMATE_DURATION;for(this.isMoving()&&this.stopAnimators(),t||(t=1),e||(e=this),n=e.getMap(),a=e.getOriginalLayerPx(),t--,o=this._children,i=0,s=o.length;i<s;i++)r=o[i],r.isAdded()||(r.expandToDepth&&t>0?r.expandToDepth(t,e):r.isAdded()||(r.onAdd=this._markerOnAdd.bind(r,a,l),r.setMap(n)));this.isAdded()&&(this.hideArea(),this.isDrawn()&&(this.onRemove=this._clusterOnRemove),this.setMap(null)),!this._clickToExpand||this._clickToZoom||this.parent||(this._originMap=n,n.onEvent("click",this._onMapClick,this))},expandToZoom:function(t,e,i){var s,o,n,a,r,l,h,m=this.MARKER_ANIMATE_DURATION;if(this.isMoving()&&this.stopAnimators(),i||(i=this),a=i.getMap(),r=i.getOriginalLayerPx(),this==i&&this.maxZoom>=t)return[this];for(n=this._children,h=[],s=0,o=n.length;s<o;s++)l=n[s],e&&!e.intersects(l.getBounds()||l.getPosition())||(l.expandToZoom&&l.maxZoom<t?h=h.concat(l.expandToZoom(t,e,i)):(l.isAdded()||(l.onAdd=this._markerOnAdd.bind(l,r,m),l.setMap(a)),h.push(l)));return this.isAdded()&&(this.hideArea(),this.isDrawn()&&(this.onRemove=this._clusterOnRemove),this.setMap(null)),h},collapse:function(t,e){var i,s,o,n,a=this._children,r=this.MARKER_ANIMATE_DURATION;for(this.isMoving()&&this.stopAnimators(),e||(e=this),o=t.layerMgr.getLayerPxFromCoord(e.getPosition()),i=0,s=a.length;i<s;i++)n=a[i],n.isAdded()?(n.isDrawn()&&(n.onRemove=this._markerOnRemove.bind(n,o,r)),n.setMap(null)):n.collapse&&n.collapse(t,e);this==e&&(this.onAdd=this._clusterOnAdd,this.setMap(t)),this._originMap&&(t.unsubscribeEvent("click",this._onMapClick,this),this._originMap=null)},getArea:function(){var t=this._area;if(!t){var e,i,s=[],o=[],n=this.getAllMarkers();for(e=0,i=n.length;e<i;e++)s.push(n[e].getPosition().asDefault());var a=Quickhull.getConvexHull(s);for(e=0,i=a.length;e<i;e++)o.push(a[e][0]);t=new olleh.maps.vector.Polygon(this._areaStyle),t.setPaths(new olleh.maps.Path(o)),this._area=t}return t},showArea:function(){var t=this.getArea();t.isAdded()||t.setMap(this.map)},hideArea:function(){this._area&&this._area.setMap(null)},$default_click:function(){this.expand()},$default_mouseover:function(){this._displayArea&&this.showArea()},$default_mouseout:function(){this.hideArea()},_onMapClick:function(t){t.getSource()instanceof olleh.maps.layer.LayerManager&&this.collapse(this._originMap)},_clusterReady:function(){this.setVisible(!0),this.ready()},_clusterOnAdd:function(){this.setVisible(!1),olleh.maps.util.delay(this._clusterReady,1e3*this.MARKER_ANIMATE_DURATION,this),delete this.onAdd},_clusterOnRemove:function(){olleh.maps.util.defer(this.cleanup,this),delete this.onRemove},_markerOnRemove:function(t,e){this.moveTo(t,e,!1,this.cleanup),delete this.onRemove},_markerOnAdd:function(t,e){this.moveTo(t),this.moveTo(this.getOriginalLayerPx(),e,!1,this.ready),delete this.onAdd},attach:function(){this.hideArea(),olleh.maps.overlay.MarkerCluster.$super.attach.apply(this,arguments)},detach:function(){this.hideArea(),olleh.maps.overlay.MarkerCluster.$super.detach.apply(this,arguments)}}),$class("olleh.maps.overlay.MarkerClusterer").mixin(olleh.maps.Plugin).define({MarkerClusterer:function(t){t||(t={}),this.pluginInfo=olleh.maps.mixin({autoActivate:!0},t.pluginInfo,!0),this._clusterOpts=olleh.maps.util.clone(t.clusterOpts)||{},t.clusterOpts&&t.clusterOpts.clickToZoom!==undefined||(this._clusterOpts.clickToZoom=!0),this._clusterOpts.clickToExpand=!1,this._clusterOpts.resetPosition=!0,this._minZoom=t.minZoom||0,this._maxZoom=t.maxZoom||12,this._gap=t.gap||100,this._getDistance=t.getDistance||this.defaultGetDistance,this._getThreshold=t.getThreshold||this.defaultGetThreshold,this._afterCluster=t.afterCluster||null,this._displayed=[],this._zoom=-2,this._bound_onClusterPositionChanged=this._onClusterPositionChanged.bind(this),this.clear()},clear:function(){var t,e,i=this._displayed,s=olleh.maps.layer.LayerManager;for(t=0,e=i.length;t<e;t++)i[t].setMap(null);for(this._displayed=[],this._rootCluster=new olleh.maps.overlay.MarkerCluster,this._rootCluster.minZoom=-1,this._rootCluster.maxZoom=-1,t=0,e=this._index?this._index.length:0;t<e;t++)this._index[t]&&this._index[t].clear();for(this._index=[],t=this._minZoom,e=this._maxZoom+2;t<e;t++)this._index[t]=new olleh.maps.overlay.GridIndex(256*s.getResolutionForZoom(t))},defaultGetDistance:function(t,e,i){return t.getPosition().distanceTo(e.getPosition())},defaultGetThreshold:function(t){return this._gap*olleh.maps.layer.LayerManager.getResolutionForZoom(t)},remove:function(t){var e,i,s,o;t&&this._index[this._maxZoom+1].contains(t)&&(this._removeFromIndex(t,t.minZoom,t.maxZoom),e=t.parent,e.remove(t),o=e.getChildren(),e!=this._rootCluster&&1==o.length&&(i=e.parent,s=o[0],s.minZoom=e.minZoom,this._removeFromIndex(e,e.minZoom,e.maxZoom),this._addToIndex(s,e.minZoom,e.maxZoom),i.remove(e),i.add(s),e.unsubscribeEvent("position_changed",this._bound_onClusterPositionChanged),e=i))},add:function(t){var e,i,s,o=null,n=this._maxZoom;if(t&&!this._index[this._maxZoom+1].contains(t)){for(t.isAdded()&&t.setMap(null);n>=this._minZoom&&!(o=this._getClosest(t,n));)n--;o?o.add&&o.maxZoom==n?o.add(t):(i=o.minZoom,s=o.parent,this._removeFromIndex(o,o.minZoom,n),o.minZoom=n+1,e=new olleh.maps.overlay.MarkerCluster(this._clusterOpts),e.minZoom=i,e.maxZoom=n,e.add(o),e.add(t),this._afterCluster&&this._afterCluster(e),this._addToIndex(e,e.minZoom,e.maxZoom),e.onEvent("position_changed",this._bound_onClusterPositionChanged),s.add(e)):this._rootCluster.add(t),t.minZoom=n+1,t.maxZoom=this._maxZoom+1,this._addToIndex(t,t.minZoom,t.maxZoom)}},_getClosest:function(t,e){var i,s,o,n,a=t.getPosition(),r=2*this.defaultGetThreshold(e),l=new olleh.maps.Bounds(a,a).expand(r,r),h=this._index[e].getOverlays(l),m=this._getThreshold(e),p=Infinity,d=null;for(i=0,s=h.length;i<s;i++)n=h[i],(o=this._getDistance(t,n,e))<p&&o<m&&(p=o,d=n);return d},_addToIndex:function(t,e,i){var s,o=this._zoom;for(s=e;s<=i;s++)this.map&&s==o&&!t.isAdded()&&(t.setMap(this.map),this._displayed.push(t)),this._index[s].add(t,t.getPosition())},_removeFromIndex:function(t,e,i){var s,o=this._zoom;for(s=e;s<=i;s++)this.map&&s==o&&t.isAdded()&&(t.setMap(null),this._displayed.splice(olleh.maps.util.indexOf(this._displayed,t),1)),this._index[s].remove(t,t.getPosition())},_getAdjustedZoom:function(){if(!this.map)return-2;var t=this.map.getZoom();return t<this._minZoom?t=this._minZoom:t>this._maxZoom+1&&(t=this._maxZoom+1),t},doActivate:function(){var t,e,i=this.map,s=this._getAdjustedZoom(),o=i.layerMgr.getOverlayLayer().getBounds();for(this._zoom=s,this._bounds=o,this._displayed=this._index[s].getOverlays(o),t=0,e=this._displayed.length;t<e;t++)this._displayed[t].setMap(i);i.onEvent("overlay_layer_bounds_changed",this._onboundschanged,this)},doDeactivate:function(){var t,e,i=this.map;for(this._zoom=-2,this._bounds=null,t=0,e=this._displayed.length;t<e;t++)this._displayed[t].setMap(null);this._displayed=[],i.unsubscribeEvent("overlay_layer_bounds_changed",this._onboundschanged,this)},_onClusterPositionChanged:function(t,e){var i,s=t.getSource();for(i=s.minZoom;i<=s.maxZoom;i++)this._index[i].remove(s,e.from),this._index[i].add(s,e.to)},_onboundschanged:function(t,e){var i=this._zoom,s=this._getAdjustedZoom();this._bounds=e.to,i==s?this._updateBounds():(this._zoom=s,this._updateZoom(i<s?this._expand:this._collapse))},_updateBounds:function(){for(var t,e=this.map,i=this._displayed,s=this._index[this._zoom].getOverlays(this._bounds),o=0;o<s.length;o++)t=s[o],t.isAdded()?i[olleh.maps.util.indexOf(i,t)]=null:t.setMap(e);for(var o=0;o<i.length;o++)(t=i[o])&&t.setMap(null);this._displayed=s},_updateZoom:function(t){this._displayed=this._recursevely(this._rootCluster,t),this._hideNonDisplayedMarkers(this._rootCluster)},_hideNonDisplayedMarkers:function(t){if(t.isDrawn()&&-1===olleh.maps.util.indexOf(this._displayed,t)&&t.setMap(null),t.getChildren)for(var e=t.getChildren(),i=0,s=e.length;i<s;i++)this._hideNonDisplayedMarkers(e[i])},_recursevely:function(t,e){var i,s,o=this.map,n=this._zoom,a=this._bounds,r=[],l=t.getChildren();for(i=0;i<l.length;i++)s=l[i],a.intersects(s.getBounds()||s.getPosition())&&(s.getChildren?r=r.concat(e.call(this,s,n,a)):(s.isAdded()||s.setMap(o),r.push(s)));return r},_expand:function(t,e,i){return t.isAdded()?t.expandToZoom(e,i):t.isVisibleAtZoom(e)?(t.setMap(this.map),t):this._recursevely(t,this._expand)},_collapse:function(t,e,i){return t.isVisibleAtZoom(e)?(t.collapse(this.map),t):-1==t.maxZoom||t.maxZoom<e?this._recursevely(t,this._collapse):[]}}),$class("olleh.maps.event.Drag").mixin(olleh.maps.event.Recognizer).define({Drag:function(){this._mousedown=!1,this._startEvent=null,this._isDragStart=!1,this._isDragging=!1,this._xy=null,this.setEnabled(!0)},mousedown:function(t){return this._isDragStart&&this._isDragging?this.mouseup(t):olleh.maps.event.EventManager.isRightClick(t.originEvent)?void this._reset():(this._mousedown=!0,this._startEvent=t,this._isDragStart=!1,this._isDragging=!1,void(this._xy=t.pageXY))},mousemove:function(t){if(this._mousedown){var e=t.originEvent,i=this._startEvent,s=this._xy;this._xy=t.pageXY;var o=this._xy.subtract(s);return 0===o.x&&0===o.y?void t.stopPropagation():this._isDragStart?(this._isDragging=!0,{name:"drag",src:i.getSource(),opts:{originEvent:e,pageXY:t.pageXY,targetDOM:i.targetDOM},payload:{movementXY:o}}):i.getSource()!==t.getSource()?this._reset():(this._isDragStart=!0,{name:"dragstart",opts:{originEvent:e,targetDOM:i.targetDOM,pageXY:t.pageXY}})}},mouseup:function(t){if(!this._mousedown||!this._isDragStart)return this._reset();var e=t.originEvent,i=this._startEvent,s=this._xy,o=t.pageXY.subtract(s);return olleh.maps.event.EventManager.preventDefault(e),this._reset(),this._isDragging=!0,{name:"dragend",src:i.getSource(),opts:{originEvent:e,pageXY:t.pageXY,targetDOM:i.targetDOM},payload:{movementXY:o}}},click:function(t){if(this._isDragging){var e=t.originEvent;t.stopPropagation(),olleh.maps.event.EventManager.preventDefault(e)}this._reset()},touchstart:function(t){var e=t.touches;return e&&1===e.length?this.mousedown(t):this._reset()},touchmove:function(t){var e,i=t.touches;return i&&1===i.length?((e=this.mousemove(t))&&olleh.maps.event.EventManager.preventDefault(t.originEvent),e):this._reset()},touchend:function(t){return this.mouseup(t)},_reset:function(){this._mousedown=!1,this._startEvent=null,this._isDragStart=!1,this._isDragging=!1,this._xy=null}}),$class("olleh.maps.handler.Drag").define({$static:{attach:function(t){t.mergeDefaultOptions({dragInertia:!0,dragInertiaThreshold:olleh.maps.browser.isMobile?45:65,dragInertiaDeceleration:olleh.maps.browser.isMobile?4e3:4500})}},_zeroPoint:new olleh.maps.Point(0,0),$default_dragstart:function(t,e){t.getPoint()&&(olleh.maps.util.dom.addClass(this._root_pane,"ollehmap-drag"),this._map.getOption("disableDraggingCursor")||this._map.setCursor("dragging"),this._opts.dragInertia&&(this._times=[],this._points=[]))},$default_drag:function(t,e){var i=t.getPoint();if(i){var s=e.movementXY,o=this.calcNewCenter(-s.x,-s.y);if(this.moveTo(o,null,"off"),this._opts.dragInertia){var n=t.timeStamp;this._times.push(n),this._points.push(i)}}},$default_dragend:function(t,e){var i=this._opts,s=t.timeStamp,o=this._times.length-1,n=Math.max(0,Math.min(o,3)),a=this._times[o-n]||s,r=s-a;if(i.dragInertia&&r/(n+1)<i.dragInertiaThreshold){var l=0===r?e.movementXY:t.getPoint().subtract(this._points[o-n]),h=this._momentum(r,l),m=this.calcNewCenter(h.x,h.y);this.moveTo(m,null,"on",h.duration)}olleh.maps.util.dom.removeClass(this._root_pane,"ollehmap-drag"),this._map.getOption("disableDraggingCursor")||this._map.resetCursor()},_momentum:function(t,e){var i=this._opts,s=i.panAnimEaseLinearity2||.25,o=i.dragInertiaDeceleration,n=t/1e3||.1,a=e.multiplyBy(s/n),r=a.distanceTo(this._zeroPoint);r=Math.min(r,2500);var l=r/(o*s),h=a.multiplyBy(-l/2)._round();return{x:h.x,y:h.y,duration:l}}}),$class("olleh.maps.handler.Zoom").define({_calcZoomCenter:function(t,e){var i=this.getViewportCenter(),s=this._getScaleForZoom(t),o=e.subtract(i)._multiplyBy(1-1/s),n=i._add(o);return this.getCoordFromViewportPx(n,!1)},_checkZoomLevel:function(t){var e=this.getMinZoom(),i=this.getMaxZoom();return e<=t&&t<=i},$default_req_zoomin:function(t,e){var i=this.getPendingZoom()+1;if(t.stopPropagation(),this._checkZoomLevel(i)){var s=t.getPoint();if(!s)return this.zoomIn();var o=this._calcZoomCenter(i,s);this.panTo(o,i)}},$default_req_zoomout:function(t,e){var i=this.getPendingZoom()-1;if(t.stopPropagation(),this._checkZoomLevel(i)){var s=t.getPoint();if(!s)return this.zoomOut();var o=this._calcZoomCenter(i,s);this.panTo(o,i)}}}),$class("olleh.maps.handler.DoubleClickZoom").define({$default_dblclick:function(t){return!this._opts.disableDoubleClickZoom&&olleh.maps.handler.Zoom.prototype.$default_req_zoomin.apply(this,arguments)},$default_dblrightclick:function(t){return!this._opts.disableDoubleClickZoom&&olleh.maps.handler.Zoom.prototype.$default_req_zoomout.apply(this,arguments)}}),$class("olleh.maps.plugin.DefautlHandlers").extend(olleh.maps.Adaptable).define({$static:{HANDLERS:[olleh.maps.handler.Drag,olleh.maps.handler.Zoom]},attach:function(){var t=this.map,e=t.eventMgr,i=t.layerMgr,s=olleh.maps.plugin.DefautlHandlers.HANDLERS,o=s.length;for(e.addRecognizer(new olleh.maps.event.Drag),t.getOption("disableDoubleClickZoom")||olleh.maps.event.handler.attach(i,olleh.maps.handler.DoubleClickZoom);o--;)olleh.maps.event.handler.attach(i,s[o]);olleh.maps.handler.Drag.attach(t)},detach:function(){var t=this.map,e=t.eventMgr,i=t.layerMgr,s=olleh.maps.plugin.DefautlHandlers.HANDLERS,o=s.length;for(e.removeRecognizer("olleh.maps.event.Drag"),
t.getOption("disableDoubleClickZoom")||olleh.maps.event.handler.detach(i,olleh.maps.handler.DoubleClickZoom);o--;)olleh.maps.event.handler.detach(i,s[o])}}),olleh.maps.$skeleton.push(olleh.maps.plugin.DefautlHandlers),$class("olleh.maps.event.DoubleClick").mixin(olleh.maps.event.Recognizer).define({DoubleClick:function(t){this.isDblclicked=!1,this._history={},this.opts=olleh.maps.mixin({clickThreshold:4,dblrightclick:!0,clickDuration:400},t,!0),this.setEnabled(!0)},setOptions:function(t){t&&olleh.maps.mixin(this.opts,t,!0,["dblrightclick","clickThreshold","clickDuration"])},mousedown:function(t){var e=this._history.click;if(this.isDblclicked=!1,e)return t.timeStamp-e.timeStamp>this.opts.clickDuration?void(this._history.click=null):void(this._history.mouse={timeStamp:t.timeStamp,pageXY:t.pageXY,button:t.originEvent.button})},mouseup:function(t){var e=this._history.click,i=t.originEvent;if(!this.isDblclicked&&this.opts.dblrightclick&&!e&&olleh.maps.event.EventManager.isRightClick(t.originEvent))return this.click(t);if(e){var s=this._history.mouse||{pageXY:t.pageXY,button:1===i.button?0:2};return this._history.click=null,this._history.mouse=null,e&&e.button===s.button&&e.pageXY.distanceTo(s.pageXY)<this.opts.clickThreshold?(this.isDblclicked=!0,{name:2===s.button?"dblrightclick":"dblclick",opts:{originEvent:i}}):void 0}},click:function(t){if(this.isDblclicked)return void(this.isDblclicked=!1);this._history.click={timeStamp:t.timeStamp,pageXY:t.pageXY,button:t.originEvent.button}}}),$class("olleh.maps.event.RightClick").mixin(olleh.maps.event.Recognizer).define({RightClick:function(){this.setEnabled(!0)},mouseup:function(t){var e=t.originEvent;return olleh.maps.event.EventManager.isRightClick(e)?{name:"rightclick",opts:{originEvent:e}}:null}}),$class("olleh.maps.event.ScrollWheelZoom").mixin(olleh.maps.event.Recognizer).define({ScrollWheelZoom:function(){this._timeStamp=null,this.setEnabled(!0)},mousewheel:function(t){var e=t.originEvent,i=e.wheelDelta||-e.detail,s=this._timeStamp;return this._timeStamp=t.timeStamp,s&&t.timeStamp-s<100?null:{name:i>0?"req_zoomin":"req_zoomout",opts:{originEvent:e}}}}),$class("olleh.maps.event.KeyboardZoom").mixin(olleh.maps.event.Recognizer).define({KeyboardZoom:function(){this.setEnabled(!0)},keydown:function(t){if(olleh.maps.event.EventManager.checkEnabledKeyevent()){var e=t.originEvent;switch(e.which||e.keyCode){case 107:case 187:case 61:return{name:"req_zoomin"};case 109:case 189:case 173:return{name:"req_zoomout"}}}}}),$class("olleh.maps.handler.Desktop").define({$capture_mousedown:function(t,e){this._abortPanAnimationAndUpdateCenter()},$default_mousewheel:function(t,e){olleh.maps.event.EventManager.preventDefault(t.originEvent)}}),$class("olleh.maps.handler.Keyboard").define({$default_keydown:function(t,e){var i=olleh.maps.event.EventManager;if(i.checkEnabledKeyevent()){var s=t.originEvent,o=s.which||s.keyCode;switch(o){case 33:this._keymoveX=2,this._keymoveY=-2;break;case 34:this._keymoveX=2,this._keymoveY=2;break;case 35:this._keymoveX=-2,this._keymoveY=2;break;case 36:this._keymoveX=-2,this._keymoveY=-2;break;case 37:this._keymoveX=-2;break;case 38:this._keymoveY=-2;break;case 39:this._keymoveX=2;break;case 40:this._keymoveY=2;break;default:return this._moveTimeout&&(window.clearTimeout(this._moveTimeout),delete this._moveTimeout),!0}this._keyboardMoveStart=!0,i.preventDefault(s),i.stopPropagation(s),olleh.maps.util.deferAF(this._keyboardMove,this,t)}},$default_keyup:function(t,e){var i=olleh.maps.event.EventManager;if(i.checkEnabledKeyevent()){this._moveTimeout&&(window.cancelAnimationFrame(this._moveTimeout),delete this._moveTimeout);var s=t.originEvent;switch(s.which||s.keyCode){case 33:case 34:case 35:case 36:this._keymoveX=0,this._keymoveY=0;break;case 37:case 39:this._keymoveX=0;break;case 38:case 40:this._keymoveY=0;break;default:return!0}return i.preventDefault(s),i.stopPropagation(s),!1}},_keyboardMove:function(t,e){if(!this._eventMgr.isMapClicked())return window.cancelAnimationFrame(this._moveTimeout),void delete this._moveTimeout;if(this._keyboardMoveStart&&this._keymoveX||this._keymoveY){var i=this.calcNewCenter(this._keymoveX||0,this._keymoveY||0);this.moveTo(i,null,"off"),this._moveTimeout=olleh.maps.util.deferAF(this._keyboardMove,this,e)}else!this._moveTimeout&&this._eventMgr._ok||(window.cancelAnimationFrame(this._moveTimeout),delete this._moveTimeout)}}),$class("olleh.maps.handler.BoxZoom").define({$current_dragstart:function(t,e){var i=t.originEvent,s=i.which||i.keyCode,o=i.shiftKey,n=1!==i.button,a=this._boxZoomElem;if(o&&(1===s||!n)){t.preventDefault(),this._dragStartPosition=t.getPoint(),this._boxZoomStart=!0,a||(a=this._boxZoomElem=document.createElement("div"),olleh.maps.util.dom.addClass(a,"ollehmap-boxzoom"));var r=a.style,l=this._dragStartPosition;r.width=0,r.height=0,r.top=l.y+"px",r.left=l.x+"px",this._layer_container.appendChild(a)}},$current_drag:function(t,e){if(this._boxZoomStart){var i=t.getPoint(),s=this._dragStartPosition,o=Math.abs(i.x-s.x),n=Math.abs(i.y-s.y),a=this._boxZoomElem.style;t.preventDefault(),a.width=o+"px",a.height=n+"px",i.y<s.y&&(a.top=i.y+"px"),i.x<s.x&&(a.left=i.x+"px")}},$current_dragend:function(t,e){if(this._boxZoomStart){var i,s,o,n,a,r,l=t.getPoint(),h=this._dragStartPosition;t.preventDefault(),this._boxZoomStart=!1,this._layer_container.removeChild(this._boxZoomElem),l.x>h.x?(i=h.x,s=l.x):(i=l.x,s=h.x),l.y>h.y?(o=h.y,n=l.y):(o=l.y,n=h.y),a=this.getCoordFromViewportPx(new olleh.maps.Point(i,n),!1),r=this.getCoordFromViewportPx(new olleh.maps.Point(s,o),!1),a&&r&&this.fitBounds(new olleh.maps.Bounds(a,r))}}}),$class("olleh.maps.plugin.Desktop").extend(olleh.maps.Adaptable).define({$static:{HANDLERS:[olleh.maps.handler.Desktop,olleh.maps.handler.BoxZoom,olleh.maps.handler.Keyboard]},attach:function(){var t=this.map,e=t.eventMgr,i=t.layerMgr,s=olleh.maps.plugin.Desktop.HANDLERS,o=s.length;for(e.addRecognizer(new olleh.maps.event.RightClick),e.addRecognizer(new olleh.maps.event.DoubleClick),t.getOption("disableScrollWheelZoom")||e.addRecognizer(new olleh.maps.event.ScrollWheelZoom),e.addRecognizer(new olleh.maps.event.KeyboardZoom);o--;)olleh.maps.event.handler.attach(i,s[o])},detach:function(){var t=this.map,e=t.eventMgr,i=t.layerMgr,s=olleh.maps.plugin.Desktop.HANDLERS,o=s.length;for(e.removeRecognizer("olleh.maps.event.RightClick"),e.removeRecognizer("olleh.maps.event.DoubleClick"),e.removeRecognizer("olleh.maps.event.ScrollWheelZoom"),e.removeRecognizer("olleh.maps.event.KeyboardZoom");o--;)olleh.maps.event.handler.detach(i,s[o])}}),olleh.maps.$skeleton.push(olleh.maps.plugin.Desktop),$class("olleh.maps.control.CopyrightControl").extend(olleh.maps.control.Control).define({$static:{CONTENT:olleh.maps.env.TILE_COPYRIGHT.BASE},CopyrightControl:function(t){var e=olleh.maps.control.Control,i=olleh.maps.mixin({position:e.BOTTOM_LEFT,direction:e.HORIZONTAL},t,!0);this.position=i.position,this.direction=i.direction},draw:function(){var t=olleh.maps.Element.create("div").addClass("ollehmap-copyright-control").setStyle("margin","5px");return this.map.hasMobileStylesheet||(this.contentElem=olleh.maps.Element.create("span"),t.appendChild(this.contentElem),this.map.onEvent("maptypeid_changed",this._updateContent,this),this._updateContent()),t},_updateContent:function(){var t,e=this.map.layerMgr.getActiveBaseLayer();e&&(t=e.copyright),olleh.maps.isUndefined(t)&&(t=olleh.maps.control.CopyrightControl.CONTENT),this.contentElem.elem.innerHTML!==t&&(this.contentElem.elem.innerHTML=t)},detach:function(){var t=this.mgr.map;!olleh.maps.browser.isMobile&&t.unsubscribeEvent("maptypeid_changed",this._updateContent,this),olleh.maps.control.CopyrightControl.$super.detach.apply(this,arguments)}}),$class("olleh.maps.control.LogoControl").extend(olleh.maps.control.Control).define({$static:{CONTENT:olleh.maps.env.TILE_COPYRIGHT.BASE},LogoControl:function(t){var e=olleh.maps.control.Control,i=olleh.maps.mixin({position:e.BOTTOM_RIGHT,direction:e.HORIZONTAL},t,!0);this.position=i.position,this.direction=i.direction},draw:function(){var t=olleh.maps.Element.create("div");return this.map.hasMobileStylesheet?(t.addClass("mobile-logo"),olleh.maps.browser.isHD?t.addClass("retina").setStyle("backgroundImage","url("+olleh.maps.env.RESOURCE_URL+"img/retinas.png)"):t.setStyle("backgroundImage","url("+olleh.maps.env.RESOURCE_URL+"img/mobiles.png)")):(t.addClass("ollehmap-logo-control"),t.setStyle("backgroundImage","url("+olleh.maps.control.Control.IMG_URL+")")),this.mgr.map.getMapTypeId()!==olleh.maps.Map.ROADMAP&&this.mgr.map.getMapTypeId()!==olleh.maps.Map.ENGMAP&&t.addClass("imagery"),t},detach:function(){olleh.maps.control.LogoControl.$super.detach.apply(this,arguments)},_updateActiveBaseLayer:function(){var t=this.mgr.map.layerMgr,e=t.getActiveBaseLayer();this.elem&&e&&("black"===e.logoType?this.elem.removeClass("imagery"):this.elem.addClass("imagery"))},attach:function(){olleh.maps.control.LogoControl.$super.attach.apply(this,arguments),this.map.onEvent("set_base_layer",this._updateActiveBaseLayer,this)},detach:function(){this.map.unsubscribeEvent("set_base_layer",this._updateActiveBaseLayer,this),olleh.maps.control.LogoControl.$super.detach.apply(this,arguments)}}),$class("olleh.maps.control.ScaleControl").extend(olleh.maps.control.Control).define({ScaleControl:function(t){var e=olleh.maps.control.Control,i=olleh.maps.mixin({position:e.BOTTOM_RIGHT,direction:e.HORIZONTAL},t,!0);this.scaleImg=null,this.scaleStr=null,this.topOutUnits="km",this.topInUnits="m",this.position=i.position,this.direction=i.direction},draw:function(){var t=olleh.maps.Element.create("div").addClass("ollehmap-scale-control");return this.scaleImg=olleh.maps.Element.create("div").addClass("ollehmap-scale-image"),this.scaleStr=olleh.maps.Element.create("div"),this.mgr.map.getMapTypeId()!==olleh.maps.Map.ROADMAP&&this.mgr.map.getMapTypeId()!==olleh.maps.Map.ENGMAP&&this.scaleImg.addClass("imagery"),t.pushElement(this.scaleImg),t.pushElement(this.scaleStr),this._update(),t},_update:function(){var t=this.mgr.map.layerMgr,e=t.getResolution();if(e){var i,s=olleh.maps.util.INCHES_PER_UNIT,o=50*e*s.Meter;i=o>1e5?this.topOutUnits:this.topInUnits;var n=(o/s[i]).toFixed(0);this.scaleStr.elem.innerHTML=n+i}},_updateActiveBaseLayer:function(){var t=this.mgr.map.layerMgr,e=t.getActiveBaseLayer();this.scaleImg&&e&&("black"===e.logoType?this.scaleImg.removeClass("imagery"):this.scaleImg.addClass("imagery"))},attach:function(){olleh.maps.control.ScaleControl.$super.attach.apply(this,arguments),this.map.onEvent("zoom_changed",this._update,this),this.map.onEvent("set_base_layer",this._updateActiveBaseLayer,this)},detach:function(){this.map.unsubscribeEvent("zoom_changed",this._update,this),this.map.unsubscribeEvent("set_base_layer",this._updateActiveBaseLayer,this),olleh.maps.control.ScaleControl.$super.detach.apply(this,arguments)}}),$class("olleh.maps.control.PanControl").extend(olleh.maps.control.Control).define({$static:{SLIDE_FACTOR:200,PAN_INFO:{panup:{desc:"위로 이동",origin:new olleh.maps.Point(25,6)},panleft:{desc:"왼쪽으로 이동",origin:new olleh.maps.Point(8,23)},panright:{desc:"오른쪽으로 이동",origin:new olleh.maps.Point(44,23)},pandown:{desc:"아래로 이동",origin:new olleh.maps.Point(24,44)}}},PanControl:function(t){var e=olleh.maps.control.Control,i=olleh.maps.mixin({position:e.TOP_LEFT,direction:e.VERTICAL},t,!0);this.position=i.position,this.direction=i.direction,this.panBtns=[]},draw:function(){var t,e,i=olleh.maps.control.PanControl.PAN_INFO,s=olleh.maps.Element.create("div").setStyles({padding:this.padding+"px",position:"relative"}),o=olleh.maps.Element.create("div").addClass("control-pan").setStyle("backgroundImage","url("+olleh.maps.env.RESOURCE_URL+"img/controls.png)");s.appendChild(o);for(var n in i)e=i[n],t=this[n+"Btn"]=olleh.maps.Element.create("div").addClass("control-"+n).addClass("ollehmap-control-clickable"),t.setStyles({backgroundImage:"url("+olleh.maps.env.RESOURCE_URL+"img/controls.png)",left:e.origin.x+this.padding+"px",top:e.origin.y+this.padding+"px",position:"absolute"}),t.setProperty("title",e.desc),s.appendChild(t),this.registerEventDom(t.elem);return s},propagateEvent:function(t,e){switch(t.getName()){case"mousedown":case"touchstart":this.mousedown(t,e);break;case"mouseup":case"touchend":case"dragend":case"mouseout":this.mouseup(t,e)}},mousedown:function(t,e){var i=t.targetDOM;this._pressTimeout=olleh.maps.util.delay(this.mousedown,100,this,t),i===this.panupBtn.elem?this._keymoveY=-2:i===this.pandownBtn.elem?this._keymoveY=2:i===this.panleftBtn.elem?this._keymoveX=-2:i===this.panrightBtn.elem&&(this._keymoveX=2),this._panMoveStart=!0,olleh.maps.util.deferAF(this._panMove,this,t)},mouseup:function(t,e){var i=t.targetDOM;if(this._moveTimeout&&(window.cancelAnimationFrame(this._moveTimeout),delete this._moveTimeout),this._pressTimeout&&(window.clearTimeout(this._pressTimeout),delete this._pressTimeout),i===this.panupBtn.elem||i===this.pandownBtn.elem)this._keymoveY=0;else{if(i!==this.panleftBtn.elem&&i!==this.panrightBtn.elem)return;this._keymoveX=0}},_panMove:function(t,e){if(this._panMoveStart&&this._keymoveX||this._keymoveY){var i=this.mgr.map.layerMgr,s=i.calcNewCenter(this._keymoveX||0,this._keymoveY||0);i.panTo(s,i.getZoom(),"off"),this._moveTimeout=olleh.maps.util.deferAF(this._panMove,this,e)}else this._moveTimeout&&(window.cancelAnimationFrame(this._moveTimeout),delete this._moveTimeout)}}),$class("olleh.maps.control.MapTypeControl").extend(olleh.maps.control.Control).define({$static:{DEFAULT_MAP_TYPE:["roadmap","satellite","hybrid","engmap"]},MapTypeControl:function(t){var e=olleh.maps.control.Control;this.position=e.TOP_RIGHT,this.direction=e.VERTICAL},draw:function(){var t,e,i=olleh.maps.Element.create("div"),s=olleh.maps.control.MapTypeControl.DEFAULT_MAP_TYPE,o="url("+olleh.maps.control.Control.IMG_URL+")",n=s.length;this._btnList={},i.setStyles({padding:this.padding+"px",position:"relative"});for(var a=0;a<n;a++)("engmap"!=(e=s[a].toLowerCase())||this.mgr.map.getUseEngMap())&&(t=olleh.maps.Element.create("div").addClass("control-"+e+"-out").addClass("olleh-maps-inline").addClass("ollehmap-control-clickable"),t.setStyle("backgroundImage",o),t.elem.name=e,i.appendChild(t),this.registerEventDom(t.elem),this._btnList[e]=t);return this._changeButtonState(this.map.getMapTypeId()),i},propagateEvent:function(t,e){switch(t.getName()){case"mouseup":case"touchend":var i=t.targetDOM;this._click(i)}},_click:function(t){var e=t.name;e&&this._changeButtonState(e)},_changeButtonState:function(t){if(!t)return void olleh.maps.log.warn("_changeButtonState: key is null",this);var e=this._btnList,i=t.toUpperCase(),s=t.toLowerCase();this.map.setMapTypeId(i);for(var o in e)e[o].removeClass("control-"+o+(o===s?"-out":"-selected")),e[o].addClass("control-"+o+(o===s?"-selected":"-out"))},_onMapTypeIdChanged:function(){if(this.isDrawn()){var t=this.map.getMapTypeId();this._changeButtonState(t)}},attach:function(){olleh.maps.control.MapTypeControl.$super.attach.apply(this,arguments),this.map.onEvent("maptypeid_changed",this._onMapTypeIdChanged,this)},detach:function(){this.map.unsubscribeEvent("maptypeid_changed",this._onMapTypeIdChanged,this),olleh.maps.control.MapTypeControl.$super.detach.apply(this,arguments)}}),$class("olleh.maps.control.ZoomControl").extend(olleh.maps.control.Control).define({$static:{DEFAULT:"default",LARGE:"large",SMALL:"small",ZOOM_INFO:{1:"전국",3:"도",5:"시군구",8:"동리",11:"거리",13:"새주소"}},ZoomControl:function(t){var e=olleh.maps.control,i=olleh.maps.mixin({position:e.Control.TOP_RIGHT,direction:e.Control.VERTICAL,style:e.ZoomControl.LARGE},t,!0);this.position=i.position,this.direction=i.direction,this.style=i.style,this._gradation=9,this._zoom=null},draw:function(){var t=olleh.maps.Element.create("div").addClass("ollehmap-zoom-control").setStyles({padding:this.padding+"px"});return this.elem=t,this.style===olleh.maps.control.ZoomControl.SMALL?this._drawSmallZoom(t):this._drawBigZoom(t),t},_drawSmallZoom:function(t){this._addZoomBtn(t,"zoomin").setProperty("title","확대"),this._addZoomBtn(t,"zoomout").setProperty("title","축소")},_drawBigZoom:function(t){var e=this.mgr.map;this._btnY=26,this._resetMinMaxZoom(),this._drawZoomInfo(t),this._addAbsoluteImgBtn(t,"zoomslider",new olleh.maps.Point(8,0)),this._addZoomBtn(t,"zoomin").setProperty("title","확대"),this._drawZoomBar(t),this._addZoomBtn(t,"zoomout").setProperty("title","축소"),this.zoomoutBtn.setStyle("margin-top","-1px"),this._updateSlider(),this.zoomslider.addClass("ollehmap-control-clickable"),this.registerEventDom(this.zoomslider.elem),e.onEvent("zoomrange_changed",this._updateZoomRange,this),e.onEvent("zoom_change",this._updateSlider,this),e.onEvent("zoom_changed",this._updateSlider,this),this._hideZoomInfo()},_drawZoomBar:function(t){var e=this._activeBar=olleh.maps.Element.create("div").addClass("control-zoombar-active").addClass("ollehmap-control-clickable"),i=this._deactiveBar=olleh.maps.Element.create("div").addClass("control-zoombar-deactive").addClass("ollehmap-control-clickable");i.setStyle("backgroundImage","url("+olleh.maps.env.RESOURCE_URL+"img/controls.png)"),e.setStyle("backgroundImage","url("+olleh.maps.env.RESOURCE_URL+"img/controls.png)"),t.appendChild(i.elem),t.appendChild(e.elem),this.registerEventDom(i.elem),this.registerEventDom(e.elem)},_drawZoomInfo:function(t){var e=new olleh.maps.Point(-35,0),i=olleh.maps.Element.create("div"),s=olleh.maps.control.ZoomControl.ZOOM_INFO;for(var o in s)this._addAbsoluteImgBtn(i,"level"+o,e);t.elem.appendChild(i.elem),this._updateZoomInfo(),this.zoomBarInfo=i},_updateZoomRange:function(){this._resetMinMaxZoom(),this._updateZoomInfo(),this._updateSlider(),this._setZoom(this.map.getZoom())},_updateSlider:function(t,e){e?e.newZoom!==this._zoom&&this._setZoom(e.newZoom):this._setZoom(this.mgr.map.getZoom())},_updateZoomInfo:function(){var t=olleh.maps.control.ZoomControl.ZOOM_INFO;for(var e in t)this._updateZoomLevelInfo(this["level"+e],e)},_updateZoomLevelInfo:function(t,e){e>=this.minZoom&&e<=this.maxZoom?t.setStyles({top:(this.maxZoom-e)*this._gradation+this.padding+this._btnY+"px",display:"block"}):t.setStyle("display","none")},_resetMinMaxZoom:function(){var t=this.mgr.map;this.maxZoom=t.getMaxZoom(),this.minZoom=t.getMinZoom()},_setZoom:function(t){this._zoom=t;var e=(this.maxZoom-t)*this._gradation+this.padding+this._btnY+3;this.zoomslider.setStyle("top",e+"px"),this._deactiveBar.setStyles({height:this._gradation*(this.maxZoom-t+1)+"px"}),this._activeBar.setStyles({height:this._gradation*(t-this.minZoom+1)+"px"})},_addAbsoluteImgBtn:function(t,e,i){var s=this[e]=olleh.maps.Element.create("div").addClass("control-"+e);return s.setStyles({backgroundImage:"url("+olleh.maps.env.RESOURCE_URL+"img/controls.png)",left:i.x+"px",top:i.y+"px",position:"absolute"}),t.appendChild(s.elem),s},_addZoomBtn:function(t,e){var i=olleh.maps.Element.create("div").addClass("control-"+e).addClass("ollehmap-control-clickable");return i.setStyles({backgroundImage:"url("+olleh.maps.env.RESOURCE_URL+"img/controls.png)",display:"block"}),t.appendChild(i.elem),this.registerEventDom(i.elem),this[e+"Btn"]=i,i},_showZoomInfo:function(){this.zoomBarInfo&&this.zoomBarInfo.setStyle("display","block")},_hideZoomInfo:function(){this.zoomBarInfo&&this.zoomBarInfo.setStyle("display","none")},propagateEvent:function(t,e){var i=t.targetDOM;switch(t.getName()){case"mouseover":this._showZoomInfo();break;case"mouseout":this._hideZoomInfo();break;case"dragstart":this.dragstart(i);break;case"drag":this.drag(t,e);break;case"dragend":this.dragend(i),this.mouseup(i);break;case"click":case"rightclick":if(!this.isDraggable(i))return;this.dragFlag=!0,this.drag(t,e),this.dragFlag=!1;break;case"mousedown":case"touchstart":this.mousedown(i);break;case"mouseup":case"touchend":this.mouseup(i)}},isDraggable:function(t){return this.style===olleh.maps.control.ZoomControl.LARGE},dragstart:function(t){this.isDraggable(t)&&(this.zoomslider.addClass("ollehmap-dragging"),this.dragFlag=!0)},drag:function(t){if(this.dragFlag){var e=this.elem.elem.getBoundingClientRect().top,i=t.originEvent.clientY-this._btnY-e-this.padding,s=parseInt(this.maxZoom-i/this._gradation+1);s<=this.maxZoom&&s>=this.minZoom&&s!==this._zoom&&this.mgr.map.setZoom(s)}},dragend:function(t){this.zoomslider&&this.zoomslider.removeClass("ollehmap-dragging"),this.dragFlag=!1},mousedown:function(t){var e=this.mgr.map,i=null;if(t===this.zoominBtn.elem)i=e.zoomIn;else{if(t!==this.zoomoutBtn.elem)return;i=e.zoomOut}i.apply(e),this._interval=window.setInterval(i.bind(e),500)},mouseup:function(t){this._interval&&(window.clearTimeout(this._interval),delete this._interval)},detach:function(){var t=this.mgr.map;t.unsubscribeEvent("zoomrange_changed",this._updateZoomRange,this),t.unsubscribeEvent("zoom_change",this._updateSlider,this),t.unsubscribeEvent("zoom_changed",this._updateSlider,this),olleh.maps.control.ZoomControl.$super.detach.apply(this,arguments)}}),$class("olleh.maps.control.PluginControl").extend(olleh.maps.control.Control).define({PluginControl:function(t){var e=olleh.maps.control.Control;this.position=e.TOP_RIGHT,this.direction=e.HORIZONTAL,olleh.maps.mixin(this,t,!0)},attach:function(){olleh.maps.control.PluginControl.$super.attach.call(this);var t=this.mgr.map.pluginRegistry;t.onEvent("plugin_added",this._redrawItems,this),t.onEvent("plugin_state_changed",this._redrawItems,this)},detach:function(){var t=this.mgr.map.pluginRegistry;this.mgr.map.unsubscribeEvent("mouseover",this._hideExpand,this),t.unsubscribeEvent("plugin_added",this._redrawItems,this),t.unsubscribeEvent("plugin_state_changed",this._redrawItems,this),olleh.maps.control.PluginControl.$super.detach.call(this)},draw:function(){var t=olleh.maps.Element.create("div").setStyles({padding:this.padding+"px",position:"relative"});return this._drawExpandType(t),this.registerEventDom(t.elem),t},_drawExpandType:function(t){var e=olleh.maps.Element.create("a"),i=this.form=olleh.maps.Element.create("form");t.addClass("ollehmap-maptype-control-expandtype"),e.addClass("ollehmap-maptype-control-toggle"),i.addClass("ollehmap-maptype-control-list"),e.setStyle("background","url("+olleh.maps.env.RESOURCE_URL+"img/layers.png)"),this._drawItems(i),t.pushElement(e.elem),t.pushElement(i.elem)},_redrawItems:function(){if(this.form){for(var t=this.form.elem.childNodes,e=t.length;e--;)this.form.removeChild(t.item(e));this._drawItems(this.form)}},_drawItems:function(t){this.groups=this.mgr.map.pluginRegistry.getLabeledPluginsByGroup(),this._drawList(t,this.groups.$baseLayer,"radio","$baseLayer");for(var e in this.groups)"$baseLayer"!==e&&"$nogroup"!==e&&(this._drawSeparator(t),this._drawList(t,this.groups[e],"checkbox"));this.groups.$nogroup&&this.groups.$nogroup.length&&(this._drawSeparator(t),this._drawList(t,this.groups.$nogroup,"checkbox"))},_drawSeparator:function(t){var e=olleh.maps.Element.create("div").addClass("ollehmap-maptype-control-separator");t.appendChild(e)},_drawList:function(t,e,i,s){for(var o=0,n=e.length;o<n;o++){var a=e[o];("OllehEng"!=a.name||this.mgr.map.getUseEngMap())&&this._drawChild(t,a,i,s)}},_drawChild:function(t,e,i,s){var o=olleh.maps.Element.create("div"),n=e.pluginInfo.label,a=olleh.maps.util.applyTemplate('<input type="#{type}" name="#{name}" #{checked}>#{label}</input>',{type:i,name:s||"",checked:e.isActive()?'checked="checked"':"",label:n});o.elem.innerHTML=a,this.registerEventDom(o.elem),o.setProperty("data-value",e),o.setProperty("data-type",i),t.appendChild(o)},_showExpand:function(){this.elem.addClass("ollehmap-maptype-control-expanded"),this._expanded||(this.mgr.map.onEvent("mouseover",this._hideExpand,this),this._expanded=!0)},_hideExpand:function(t,e){t.getSource()!==this&&(this.elem&&this.elem.removeClass("ollehmap-maptype-control-expanded"),this.mgr.map.unsubscribeEvent("mouseover",this._hideExpand,this),this._expanded=!1)},propagateEvent:function(t,e){switch(t.getName()){case"click":case"touchend":this._click(t,e);break;case"mouseover":this._showExpand()}},_click:function(t,e){var i=t.targetDOM,s=i["data-value"];s&&("radio"===i["data-type"]?!s.isActive()&&s.activate():s.isActive()?s.deactivate():s.activate())},_changeButtonState:function(t){var e=olleh.maps.control.Control.IMG_LOCATION,i=olleh.maps.control.PluginControl.IMG_URLS,s=this._dButtonList;for(var o in s)s[o].setProperty("src",e+i[o+(o===t?"_ON":"_OFF")])}}),$class("olleh.maps.plugin.DesktopControlsPlugin").extend(olleh.maps.Adaptable).define({attach:function(){var t=this.map;t.checkDefaultControl("panControl")&&(this.panControl=new olleh.maps.control.PanControl,this.panControl.setMap(t)),t.checkDefaultControl("logoControl")&&(this.logoControl=new olleh.maps.control.LogoControl,this.logoControl.setMap(t)),t.checkDefaultControl("scaleControl")&&(this.scaleControl=new olleh.maps.control.ScaleControl,this.scaleControl.setMap(t)),t.checkDefaultControl("mapTypeControl")&&(this.mapTypeControl=new olleh.maps.control.MapTypeControl,this.mapTypeControl.setMap(t)),t.checkDefaultControl("zoomControl")&&(this.zoomControl=new olleh.maps.control.ZoomControl,this.zoomControl.setMap(t))},detach:function(){}}),olleh.maps.$skeleton.push(olleh.maps.plugin.DesktopControlsPlugin),$class("olleh.maps.plugin.measure.MeasureService").extend(olleh.maps.Adaptable).define({serviceId:"measureService",attach:function(){this.map.checkDefaultControl("measureControl")&&(this.measureControl=new olleh.maps.control.MeasureControl,this.measureControl.setMap(this.map)),this.measureDistancePlugin=new olleh.maps.plugin.measure.MeasureDistancePlugin,this.measureDistancePlugin.setMap(this.map),this.measureAreaPlugin=new olleh.maps.plugin.measure.MeasureAreaPlugin,this.measureAreaPlugin.setMap(this.map)},detach:function(){this.measureControl&&this.measureControl.setMap(null),this.measureDistancePlugin.setMap(null),this.measureAreaPlugin.setMap(null)},add:function(t){this._measureOverlays||(this._measureOverlays=[]),this._measureOverlays.push(t)},remove:function(t){t.setMap(null),olleh.maps.util.removeFromArray(this._measureOverlays,t)},clear:function(){this.map.services.measureDistance.deactivate(),this.map.services.measureArea.deactivate();var t=this._measureOverlays;if(t){for(var e=0;e<t.length;e++)t[e].setMap(null);delete this._measureOverlays}}}),olleh.maps.$skeleton.push(olleh.maps.plugin.measure.MeasureService),$class("olleh.maps.plugin.measure.MeasureDistancePlugin").mixin(olleh.maps.Plugin).define({cursor:"cursor/distance.cur",deleteOrigin:new olleh.maps.Point(107,156),serviceId:"measureDistance",pointOrigin:new olleh.maps.Point(127,145),pluginInfo:{drawingTool:!0},doActivate:function(){var t=this.map,e=t.layerMgr;t.setCursor("url("+olleh.maps.env.RESOURCE_URL+this.cursor+"), default"),e.onEvent("click",this._onClick,this,!0),e.onEvent("rightclick",this._onRightClick,this,!0),e.setEditMode(!0)},_onClick:function(t){var e=this.map;if(e.layerMgr.isZooming())return void t.stopPropagation();var i=t.getCoord();if(this._measureOverlayGroup){var s=this._measureOverlayGroup.inProgressVector.getPath(),o=this._measureOverlayGroup.getPath();if(!o.getLast().equals(s.getLast())){var n=s.getDistance(),a=this._createPointIcon(i),r=new olleh.maps.plugin.measure.MeasureOverlay({map:e,position:i,type:"pointInfo",distance:n});this._measureOverlayGroup.addPointIcon(a),this._measureOverlayGroup.addPointInfo(r),o.push(i),s.setAt(0,i),s.setAt(1,i)}}else{var l=this._createVector(t.getCoord()),h=new olleh.maps.plugin.measure.MeasureOverlay({map:e,position:t.getCoord()}),m=this._createInProgressVector(t.getCoord());this._measureOverlayGroup=new olleh.maps.plugin.measure.MeasureOverlayGroup(l,m,h),e.services.measureService.add(this._measureOverlayGroup),h.bringToFront();var a=this._createPointIcon(i);this._measureOverlayGroup.addPointIcon(a);var r=new olleh.maps.plugin.measure.MeasureOverlay({map:e,position:i,type:"pointStart"});this._measureOverlayGroup.addPointInfo(r),e.layerMgr.onEvent("mousemove",this._onMove,this,!0)}t.stopPropagation()},_onMove:function(t){if(this._measureOverlayGroup){var e=this._measureOverlayGroup.inProgressVector.getPath();e.setAt(1,t.getCoord());var i=this._measureOverlayGroup.detailInfo;i.setPosition(t.getCoord()),i.setDistance(this._measureOverlayGroup.getPath().getDistance()+e.getDistance()),t.stopPropagation()}},_onRightClick:function(t){if(this.map.layerMgr.isZooming())return void t.stopPropagation();this.deactivate(),t.stopPropagation()},_createPointIcon:function(t){return new olleh.maps.overlay.Marker({map:this.map,position:t,flat:!0,icon:{url:olleh.maps.env.RESOURCE_URL+"img/controls.png",origin:this.pointOrigin,size:new olleh.maps.Size(11,11),anchor:new olleh.maps.Point(5,5)}})},_createInProgressVector:function(t){var e=new olleh.maps.Path([t,t]);return new olleh.maps.vector.Polyline({map:this.map,path:e,strokeColor:"#df2428",strokeOpacity:.3,strokeWeight:5})},_createVector:function(t){var e=new olleh.maps.Path([t,t]);return new olleh.maps.vector.Polyline({map:this.map,path:e,strokeColor:"#df2428",strokeOpacity:.7,strokeWeight:5})},_getDistance:function(){return this._measureOverlayGroup.getPath().getDistance()},doDeactivate:function(){var t=this.map;t.resetCursor();var e=t.layerMgr;if(e.unsubscribeEvent("mousemove",this._onMove,this),e.unsubscribeEvent("click",this._onClick,this),e.unsubscribeEvent("rightclick",this._onRightClick,this),e.setEditMode(!1),this._measureOverlayGroup){var i;this._measureOverlayGroup.inProgressVector?(i=this._measureOverlayGroup.inProgressVector.getPath().getLast(),this._measureOverlayGroup.removeInProgressVector()):i=this._measureOverlayGroup.getPath().getLast(),this._measureOverlayGroup.getPath().push(i);var s=this._createPointIcon(i);this._measureOverlayGroup.addPointIcon(s),this._measureOverlayGroup.detailInfo.finish(this._getDistance()),this._createDeleteMarker(),this._measureOverlayGroup=null}},_createDeleteMarker:function(){var t=this._measureOverlayGroup,e=t.getPath(),i=e.getAt(e.getLength()-1),s=new olleh.maps.overlay.Marker({map:this.map,position:i,flat:!0,icon:{url:olleh.maps.env.RESOURCE_URL+"img/controls.png",origin:this.deleteOrigin,size:new olleh.maps.Size(18,17),anchor:new olleh.maps.Point(-10,8)}});t.setDeleteMarker(s);var o=this.map;s.onEvent("click",function(){o.services.measureService.remove(t)})}}),$class("olleh.maps.plugin.measure.MeasureAreaPlugin").extend(olleh.maps.plugin.measure.MeasureDistancePlugin).define({cursor:"cursor/area.cur",deleteOrigin:new olleh.maps.Point(107,112),serviceId:"measureArea",pluginInfo:{drawingTool:!0},pointOrigin:new olleh.maps.Point(127,134),_createVector:function(t){var e=new olleh.maps.Path([t,t]);return new olleh.maps.vector.Polygon({map:this.map,paths:e,strokeColor:"#06b3f5",strokeOpacity:.7,strokeWeight:5,fillColor:"#06b3f5",fillOpacity:.3})},_onClick:function(t){var e=this.map,i=t.getCoord();if(this._measureOverlayGroup){var s=this._measureOverlayGroup.getPath(),o=s.getAt(s.getLength()-2);if(!s.getLast().equals(o)){s.setAt(s.getLength()-1,i),s.push(i);var n=this._createPointIcon(i);this._measureOverlayGroup.addPointIcon(n)}}else{var a=this._createVector(t.getCoord()),r=new olleh.maps.plugin.measure.MeasureOverlay({map:e,position:t.getCoord(),type:"areaInfo"});r.bringToFront(),this._measureOverlayGroup=new olleh.maps.plugin.measure.MeasureOverlayGroup(a,null,r),e.services.measureService.add(this._measureOverlayGroup);var n=this._createPointIcon(i);this._measureOverlayGroup.addPointIcon(n),e.layerMgr.onEvent("mousemove",this._onMove,this,!0)}t.stopPropagation()},_onMove:function(t){if(this._measureOverlayGroup){var e=this._measureOverlayGroup.getPath();e.setAt(e.getLength()-1,t.getCoord()),this._measureOverlayGroup.detailInfo.setPosition(t.getCoord()),t.stopPropagation()}},_getDistance:function(){return this._measureOverlayGroup.getPath().getArea()}}),$class("olleh.maps.control.MeasureControl").extend(olleh.maps.control.Control).define({MeasureControl:function(t){this.position=olleh.maps.control.Control.TOP_RIGHT,this.direction=olleh.maps.control.Control.VERTICAL,olleh.maps.mixin(this,t,!0)},attach:function(){
olleh.maps.control.MeasureControl.$super.attach.apply(this,arguments),this.map.pluginRegistry.onEvent("plugin_state_changed",this._onStateChanged,this)},detach:function(){this.map.pluginRegistry.unsubscribeEvent("plugin_state_changed",this._onStateChanged,this),olleh.maps.control.MeasureControl.$super.detach.apply(this,arguments)},draw:function(){var t=olleh.maps.Element.create("div"),e="url("+olleh.maps.env.RESOURCE_URL+"img/controls.png)";t.setStyles({position:"relative",height:"75px"});var i=this._distanceImg=olleh.maps.Element.create("div");i.addClass("control-distance-out").addClass("ollehmap-control-clickable"),i.setProperty("title","거리재기"),i.setStyles({backgroundImage:e,position:"absolute",top:"0px",right:"5px"}),t.appendChild(i.elem),this.registerEventDom(i.elem);var s=this._areaImg=olleh.maps.Element.create("div");s.addClass("control-shape-out").addClass("ollehmap-control-clickable"),s.setProperty("title","면적재기"),s.setStyles({backgroundImage:e,position:"absolute",top:"25px",right:"5px"}),t.appendChild(s.elem),this.registerEventDom(s.elem);var o=this._clearImg=olleh.maps.Element.create("div");return o.addClass("control-change").addClass("ollehmap-control-clickable"),o.setProperty("title","초기화"),o.setStyles({backgroundImage:e,position:"absolute",top:"50px",right:"5px"}),t.appendChild(o.elem),this.registerEventDom(o.elem),t},propagateEvent:function(t,e){switch(t.getName()){case"click":case"touchend":this._click(t)}t.stopPropagation()},_click:function(t){var e=t.targetDOM,i=this.map;e===this._distanceImg.elem?i.services.measureDistance.activate():e===this._areaImg.elem?i.services.measureArea.activate():e===this._clearImg.elem&&i.services.measureService.clear()},_onStateChanged:function(t,e){var i,s=this.map;e.plugin===s.services.measureDistance?(i=s.services.measureDistance.isActive(),this._distanceImg.addClass("control-distance"+(i?"-selected":"-out")),this._distanceImg.removeClass("control-distance"+(i?"-out":"-selected"))):e.plugin===s.services.measureArea&&(i=s.services.measureArea.isActive(),this._areaImg.addClass("control-shape"+(i?"-selected":"-out")),this._areaImg.removeClass("control-shape"+(i?"-out":"-selected")))}}),$class("olleh.maps.plugin.measure.MeasureOverlayGroup").define({MeasureOverlayGroup:function(t,e,i){this.vector=t,this.inProgressVector=e,this.detailInfo=i,this.pointInfos=[],this.pointIcons=[],this.deleteMarker},removeInProgressVector:function(){this.inProgressVector&&(this.inProgressVector.setMap(null),this.inProgressVector=null)},setDeleteMarker:function(t){this.deleteMarker=t},addPointInfo:function(t){this.pointInfos.push(t)},addPointIcon:function(t){this.pointIcons.push(t)},getPath:function(){return this.vector.getPath?this.vector.getPath():this.vector.getPaths?this.vector.getPaths()[0]:void 0},setMap:function(t){this.vector.setMap(t),this.inProgressVector&&this.inProgressVector.setMap(t),this.detailInfo.setMap(t),this.deleteMarker&&this.deleteMarker.setMap(t);for(var e=0;e<this.pointInfos.length;e++)this.pointInfos[e].setMap(t);for(var i=0;i<this.pointIcons.length;i++)this.pointIcons[i].setMap(t)}}),$class("olleh.maps.plugin.measure.MeasureOverlay").extend(olleh.maps.overlay.PointedOverlay).define({MeasureOverlay:function(t){this._opts=olleh.maps.mixin({type:"distanceInfo"},t,!0)},update:function(){if(!this.div){this.div=olleh.maps.Element.create("div"),this.div.addClass("ollehmap-measure"),this.div.setStyles({boxShadow:"0 0 1px rgba(0,0,0,0.5)",userSelect:"none"});var t=this._opts;"areaInfo"===t.type?this._updateAreaInfo():"pointStart"===t.type?this._updatePointStart():"pointInfo"===t.type?this._updatePointInfo():this._updatePointDetail(),this.registerElement("upper_overlay_pane",this.div.elem)}olleh.maps.plugin.measure.MeasureOverlay.$super.update.apply(this,arguments)},_updateAreaInfo:function(){this.div.addClass("ollehmap-measure-areaInfo");var t="url("+olleh.maps.env.RESOURCE_URL+"img/controls.png)";this.div.elem.innerHTML='마우스 오른쪽 버튼을<br>누르면 마침 <div class="control-measure-bluemouse olleh-maps-inline" style="background-image:'+t+'"></div>'},_updateFinalAreaInfo:function(t){this.div.removeClass("ollehmap-measure-areaInfo"),this.div.addClass("ollehmap-measure-finalAreaInfo");var e=olleh.maps.util.applyTemplate("총면적 <strong>#{value}</strong>#{unit}",this._getArea(t));this.div.elem.innerHTML=e},_updatePointStart:function(){this.div.addClass("ollehmap-measure-pointStart"),this.div.elem.innerHTML="시작"},_updatePointInfo:function(){this.div.addClass("ollehmap-measure-pointInfo");var t=this._getDistance(this._opts.distance);this.div.elem.innerHTML=t.value+""+t.unit},_updatePointDetail:function(){var t=this.div;t.addClass("ollehmap-measure-pointDetail");var e=olleh.maps.Element.create("div");e.addClass("ollehmap-measure-pointDetail1"),e.elem.innerHTML="총거리",e.setStyle("margin-bottom","5px"),t.appendChild(e),this._distValue=olleh.maps.Element.create("div"),this._distValue.setStyle("margin-bottom","5px"),this._distValue.addClass("ollehmap-measure-pointDetail2"),t.appendChild(this._distValue);var i=olleh.maps.Element.create("div");i.addClass("ollehmap-measure-pointDetail1"),i.setStyle("margin-bottom","5px"),i.elem.innerHTML="도보",t.appendChild(i),this._walkValue=olleh.maps.Element.create("div"),this._walkValue.setStyle("margin-bottom","5px"),this._walkValue.addClass("ollehmap-measure-pointDetail2"),t.appendChild(this._walkValue);var s=olleh.maps.Element.create("div");s.elem.innerHTML="자전거",s.addClass("ollehmap-measure-pointDetail1"),t.appendChild(s),this._bikeValue=olleh.maps.Element.create("div"),this._bikeValue.addClass("ollehmap-measure-pointDetail2"),t.appendChild(this._bikeValue),this._rightButtonToFinish=olleh.maps.Element.create("div"),this._rightButtonToFinish.addClass("ollehmap-measure-finish");var o="url("+olleh.maps.env.RESOURCE_URL+"img/controls.png)";this._rightButtonToFinish.elem.innerHTML='마우스 오른쪽 버튼을<br>누르면 마침 <span class="control-measure-redmouse olleh-maps-inline" style="background-image:'+o+'"></span>',t.appendChild(this._rightButtonToFinish)},_updateFinalDistanceInfo:function(){this.div.setStyles({paddingBottom:"8px",marginTop:"-88px",marginLeft:"30px"}),this._rightButtonToFinish.setStyle("display","none")},setDistance:function(t){var e=olleh.maps.util.applyTemplate("<strong>#{value}</strong>#{unit}",this._getDistance(t));this._distValue.elem.innerHTML=e,this._walkValue.elem.innerHTML=this._getTimeHtml(t,66.6),this._bikeValue.elem.innerHTML=this._getTimeHtml(t,266.6)},finish:function(t){"areaInfo"===this._opts.type?this._updateFinalAreaInfo(t):this._updateFinalDistanceInfo()},_getTimeHtml:function(t,e){var i=this._getTime(t,e),s=olleh.maps.util.applyTemplate("<strong>#{m}</strong>분",i);return i.h&&(s=olleh.maps.util.applyTemplate("<strong>#{h}</strong>시간 ",i)+s),s},_getTime:function(t,e){var i=t/e,s=Math.floor(i/60),o=Math.floor(i%60),n={m:o};return s>0&&(n.h=s),n},_getDistance:function(t){var e="m";return t>1e3&&(e="km",t/=1e3),{value:t.toFixed(3),unit:e}},_getArea:function(t){var e;return t>1e6?(t/=1e6,e="km²"):e="m²",{value:t.toFixed(3),unit:e}}}),$class("olleh.maps.plugin.drawing.DrawCircle").mixin(olleh.maps.Plugin).define({serviceId:"drawCircle",pluginInfo:{drawingTool:!0},DrawCircle:function(t){this._opts=olleh.maps.mixin({circleOpts:{fillColor:"#05A15C",fillOpacity:.3,strokeColor:"#05A15C",strokeOpacity:.7,strokePosition:"center",strokeWeight:5}},t,"remix")},setOptions:function(t){this._opts=olleh.maps.mixin(this._opts,t,"remix")},doActivate:function(){var t=this.map,e=t.layerMgr;t.setCursor("crosshair"),e.onEvent("click",this._onClick,this,!0),e.onEvent("dragstart",this._onDragStart,this,!0),e.onEvent("dragend",this._onDragEnd,this,!0),e.setEditMode(!0)},doDeactivate:function(){var t=this.map,e=t.layerMgr;t.setCursor(null),e.unsubscribeEvent("click",this._onClick,this,!0),e.unsubscribeEvent("dragstart",this._onDragStart,this,!0),e.unsubscribeEvent("dragend",this._onDragEnd,this,!0),e.setEditMode(!1)},_complete:function(){if(this._circle){this.map.getLayer(olleh.maps.vector.VectorLayer.prototype.name).fireEvent("vector_created",this._circle),this._circle=null}},_onClick:function(t,e){this._circle?(this.map.layerMgr.unsubscribeEvent("mousemove",this._onDrag,this),this._complete()):(this._circle=this._createCircle(t.getCoord()),this.map.layerMgr.onEvent("mousemove",this._onDrag,this))},_onDragStart:function(t,e){t.preventDefault(),this._circle||(this._circle=this._createCircle(t.getCoord()),this.map.layerMgr.onEvent("drag",this._onDrag,this))},_onDrag:function(t,e){t.preventDefault();var i=this._center.distanceTo(t.getCoord());this._circle.setRadius(i)},_onDragEnd:function(t,e){t.preventDefault(),this.map.layerMgr.unsubscribeEvent("drag",this._onDrag,this),this._complete()},_createCircle:function(t){this._center=t;var e=olleh.maps.mixin({map:this.map,center:t,radius:1},this._opts.circleOpts,!0);return new olleh.maps.vector.Circle(e)}}),$class("olleh.maps.plugin.drawing.DrawPolygon").mixin(olleh.maps.Plugin).define({serviceId:"drawPolygon",pluginInfo:{drawingTool:!0},DrawPolygon:function(t){this._opts=olleh.maps.mixin({polygonOpts:{fillRule:"evenodd",strokeColor:"#06b3f5",strokeOpacity:.7,strokeWeight:5,fillColor:"#06b3f5",fillOpacity:.3}},t,"remix")},setOptions:function(t){this._opts=olleh.maps.mixin(this._opts,t,"remix")},doActivate:function(){var t=this.map,e=t.layerMgr;t.setCursor("crosshair"),e.onEvent("dblclick",this._onDblClick,this,!0),e.onEvent("click",this._onClick,this,!0),e.setEditMode(!0)},_onDblClick:function(t){t.stopPropagation(),t.preventDefault(),this._complete(),this._prevCoord=t.getCoord()},_onClick:function(t){var e=this.map;if(e.layerMgr.isZooming())return void t.stopPropagation();var i=t.getCoord();if(!i.equals(this._prevCoord))if(this._prevCoord=i,this._polygon)this._completePoint(i);else{var s=olleh.maps.mixin({map:this.map,paths:new olleh.maps.Path([i,i])},this._opts.polygonOpts);this._polygon=new olleh.maps.vector.Polygon(s),e.layerMgr.onEvent("mousemove",this._onMouseMove,this)}},_completePoint:function(t){this._polygon.getPaths()[0].push(t)},_onMouseMove:function(t,e){var i=this._polygon.getPaths()[0];i.setAt(i.getLength()-1,t.getCoord())},doDeactivate:function(){var t=this.map,e=t.layerMgr;t.setCursor(null),e.unsubscribeEvent("click",this._onClick,this),e.unsubscribeEvent("dblclick",this._onDblClick,this),e.setEditMode(!1),this._complete()},_complete:function(){if(this._polygon){var t=this._polygon.getPaths()[0],e=t.getLength()-1;t.getAt(e).equals(t.getAt(e-1))&&t.pop();var i=this.map;i.getLayer(olleh.maps.vector.VectorLayer.prototype.name).fireEvent("vector_created",this._polygon),this._polygon=null,i.layerMgr.unsubscribeEvent("mousemove",this._onMouseMove,this)}}}),$class("olleh.maps.plugin.drawing.DrawPolyline").mixin(olleh.maps.Plugin).define({serviceId:"drawPolyline",pluginInfo:{drawingTool:!0},DrawPolyline:function(t){this._opts=olleh.maps.mixin({polylineOpts:{strokeColor:"#df2428",strokeOpacity:.7,strokeWeight:5}},t,"remix")},setOptions:function(t){this._opts=olleh.maps.mixin(this._opts,t,"remix")},doActivate:function(){var t=this.map,e=t.layerMgr;t.setCursor("crosshair"),e.onEvent("click",this._onClick,this,!0),e.onEvent("dblclick",this._onDblClick,this,!0),e.setEditMode(!0)},_onDblClick:function(t){t.stopPropagation(),t.preventDefault(),this._finishDrawing(),this._dblClickCoord=t.getCoord()},_onClick:function(t){var e=this.map;if(e.layerMgr.isZooming())return void t.stopPropagation();var i=t.getCoord();if(!i.equals(this._dblClickCoord))if(this._dblClickCoord=null,this._polyline)this._completePoint(i);else{var s=olleh.maps.mixin({map:this.map,path:new olleh.maps.Path([i])},this._opts.polylineOpts);this._polyline=new olleh.maps.vector.Polyline(s),s=olleh.maps.mixin({map:this.map,path:new olleh.maps.Path([i,i])},this._opts.polylineOpts),s.strokeOpacity=.5,this._inprogressLine=new olleh.maps.vector.Polyline(s),e.layerMgr.onEvent("mousemove",this._onMouseMove,this)}},_completePoint:function(t){this._polyline.getPath().push(t),this._inprogressLine.setPath(new olleh.maps.Path([t,t]))},_onMouseMove:function(t,e){this._inprogressLine.getPath().setAt(1,t.getCoord())},doDeactivate:function(){var t=this.map,e=t.layerMgr;t.setCursor(null),e.unsubscribeEvent("click",this._onClick,this),e.unsubscribeEvent("dblclick",this._onDblClick,this),e.setEditMode(!1),this._finishDrawing()},_finishDrawing:function(){if(this._polyline){this.map.layerMgr.unsubscribeEvent("mousemove",this._onMouseMove,this);map.getLayer(olleh.maps.vector.VectorLayer.prototype.name).fireEvent("vector_created",this._polyline),this._inprogressLine.setMap(null),this._inprogressLine=null,this._polyline=null}}}),$class("olleh.maps.plugin.drawing.DrawRectangle").mixin(olleh.maps.Plugin).define({serviceId:"drawRectangle",pluginInfo:{drawingTool:!0},DrawRectangle:function(t){this._opts=olleh.maps.mixin({rectangleOpts:{fillColor:"#FFC408",fillOpacity:.3,strokeColor:"#FFC408",strokeOpacity:.7,strokePosition:"center",strokeWeight:5}},t,"remix")},setOptions:function(t){this._opts=olleh.maps.mixin(this._opts,t,"remix")},doActivate:function(){var t=this.map,e=t.layerMgr;t.setCursor("crosshair"),e.onEvent("click",this._onClick,this,!0),e.onEvent("dragstart",this._onDragStart,this,!0),e.onEvent("dragend",this._onDragEnd,this,!0),e.setEditMode(!0)},doDeactivate:function(){var t=this.map,e=t.layerMgr;t.setCursor(null),e.unsubscribeEvent("click",this._onClick,this,!0),e.unsubscribeEvent("dragstart",this._onDragStart,this,!0),e.unsubscribeEvent("dragend",this._onDragEnd,this,!0),e.setEditMode(!1),this._complete()},_complete:function(){if(this._rectangle){map.getLayer(olleh.maps.vector.VectorLayer.prototype.name).fireEvent("vector_created",this._rectangle),this._rectangle=null}},_onClick:function(t,e){this._rectangle?(this.map.layerMgr.unsubscribeEvent("mousemove",this._onDrag,this),this.deactivate()):(this._rectangle=this._createRectangle(t.getCoord()),this.map.layerMgr.onEvent("mousemove",this._onDrag,this))},_onDragStart:function(t,e){t.preventDefault(),this._rectangle||(this._rectangle=this._createRectangle(t.getCoord()),this.map.layerMgr.onEvent("drag",this._onDrag,this))},_onDrag:function(t,e){t.preventDefault();var i=t.getCoord(),s=this._rectangle.getBounds(),o=Math.min(i.x,this._startCoord.x),n=Math.min(i.y,this._startCoord.y),a=Math.max(i.x,this._startCoord.x),r=Math.max(i.y,this._startCoord.y);s=new olleh.maps.Bounds(new olleh.maps.UTMK(o,n),new olleh.maps.UTMK(a,r)),this._rectangle.setBounds(s)},_onDragEnd:function(t,e){t.preventDefault(),this.map.layerMgr.unsubscribeEvent("drag",this._onDrag,this),this._complete()},_createRectangle:function(t){this._startCoord=t;var e=olleh.maps.mixin({map:this.map,bounds:new olleh.maps.Bounds(t,t)},this._opts.rectangleOpts,!0);return new olleh.maps.vector.Rectangle(e)}}),$class("olleh.maps.plugin.drawing.DrawingControl").extend(olleh.maps.control.Control).define({DrawingControl:function(t){this.position=olleh.maps.control.Control.TOP_RIGHT,this.direction=olleh.maps.control.Control.VERTICAL,olleh.maps.mixin(this,t,!0)},attach:function(){olleh.maps.plugin.drawing.DrawingControl.$super.attach.apply(this,arguments),this.map.pluginRegistry.onEvent("plugin_state_changed",this._onStateChanged,this)},detach:function(){this.map.pluginRegistry.unsubscribeEvent("plugin_state_changed",this._onStateChanged,this),olleh.maps.plugin.drawing.DrawingControl.$super.detach.apply(this,arguments)},draw:function(){var t=olleh.maps.Element.create("div");t.setStyles({position:"relative",width:"25px",height:"125px",margin:"6px",backgroundColor:"white"});var e=this._circleImg=olleh.maps.Element.create("div");e.setStyles({backgroundImage:"url("+olleh.maps.env.RESOURCE_URL+"img/draw_circle.png)",backgroundRepeat:"no-repeat",backgroundPosition:"center",borderWidth:"1px",borderStyle:"solid",borderColor:"black black #F6F6F6",width:"25px",height:"25px",position:"absolute",top:"0px",left:"0px","border-radius":"5px 5px 0px 0px",cursor:"pointer"}),t.appendChild(e.elem),this.registerEventDom(e.elem);var i=this._rectangleImg=olleh.maps.Element.create("div");i.setStyles({backgroundImage:"url("+olleh.maps.env.RESOURCE_URL+"img/draw_rectangle.png)",backgroundRepeat:"no-repeat",backgroundPosition:"center",borderWidth:"1px",borderStyle:"solid",borderColor:"transparent black #F6F6F6",width:"25px",height:"25px",position:"absolute",top:"25px",left:"0px",cursor:"pointer"}),t.appendChild(i.elem),this.registerEventDom(i.elem);var s=this._polylineImg=olleh.maps.Element.create("div");s.setStyles({backgroundImage:"url("+olleh.maps.env.RESOURCE_URL+"img/draw_polyline.png)",backgroundRepeat:"no-repeat",backgroundPosition:"center",borderWidth:"1px",borderStyle:"solid",borderColor:"transparent black #F6F6F6",width:"25px",height:"25px",position:"absolute",top:"50px",left:"0px",cursor:"pointer"}),t.appendChild(s.elem),this.registerEventDom(s.elem);var o=this._polygonImg=olleh.maps.Element.create("div");o.setStyles({backgroundImage:"url("+olleh.maps.env.RESOURCE_URL+"img/draw_polygon.png)",backgroundRepeat:"no-repeat",backgroundPosition:"center",borderWidth:"1px",borderStyle:"solid",borderColor:"transparent black #F6F6F6",width:"25px",height:"25px",position:"absolute",top:"75px",left:"0px",cursor:"pointer"}),t.appendChild(o.elem),this.registerEventDom(o.elem);var n=this._handImg=olleh.maps.Element.create("div");return n.setStyles({backgroundImage:"url("+olleh.maps.env.RESOURCE_URL+"img/draw_hand.png)",backgroundRepeat:"no-repeat",backgroundPosition:"center",borderWidth:"1px",borderStyle:"solid",borderColor:"transparent black black black",width:"25px",height:"25px",position:"absolute",top:"100px",left:"0px","border-radius":"0px 0px 5px 5px",cursor:"pointer"}),t.appendChild(n.elem),this.registerEventDom(n.elem),t},propagateEvent:function(t,e){switch(t.getName()){case"click":case"touchend":this._click(t)}t.stopPropagation()},_click:function(t,e){var i=t.targetDOM,s=this.map;i===this._polylineImg.elem?s.services.drawPolyline.activate():i===this._polygonImg.elem?s.services.drawPolygon.activate():i===this._rectangleImg.elem?s.services.drawRectangle.activate():i===this._circleImg.elem?s.services.drawCircle.activate():i===this._handImg.elem&&(s.services.drawPolyline.deactivate(),s.services.drawPolygon.deactivate(),s.services.drawRectangle.deactivate(),s.services.drawCircle.deactivate())},_onStateChanged:function(t,e){}}),$class("olleh.maps.plugin.drawing.DrawingService").extend(olleh.maps.Adaptable).define({serviceId:"drawingService",DrawingService:function(t){this._opts=t||{}},attach:function(){this.drawCircle=new olleh.maps.plugin.drawing.DrawCircle(this._opts),this.drawCircle.setMap(this.map),this.drawPolyline=new olleh.maps.plugin.drawing.DrawPolyline(this._opts),this.drawPolyline.setMap(this.map),this.drawPolygon=new olleh.maps.plugin.drawing.DrawPolygon(this._opts),this.drawPolygon.setMap(this.map),this.drawRectangle=new olleh.maps.plugin.drawing.DrawRectangle(this._opts),this.drawRectangle.setMap(this.map),this.editingPlugin=new olleh.maps.plugin.drawing.EditingPlugin(this._opts),this.editingPlugin.setMap(this.map),this._opts.controlOpts&&(this.control=new olleh.maps.plugin.drawing.DrawingControl(this._opts.controlOpts),this.control.setMap(this.map))},detach:function(){this.drawCircle.setMap(null),this.drawPolyline.setMap(null),this.drawPolygon.setMap(null),this.drawRectangle.setMap(null),this.editingPlugin.setMap(null),this.control&&this.control.setMap(null)}}),$class("olleh.maps.plugin.drawing.EditingPlugin").extend(olleh.maps.Plugin).define({serviceId:"editingPlugin",pluginInfo:{drawingTool:!0},EditingPlugin:function(t){t=t||{},this._opts=t.editOpts||{}},doActivate:function(){"click"===this._opts.activation?this.map.onEvent("click",this._onclick,this):this._activateAllVector()},_activateAllVector:function(){for(var t=this.map.getLayer(olleh.maps.vector.VectorLayer.prototype.name),e=t.getVectors(),i=0;i<e.length;i++)e[i].setEditable(!0)},_deactivateAllVector:function(){for(var t=this.map.getLayer(olleh.maps.vector.VectorLayer.prototype.name),e=t.getVectors(),i=0;i<e.length;i++)e[i].setEditable(!1)},doDeactivate:function(){"click"===this._opts.activation?(this._activeEditTarget&&(this._activeEditTarget.setEditable(!1),this._activeEditTarget=null),this.map.unsubscribeEvent("click",this._onclick,this)):this._deactivateAllVector()},_onclick:function(t,e){var i=t.getSource();i instanceof olleh.maps.vector.Vector&&(this._activeEditTarget&&this._activeEditTarget===i||(i.setEditable(!0),this._activeEditTarget=i))}}),$class("olleh.maps.plugin.drawing.EditPolyline").extend(olleh.maps.vector.EditHandler).define({activate:function(){this.target&&(this._draggableVertices=[],this._draggableVertices2=[],this.refresh())},refresh:function(){for(var t=this._getPaths(),e=0,i=0;i<t.length;i++)for(var s=t[i],o=s.getCoords(),n=0;n<o.length;n++){var a=this._draggableVertices[e];if(a)a.setOptions({path:s,index:n});else{var r=new olleh.maps.plugin.drawing.PathEditingHandle({editHandler:this,path:s,index:n,map:this.target.map});this._draggableVertices.push(r)}if(!this._onChanging&&(n>0||this.target instanceof olleh.maps.vector.Polygon)){var l=this._draggableVertices2[e];if(l)l.setOptions({path:s,index:n});else{var r=new olleh.maps.plugin.drawing.AddVertexHandle({editHandler:this,path:s,index:n,map:this.target.map});this._draggableVertices2.push(r)}}e++}for(var h=this._draggableVertices.length;e++<h;){var m=this._draggableVertices.pop();m.setMap(null),m=this._draggableVertices2.pop(),m&&m.setMap(null)}var p=this.target.getCenter();p&&(this._centerHandle?this._centerHandle.setPosition(p):(this._centerHandle=new olleh.maps.plugin.drawing.EditingHandle({map:this.target.map,position:p}),this._centerHandle.onEvent("drag",this._onCenterDrag,this)))},_getPaths:function(){return this.target.getPath?[this.target.getPath()]:this.target.getPaths()},_onCenterDrag:function(t){var e=this._centerHandle.getPosition(),i=t.getCoord(),s=i.x-e.x,o=i.y-e.y;this._centerHandle.setPosition(i);for(var n=this._draggableVertices,a=0;a<n.length;a++){var r=n[a],l=r.getPosition().clone();l.x+=s,l.y+=o,r.setPosition(l)}n=this._draggableVertices2;for(var a=0;a<n.length;a++){var r=n[a],l=r.getPosition().clone();l.x+=s,l.y+=o,r.setPosition(l)}for(var h=this._getPaths(),a=0;a<h.length;a++)for(var m=h[a],p=m.getCoords(),d=0;d<p.length;d++){var u=p[d].clone();u.x+=s,u.y+=o,p[d]=u}this.target.draw()},deactivate:function(){var t=this._draggableVertices;this._draggableVertices=null;for(var e=0;e<t.length;e++)t[e].setMap(null);t=this._draggableVertices2,this._draggableVertices2=null;for(var e=0;e<t.length;e++)t[e].setMap(null);this._centerHandle.setMap(null),this._centerHandle=null}}),olleh.maps.vector.Vector.prototype.editHandlerRegistry["olleh.maps.vector.Polyline"]=olleh.maps.plugin.drawing.EditPolyline,$class("olleh.maps.plugin.drawing.EditRectangle").extend(olleh.maps.vector.EditHandler).define({activate:function(){var t=this.target;if(t){var e=t.getBounds(),i=new olleh.maps.plugin.drawing.EditingHandle({map:t.map,position:e.getLeftTopCoord()});this._leftTopHandle=i,i.onEvent("drag",this._onDrag,this),i=new olleh.maps.plugin.drawing.EditingHandle({map:t.map,position:e.rightTop}),this._rightTopHandle=i,i.onEvent("drag",this._onDrag,this),i=new olleh.maps.plugin.drawing.EditingHandle({map:t.map,position:e.getRightBottomCoord()}),this._rightBottomHandle=i,i.onEvent("drag",this._onDrag,this),i=new olleh.maps.plugin.drawing.EditingHandle({map:t.map,position:e.leftBottom}),this._leftBottomHandle=i,i.onEvent("drag",this._onDrag,this),i=new olleh.maps.plugin.drawing.EditingHandle({map:t.map,position:e.getCenter()}),this._centerHandle=i,i.onEvent("drag",this._onDrag,this)}},_onDrag:function(t,e){t.preventDefault();var i,s=t.getCoord(),o=t.getSource(),n=this._rightTopHandle.getPosition().clone(),a=this._leftBottomHandle.getPosition().clone(),r=this._leftTopHandle.getPosition().clone(),l=this._rightBottomHandle.getPosition().clone();if(o===this._leftTopHandle)i=this._rightBottomHandle.getPosition(),n.y=s.y,a.x=s.x,r=s;else if(o===this._rightTopHandle)i=this._leftBottomHandle.getPosition(),r.y=s.y,l.x=s.x,n=s;else if(o===this._rightBottomHandle)i=this._leftTopHandle.getPosition(),n.x=s.x,a.y=s.y,l=s;else if(o===this._leftBottomHandle)i=this._rightTopHandle.getPosition(),r.x=s.x,l.y=s.y,a=s;else if(o===this._centerHandle){var h=this._centerHandle.getPosition(),m=t.getCoord().x-h.x,p=t.getCoord().y-h.y;n.x+=m,n.y+=p,a.x+=m,a.y+=p,r.x+=m,r.y+=p,l.x+=m,l.y+=p,s=r,i=l}var d=Math.min(s.x,i.x),u=Math.min(s.y,i.y),c=Math.max(s.x,i.x),g=Math.max(s.y,i.y);bounds=new olleh.maps.Bounds(new olleh.maps.UTMK(d,u),new olleh.maps.UTMK(c,g)),this.target.setBounds(bounds),this._rightTopHandle.setPosition(n),this._leftBottomHandle.setPosition(a),this._leftTopHandle.setPosition(r),this._rightBottomHandle.setPosition(l),this._centerHandle.setPosition(bounds.getCenter())},refresh:function(){var t=this.target.getBounds();this._rightTopHandle.setPosition(t.rightTop),this._leftBottomHandle.setPosition(t.leftBottom),this._leftTopHandle.setPosition(t.getLeftTopCoord()),this._rightBottomHandle.setPosition(t.getRightBottomCoord()),this._centerHandle.setPosition(t.getCenter())},deactivate:function(){this._rightTopHandle.setMap(null),this._leftBottomHandle.setMap(null),this._leftTopHandle.setMap(null),this._rightBottomHandle.setMap(null),this._centerHandle.setMap(null)}}),olleh.maps.vector.Vector.prototype.editHandlerRegistry["olleh.maps.vector.Rectangle"]=olleh.maps.plugin.drawing.EditRectangle,$class("olleh.maps.plugin.drawing.EditPolygon").extend(olleh.maps.plugin.drawing.EditPolyline).define({}),olleh.maps.vector.Vector.prototype.editHandlerRegistry["olleh.maps.vector.Polygon"]=olleh.maps.plugin.drawing.EditPolygon,$class("olleh.maps.plugin.drawing.EditCircle").extend(olleh.maps.vector.EditHandler).define({activate:function(){var t=this.target;if(t){var e=new olleh.maps.plugin.drawing.EditingHandle({map:t.map,position:t.getCenter()});e.onEvent("drag",this._onCenterDrag,this),this._centerHandle=e;var i=t.getCenter().clone();i.x+=t.getRadius(),e=new olleh.maps.plugin.drawing.EditingHandle({map:t.map,position:i}),e.onEvent("drag",this._onRadiusDrag,this),this._radiusHandle=e}},refresh:function(){var t=this.target;this._centerHandle.setPosition(t.getCenter());var e=t.getCenter().clone();e.x+=t.getRadius(),this._radiusHandle.setPosition(e)},_onCenterDrag:function(t,e){var i=t.getCoord(),s=this.target,o=i.x-s.getCenter().x,n=i.y-s.getCenter().y;s.setCenter(i);var a=this._radiusHandle.getPosition();a.x+=o,a.y+=n,this._radiusHandle.setPosition(a.clone())},_onRadiusDrag:function(t,e){var i=this.target.getCenter().distanceTo(t.getCoord());this.target.setRadius(i)},deactivate:function(){this._centerHandle.setMap(null),this._radiusHandle.setMap(null)}}),olleh.maps.vector.Vector.prototype.editHandlerRegistry["olleh.maps.vector.Circle"]=olleh.maps.plugin.drawing.EditCircle,$class("olleh.maps.plugin.drawing.EditingHandle").extend(olleh.maps.overlay.PointedOverlay).define({defaultStyles:{width:"11px",height:"11px",marginLeft:"-5px",marginTop:"-5px"},update:function(){this.div||(this.div=new olleh.maps.SpritedImage,this.div.setImage(olleh.maps.env.RESOURCE_URL+"img/controls.png",new olleh.maps.Point(127,145)),this.div.setStyles(this.defaultStyles),olleh.maps.util.dom.setStyle(this.div.elem,"userSelect","none"),this.registerElement("upper_overlay_pane",this.div.elem),this.registerEventDom(this.div.elem)),olleh.maps.plugin.drawing.EditingHandle.$super.update.apply(this,arguments)},$capture_dragstart:function(t,e){t.preventDefault()},$capture_dragend:function(t,e){t.preventDefault();var i=this.getLayer().layerMgr.getCoordFromLayerPx(this._currentLayerPx);this.setPosition(i)},$capture_drag:function(t,e){t.preventDefault(),this.move(e.movementXY)}}),$class("olleh.maps.plugin.drawing.PathEditingHandle").extend(olleh.maps.plugin.drawing.EditingHandle).define({PathEditingHandle:function(t){this._editHandler=t.editHandler,this._path=t.path,this._index=t.index,this.setPosition(this._path.getAt(this._index))},setOptions:function(t){t.path&&t.index!==undefined&&(this._path=t.path,this._index=t.index,this.setPosition(this._path.getAt(this._index))),olleh.maps.plugin.drawing.PathEditingHandle.$super.setOptions.apply(this,arguments)},$capture_dragstart:function(t,e){t.preventDefault()},$capture_dragend:function(t,e){t.preventDefault();var i=this.getLayer().layerMgr.getCoordFromLayerPx(this._currentLayerPx);this.setPosition(i)},$capture_drag:function(t,e){t.preventDefault(),this.move(e.movementXY);var i=this.getLayer().layerMgr.getCoordFromLayerPx(this._currentLayerPx);this._path.setAt(this._index,i)}}),$class("olleh.maps.plugin.drawing.AddVertexHandle").extend(olleh.maps.plugin.drawing.EditingHandle).define({defaultStyles:{width:"11px",height:"11px",marginLeft:"-5px",marginTop:"-5px",opacity:".5"},AddVertexHandle:function(t){this._editHandler=t.editHandler,this._setOptions(t)},_setOptions:function(t){this._path=t.path,this._index=t.index;var e=t.path.getCoords(),i=0===t.index?e.length-1:t.index-1,s=e[i],o=e[t.index],n=s.clone();n.x+=(o.x-s.x)/2,n.y+=(o.y-s.y)/2,this.setPosition(n)},setOptions:function(t){t.path&&t.index!==undefined&&this._setOptions(t),olleh.maps.plugin.drawing.AddVertexHandle.$super.setOptions.apply(this,arguments)},$capture_dragstart:function(t,e){t.preventDefault();var i=t.getCoord().clone();this._editHandler._onChanging=!0,this._path.insertAt(this._index,i)},$capture_dragend:function(t,e){t.preventDefault();var i=this.getLayer().layerMgr.getCoordFromLayerPx(this._currentLayerPx);this.setPosition(i),this._editHandler._onChanging=!1,this._editHandler.target.draw()},$capture_drag:function(t,e){t.preventDefault(),this.move(e.movementXY);var i=this.getLayer().layerMgr.getCoordFromLayerPx(this._currentLayerPx);this._path.setAt(this._index,i)}});
